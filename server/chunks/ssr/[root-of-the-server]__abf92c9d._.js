module.exports = {

"[externals]/child_process [external] (child_process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/node:process [external] (node:process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/http2 [external] (http2, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[project]/src/lib/drive-oauth.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "getOAuth2Client": (()=>getOAuth2Client),
    "getSheetsClient": (()=>getSheetsClient)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/googleapis/build/src/index.js [app-rsc] (ecmascript)");
;
const { GOOGLE_OAUTH_CLIENT_ID, GOOGLE_OAUTH_CLIENT_SECRET, GOOGLE_OAUTH_REFRESH_TOKEN } = process.env;
if (!GOOGLE_OAUTH_CLIENT_ID || !GOOGLE_OAUTH_CLIENT_SECRET || !GOOGLE_OAUTH_REFRESH_TOKEN) {
    // This check is important but shouldn't throw an error that crashes the server on startup,
    // as the credentials might not be used on every page load.
    // We will let the functions that use it handle the error.
    console.warn('Google OAuth credentials are not fully configured in .env. Some Drive/Sheets features may not work.');
}
// This is a fixed value for web applications
const GOOGLE_OAUTH_REDIRECT_URI = 'https://developers.google.com/oauthplayground';
let oauth2Client = null;
async function getOAuth2Client() {
    // Add the check here to provide a clear error when the credentials are used.
    if (!GOOGLE_OAUTH_CLIENT_ID || !GOOGLE_OAUTH_CLIENT_SECRET || !GOOGLE_OAUTH_REFRESH_TOKEN) {
        throw new Error('Google OAuth credentials (CLIENT_ID, CLIENT_SECRET, REFRESH_TOKEN) must be configured in your .env file.');
    }
    if (oauth2Client) {
        // Check if the token is about to expire (within 60 seconds) and refresh if needed
        if (oauth2Client.credentials.expiry_date && oauth2Client.credentials.expiry_date < Date.now() + 60 * 1000) {
            console.log('[OAuth] Access token expiring soon, refreshing...');
            await oauth2Client.refreshAccessToken();
            console.log('[OAuth] Access token refreshed.');
        }
        return oauth2Client;
    }
    const client = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].auth.OAuth2(GOOGLE_OAUTH_CLIENT_ID, GOOGLE_OAUTH_CLIENT_SECRET, GOOGLE_OAUTH_REDIRECT_URI);
    client.setCredentials({
        refresh_token: GOOGLE_OAUTH_REFRESH_TOKEN
    });
    // Do an initial token refresh to get the access token
    try {
        console.log('[OAuth] Initializing and refreshing access token...');
        await client.refreshAccessToken();
        console.log('[OAuth] Initial token refreshed successfully.');
    } catch (error) {
        console.error('[OAuth] Failed to refresh access token:', error);
        throw new Error('Failed to refresh access token. Check your refresh token and credentials.');
    }
    oauth2Client = client;
    return oauth2Client;
}
async function getSheetsClient() {
    const oauth2Client = await getOAuth2Client();
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: oauth2Client
    });
}
}}),
"[project]/src/lib/googlesheets.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "addPendingUser": (()=>addPendingUser),
    "addSessionToSheet": (()=>addSessionToSheet),
    "addUser": (()=>addUser),
    "appendHeaderDataToSheet": (()=>appendHeaderDataToSheet),
    "createDatabaseSheet": (()=>createDatabaseSheet),
    "deleteAllOtherSessionsByToken": (()=>deleteAllOtherSessionsByToken),
    "deleteAllSessionsByEmail": (()=>deleteAllSessionsByEmail),
    "deleteHeaderDataRowInSheet": (()=>deleteHeaderDataRowInSheet),
    "deletePendingUserByRow": (()=>deletePendingUserByRow),
    "deleteSessionByToken": (()=>deleteSessionByToken),
    "findUserByTokenFromSheet": (()=>findUserByTokenFromSheet),
    "getAllHeaderDataFromSheet": (()=>getAllHeaderDataFromSheet),
    "getAllUsers": (()=>getAllUsers),
    "getPendingUserByToken": (()=>getPendingUserByToken),
    "getSessionsByEmail": (()=>getSessionsByEmail),
    "updateHeaderDataInSheet": (()=>updateHeaderDataInSheet),
    "updateUserDataInSheet": (()=>updateUserDataInSheet),
    "updateUserDatabaseId": (()=>updateUserDatabaseId),
    "updateUserFolderId": (()=>updateUserFolderId),
    "updateUserPasswordByEmail": (()=>updateUserPasswordByEmail)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/drive-oauth.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/googleapis/build/src/index.js [app-rsc] (ecmascript)");
;
;
;
const signupSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    userName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().email(),
    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
const loginSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    userName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
    password: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string()
});
const { GOOGLE_SHEETS_SHEET_ID, GOOGLE_SHEETS_DB_TEMPLATE_ID, GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID } = process.env;
if (!GOOGLE_SHEETS_SHEET_ID) {
    throw new Error('GOOGLE_SHEETS_SHEET_ID is not configured in .env');
}
if (!GOOGLE_SHEETS_DB_TEMPLATE_ID) {
    throw new Error('GOOGLE_SHEETS_DB_TEMPLATE_ID is not configured in .env');
}
if (!GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID) {
    throw new Error('GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID is not configured in .env');
}
const SPREADSHEET_ID = GOOGLE_SHEETS_SHEET_ID;
const TEMPLATE_SPREADSHEET_ID = GOOGLE_SHEETS_DB_TEMPLATE_ID;
const CREDENTIALS_SHEET_NAME = 'credentials';
const PENDING_VERIFICATIONS_SHEET_NAME = 'PendingVerifications';
const SESSIONS_SHEET_NAME = 'ActiveSessions';
async function createDatabaseSheet(userEmail, parentFolderId) {
    const oauth2Client = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])();
    const drive = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].drive({
        version: 'v3',
        auth: oauth2Client
    });
    const newSheetName = `Database - ${userEmail}`;
    try {
        const copiedFile = await drive.files.copy({
            fileId: TEMPLATE_SPREADSHEET_ID,
            requestBody: {
                name: newSheetName,
                parents: [
                    parentFolderId
                ]
            }
        });
        const newSpreadsheetId = copiedFile.data.id;
        if (!newSpreadsheetId) {
            throw new Error('Failed to get ID of the new spreadsheet.');
        }
        console.log(`[Sheets] Cloned template sheet for "${newSheetName}" with ID: ${newSpreadsheetId}`);
        return newSpreadsheetId;
    } catch (err) {
        console.error('The API returned an error: ' + err);
        throw new Error('Failed to create database sheet.');
    }
}
async function getAllUsers() {
    try {
        const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
            version: 'v4',
            auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
        });
        const response = await sheets.spreadsheets.values.get({
            spreadsheetId: SPREADSHEET_ID,
            range: CREDENTIALS_SHEET_NAME
        });
        const rows = response.data.values;
        if (!rows || rows.length < 2) {
            return [];
        }
        const header = rows[0];
        const emailIndex = header.indexOf('emailAddress');
        const userNameIndex = header.indexOf('userName');
        const pwdIndex = header.indexOf('pwd');
        const databaseIdIndex = header.indexOf('databaseID');
        const folderIdIndex = header.indexOf('folderID');
        if (userNameIndex === -1 || pwdIndex === -1 || emailIndex === -1 || databaseIdIndex === -1 || folderIdIndex === -1) {
            console.error('One or more required columns are missing from the credentials sheet:', header);
            throw new Error('Could not find required columns in the credentials sheet. Please check sheet headers.');
        }
        return rows.slice(1).map((row)=>({
                emailAddress: row[emailIndex] || '',
                userName: row[userNameIndex] || '',
                pwd: row[pwdIndex] || '',
                databaseId: row[databaseIdIndex] || '',
                folderId: row[folderIdIndex] || ''
            })).filter((u)=>u.userName); // Filter out empty rows
    } catch (err) {
        console.error('The API returned an error when getting all users: ' + err);
        throw new Error('Failed to retrieve data from Google Sheet.');
    }
}
async function updateUserFolderId(userName, folderId) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${CREDENTIALS_SHEET_NAME}!A:H`;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length === 0) {
        throw new Error('No users found in credentials sheet.');
    }
    const header = rows[0];
    const userNameIndex = header.indexOf('userName');
    const folderIdIndex = header.indexOf('folderID');
    if (userNameIndex === -1 || folderIdIndex === -1) {
        throw new Error('userName or folderID column not found.');
    }
    const userRowIndex = rows.findIndex((row)=>row[userNameIndex] === userName);
    if (userRowIndex === -1) {
        throw new Error(`User ${userName} not found.`);
    }
    const rowToUpdate = userRowIndex + 1;
    const columnToUpdate = String.fromCharCode('A'.charCodeAt(0) + folderIdIndex);
    await sheets.spreadsheets.values.update({
        spreadsheetId: SPREADSHEET_ID,
        range: `${CREDENTIALS_SHEET_NAME}!${columnToUpdate}${rowToUpdate}`,
        valueInputOption: 'RAW',
        resource: {
            values: [
                [
                    folderId
                ]
            ]
        }
    });
}
async function updateUserDatabaseId(userName, databaseId) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${CREDENTIALS_SHEET_NAME}!A:H`;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length === 0) {
        throw new Error('No users found in credentials sheet.');
    }
    const header = rows[0];
    const userNameIndex = header.indexOf('userName');
    const databaseIdIndex = header.indexOf('databaseID');
    if (userNameIndex === -1 || databaseIdIndex === -1) {
        throw new Error('userName or databaseID column not found.');
    }
    const userRowIndex = rows.findIndex((row)=>row[userNameIndex] === userName);
    if (userRowIndex === -1) {
        throw new Error(`User ${userName} not found.`);
    }
    const rowToUpdate = userRowIndex + 1;
    const columnToUpdate = String.fromCharCode('A'.charCodeAt(0) + databaseIdIndex);
    await sheets.spreadsheets.values.update({
        spreadsheetId: SPREADSHEET_ID,
        range: `${CREDENTIALS_SHEET_NAME}!${columnToUpdate}${rowToUpdate}`,
        valueInputOption: 'RAW',
        resource: {
            values: [
                [
                    databaseId
                ]
            ]
        }
    });
}
async function getAllHeaderDataFromSheet(databaseId) {
    try {
        const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
            version: 'v4',
            auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
        });
        const response = await sheets.spreadsheets.values.get({
            spreadsheetId: databaseId,
            range: 'tpList!A:Q'
        });
        const rows = response.data.values;
        if (!rows || rows.length < 2) {
            return [];
        }
        const header = rows[0];
        const dataRows = rows.slice(1);
        const objects = dataRows.map((row)=>{
            const rowData = {};
            header.forEach((key, headerIndex)=>{
                rowData[key] = row[headerIndex] || '';
            });
            return rowData;
        }).filter((profile)=>profile.tpTIN && typeof profile.tpTIN === 'string' && profile.tpTIN.trim() !== '');
        return objects;
    } catch (err) {
        console.error(`The API returned an error for spreadsheet ${databaseId}: ` + err);
        throw new Error('Failed to retrieve header data from Google Sheet.');
    }
}
async function appendHeaderDataToSheet(profileData, databaseId) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const headerResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: databaseId,
        range: 'tpList!A1:Q1'
    });
    const headers = headerResponse.data.values?.[0];
    if (!headers) {
        throw new Error('Could not retrieve headers from tpList sheet.');
    }
    const values = [
        headers.map((header)=>profileData[header] || '')
    ];
    const request = {
        spreadsheetId: databaseId,
        range: `tpList!A1`,
        valueInputOption: 'USER_ENTERED',
        resource: {
            values
        }
    };
    try {
        const response = await sheets.spreadsheets.values.append(request);
        console.log('Appended to sheet:', response.data);
        return response.data;
    } catch (err) {
        console.error('The API returned an error: ' + err);
        throw new Error('Failed to append data to Google Sheet.');
    }
}
async function updateHeaderDataInSheet(profileData, databaseId) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = 'tpList!A:Q';
    const getResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: databaseId,
        range
    });
    const rows = getResponse.data.values;
    if (!rows || rows.length === 0) {
        throw new Error('No data found in the sheet.');
    }
    const headers = rows[0];
    const tinIndex = headers.indexOf('tpTIN');
    if (tinIndex === -1) {
        throw new Error('TIN column not found in the sheet.');
    }
    const rowIndex = rows.findIndex((row)=>row[tinIndex] === profileData.tpTIN);
    if (rowIndex === -1) {
        throw new Error('Profile with the specified TIN not found.');
    }
    const rowToUpdate = rowIndex + 1;
    const values = [
        headers.map((header)=>profileData[header] || '')
    ];
    const request = {
        spreadsheetId: databaseId,
        range: `tpList!A${rowToUpdate}`,
        valueInputOption: 'USER_ENTERED',
        resource: {
            values
        }
    };
    try {
        const response = await sheets.spreadsheets.values.update(request);
        console.log('Updated sheet:', response.data);
        return response.data;
    } catch (err) {
        console.error('The API returned an error: ' + err);
        throw new Error('Failed to update data in Google Sheet.');
    }
}
async function getSheetId(spreadsheetId, sheetName) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const response = await sheets.spreadsheets.get({
        spreadsheetId
    });
    const sheet = response.data.sheets?.find((s)=>s.properties?.title === sheetName);
    return sheet?.properties?.sheetId ?? null;
}
async function deleteHeaderDataRowInSheet(tpTIN, databaseId) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const sheetName = 'tpList';
    const range = `${sheetName}!A:Q`;
    const getResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: databaseId,
        range
    });
    const rows = getResponse.data.values;
    if (!rows || rows.length === 0) {
        console.log('No data found in the sheet to delete.');
        return;
    }
    const headers = rows[0];
    const tinIndex = headers.indexOf('tpTIN');
    if (tinIndex === -1) {
        throw new Error('TIN column not found in the sheet.');
    }
    const rowIndex = rows.findIndex((row)=>row[tinIndex] === tpTIN);
    if (rowIndex === -1) {
        console.log(`Profile with TIN ${tpTIN} not found for deletion.`);
        return;
    }
    const sheetId = await getSheetId(databaseId, sheetName);
    if (sheetId === null) {
        throw new Error(`Sheet with name "${sheetName}" not found.`);
    }
    const batchUpdateRequest = {
        spreadsheetId: databaseId,
        resource: {
            requests: [
                {
                    deleteDimension: {
                        range: {
                            sheetId: sheetId,
                            dimension: 'ROWS',
                            startIndex: rowIndex,
                            endIndex: rowIndex + 1
                        }
                    }
                },
                {
                    appendDimension: {
                        sheetId: sheetId,
                        dimension: "ROWS",
                        length: 1
                    }
                }
            ]
        }
    };
    try {
        await sheets.spreadsheets.batchUpdate(batchUpdateRequest);
        console.log(`Successfully deleted row at index ${rowIndex} and added a new one.`);
    } catch (err) {
        console.error('The API returned an error during batch update: ' + err);
        throw new Error('Failed to delete row from Google Sheet.');
    }
}
async function updateUserDataInSheet(currentUserName, updates) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${CREDENTIALS_SHEET_NAME}!A:H`;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length === 0) {
        throw new Error('No users found in credentials sheet.');
    }
    const header = rows[0];
    const userNameIndex = header.indexOf('userName');
    const pwdIndex = header.indexOf('pwd');
    if (userNameIndex === -1 || pwdIndex === -1) {
        throw new Error('Required columns (userName, pwd) not found.');
    }
    const userRowIndex = rows.findIndex((row)=>row[userNameIndex] === currentUserName);
    if (userRowIndex === -1) {
        throw new Error(`User '${currentUserName}' not found.`);
    }
    const rowToUpdate = userRowIndex + 1;
    const userRow = [
        ...rows[userRowIndex]
    ];
    if (updates.newPassword) {
        if (!updates.currentPassword) {
            throw new Error("Current password is required to change password.");
        }
        if (userRow[pwdIndex] !== updates.currentPassword) {
            throw new Error("Incorrect current password.");
        }
        userRow[pwdIndex] = updates.newPassword;
    }
    if (updates.newUserName) {
        const isUserNameTaken = rows.slice(1).some((row, index)=>index !== userRowIndex - 1 && row[userNameIndex] === updates.newUserName);
        if (isUserNameTaken) {
            throw new Error(`Username '${updates.newUserName}' is already taken.`);
        }
        userRow[userNameIndex] = updates.newUserName;
    }
    const updateRequest = {
        spreadsheetId: SPREADSHEET_ID,
        range: `${CREDENTIALS_SHEET_NAME}!A${rowToUpdate}:H${rowToUpdate}`,
        valueInputOption: 'RAW',
        resource: {
            values: [
                userRow
            ]
        }
    };
    await sheets.spreadsheets.values.update(updateRequest);
    console.log(`Successfully updated user data for '${currentUserName}'. New username: '${updates.newUserName || currentUserName}'`);
}
async function updateUserPasswordByEmail(email, newPassword) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${CREDENTIALS_SHEET_NAME}!A:E`;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length < 2) {
        throw new Error('No users found in credentials sheet.');
    }
    const header = rows[0];
    const emailIndex = header.indexOf('emailAddress');
    const pwdIndex = header.indexOf('pwd');
    if (emailIndex === -1 || pwdIndex === -1) {
        throw new Error('Required columns (emailAddress, pwd) not found.');
    }
    const userRowIndex = rows.findIndex((row)=>row[emailIndex] === email);
    if (userRowIndex === -1) {
        throw new Error(`User with email ${email} not found.`);
    }
    const rowToUpdate = userRowIndex + 1;
    const columnToUpdate = String.fromCharCode('A'.charCodeAt(0) + pwdIndex);
    await sheets.spreadsheets.values.update({
        spreadsheetId: SPREADSHEET_ID,
        range: `${CREDENTIALS_SHEET_NAME}!${columnToUpdate}${rowToUpdate}`,
        valueInputOption: 'RAW',
        resource: {
            values: [
                [
                    newPassword
                ]
            ]
        }
    });
    console.log(`Successfully updated password for user ${email}.`);
}
async function addPendingUser(user) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const sheetName = PENDING_VERIFICATIONS_SHEET_NAME;
    const getResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: `${sheetName}!A:A`
    });
    const rows = getResponse.data.values || [];
    const existingRowIndex = rows.findIndex((row)=>row[0] === user.email);
    const values = [
        [
            user.email,
            user.userName || '',
            user.password || '',
            user.token,
            user.type,
            user.expires
        ]
    ];
    if (existingRowIndex !== -1) {
        const rowToUpdate = existingRowIndex + 1;
        console.log(`[Sheets] Found existing pending verification for ${user.email} at row ${rowToUpdate}. Updating.`);
        await sheets.spreadsheets.values.update({
            spreadsheetId: SPREADSHEET_ID,
            range: `${sheetName}!A${rowToUpdate}:F${rowToUpdate}`,
            valueInputOption: 'USER_ENTERED',
            resource: {
                values
            }
        });
    } else {
        console.log(`[Sheets] No existing pending verification for ${user.email}. Appending new row.`);
        await sheets.spreadsheets.values.append({
            spreadsheetId: SPREADSHEET_ID,
            range: `${sheetName}!A1`,
            valueInputOption: 'USER_ENTERED',
            resource: {
                values
            }
        });
    }
}
async function getPendingUserByToken(token) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: PENDING_VERIFICATIONS_SHEET_NAME
    });
    const rows = response.data.values;
    if (!rows || rows.length < 2) return null;
    const header = rows[0];
    const tokenIndex = header.indexOf('token');
    const rowIndex = rows.findIndex((row, index)=>index > 0 && row[tokenIndex] === token);
    if (rowIndex === -1) return null;
    const userRow = rows[rowIndex];
    const user = {
        email: userRow[header.indexOf('emailAddress')],
        userName: userRow[header.indexOf('userName')],
        password: userRow[header.indexOf('password')],
        token: userRow[tokenIndex],
        type: userRow[header.indexOf('type')],
        expires: userRow[header.indexOf('expiration')]
    };
    return {
        user,
        rowIndex
    };
}
async function deletePendingUserByRow(rowIndex) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const sheetId = await getSheetId(SPREADSHEET_ID, PENDING_VERIFICATIONS_SHEET_NAME);
    if (sheetId === null) throw new Error('Sheet not found');
    await sheets.spreadsheets.batchUpdate({
        spreadsheetId: SPREADSHEET_ID,
        resource: {
            requests: [
                {
                    deleteDimension: {
                        range: {
                            sheetId,
                            dimension: 'ROWS',
                            startIndex: rowIndex,
                            endIndex: rowIndex + 1
                        }
                    }
                }
            ]
        }
    });
}
async function addUser(userData) {
    const { email, userName, password, folderId, databaseId } = userData;
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const headerResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: `${CREDENTIALS_SHEET_NAME}!A1:E1`
    });
    const headers = headerResponse.data.values?.[0];
    if (!headers) {
        throw new Error('Could not retrieve headers from credentials sheet.');
    }
    const userObject = {
        emailAddress: email,
        userName: userName,
        pwd: password || '',
        databaseID: databaseId,
        folderID: folderId
    };
    const values = [
        headers.map((header)=>userObject[header] || '')
    ];
    const request = {
        spreadsheetId: SPREADSHEET_ID,
        range: `${CREDENTIALS_SHEET_NAME}!A1`,
        valueInputOption: 'USER_ENTERED',
        resource: {
            values
        }
    };
    await sheets.spreadsheets.values.append(request);
}
async function addSessionToSheet(sessionData) {
    const { emailAddress, sessionToken, ipAddress, deviceInfo } = sessionData;
    const loginTime = new Date().toISOString();
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const sheetName = SESSIONS_SHEET_NAME;
    const getResponse = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: `${sheetName}!A:E`
    });
    const rows = getResponse.data.values;
    if (rows && rows.length > 1) {
        const header = rows[0];
        const emailIndex = header.indexOf('emailAddress');
        const deviceInfoIndex = header.indexOf('deviceInfo');
        const existingSessionRowIndex = rows.findIndex((row, index)=>index > 0 && row[emailIndex] === emailAddress && row[deviceInfoIndex] === deviceInfo);
        if (existingSessionRowIndex !== -1) {
            console.log(`[Sessions] Found existing session for ${emailAddress} on device. Removing before adding new one.`);
            const sheetId = await getSheetId(SPREADSHEET_ID, sheetName);
            if (sheetId === null) {
                throw new Error(`Sheet with name "${sheetName}" not found.`);
            }
            await sheets.spreadsheets.batchUpdate({
                spreadsheetId: SPREADSHEET_ID,
                resource: {
                    requests: [
                        {
                            deleteDimension: {
                                range: {
                                    sheetId,
                                    dimension: 'ROWS',
                                    startIndex: existingSessionRowIndex,
                                    endIndex: existingSessionRowIndex + 1
                                }
                            }
                        }
                    ]
                }
            });
        }
    }
    const values = [
        [
            emailAddress,
            sessionToken,
            loginTime,
            ipAddress,
            deviceInfo
        ]
    ];
    const appendRequest = {
        spreadsheetId: SPREADSHEET_ID,
        range: `${sheetName}!A1`,
        valueInputOption: 'USER_ENTERED',
        resource: {
            values
        }
    };
    try {
        await sheets.spreadsheets.values.append(appendRequest);
        console.log(`[Sessions] Added new session for user ${emailAddress}`);
    } catch (err) {
        console.error('The API returned an error while adding a session: ' + err);
        throw new Error('Failed to add session to Google Sheet.');
    }
}
async function getSessionsByEmail(email) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: SESSIONS_SHEET_NAME
    });
    const rows = response.data.values;
    if (!rows || rows.length < 2) return [];
    const header = rows[0];
    const emailIndex = header.indexOf('emailAddress');
    const tokenIndex = header.indexOf('sessionToken');
    const timeIndex = header.indexOf('loginTime');
    const ipIndex = header.indexOf('ipAddress');
    const deviceIndex = header.indexOf('deviceInfo');
    return rows.slice(1).filter((row)=>row[emailIndex] === email).map((row)=>({
            token: row[tokenIndex],
            loginTime: row[timeIndex],
            ipAddress: row[ipIndex],
            deviceInfo: row[deviceIndex]
        }));
}
async function findRowIndexByToken(token) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const sheetName = SESSIONS_SHEET_NAME;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range: `${sheetName}!B:B`
    });
    const rows = response.data.values;
    if (!rows) throw new Error('Could not find session.');
    const rowIndex = rows.findIndex((row)=>row[0] === token);
    if (rowIndex === -1) throw new Error('Session token not found.');
    const sheetId = await getSheetId(SPREADSHEET_ID, sheetName);
    if (sheetId === null) throw new Error('Could not find sheet ID for sessions.');
    return {
        sheetId,
        rowIndex
    };
}
async function findUserByTokenFromSheet(token) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${SESSIONS_SHEET_NAME}!A:B`; // emailAddress and sessionToken columns
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length < 2) return null;
    const header = rows[0];
    const emailIndex = header.indexOf('emailAddress');
    const tokenIndex = header.indexOf('sessionToken');
    const sessionRow = rows.slice(1).find((row)=>row[tokenIndex] === token);
    if (sessionRow) {
        return {
            email: sessionRow[emailIndex]
        };
    }
    return null;
}
async function deleteSessionByToken(token) {
    const { sheetId, rowIndex } = await findRowIndexByToken(token);
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    await sheets.spreadsheets.batchUpdate({
        spreadsheetId: SPREADSHEET_ID,
        resource: {
            requests: [
                {
                    deleteDimension: {
                        range: {
                            sheetId,
                            dimension: 'ROWS',
                            startIndex: rowIndex,
                            endIndex: rowIndex + 1
                        }
                    }
                }
            ]
        }
    });
    console.log(`[Sessions] Deleted session with token ending in ...${token.slice(-4)}`);
}
async function deleteAllOtherSessionsByToken(currentToken) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${SESSIONS_SHEET_NAME}!A:E`;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length < 2) return;
    const header = rows[0];
    const tokenIndex = header.indexOf('sessionToken');
    const emailIndex = header.indexOf('emailAddress');
    const currentUserRow = rows.find((row)=>row[tokenIndex] === currentToken);
    if (!currentUserRow) return;
    const currentUserEmail = currentUserRow[emailIndex];
    const sheetId = await getSheetId(SPREADSHEET_ID, SESSIONS_SHEET_NAME);
    if (sheetId === null) throw new Error('Could not find sheet ID.');
    const deleteRequests = rows.map((row, index)=>({
            row,
            index
        })).filter(({ row })=>row[emailIndex] === currentUserEmail && row[tokenIndex] !== currentToken).map(({ index })=>({
            deleteDimension: {
                range: {
                    sheetId,
                    dimension: 'ROWS',
                    startIndex: index,
                    endIndex: index + 1
                }
            }
        })).reverse();
    if (deleteRequests.length > 0) {
        await sheets.spreadsheets.batchUpdate({
            spreadsheetId: SPREADSHEET_ID,
            resource: {
                requests: deleteRequests
            }
        });
        console.log(`[Sessions] Deleted ${deleteRequests.length} other session(s) for user ${currentUserEmail}`);
    }
}
async function deleteAllSessionsByEmail(email) {
    const sheets = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].sheets({
        version: 'v4',
        auth: await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])()
    });
    const range = `${SESSIONS_SHEET_NAME}!A:E`;
    const response = await sheets.spreadsheets.values.get({
        spreadsheetId: SPREADSHEET_ID,
        range
    });
    const rows = response.data.values;
    if (!rows || rows.length < 2) return;
    const header = rows[0];
    const emailIndex = header.indexOf('emailAddress');
    const sheetId = await getSheetId(SPREADSHEET_ID, SESSIONS_SHEET_NAME);
    if (sheetId === null) throw new Error('Could not find sheet ID.');
    const deleteRequests = rows.map((row, index)=>({
            row,
            index
        })).filter(({ row, index })=>index > 0 && row[emailIndex] === email).map(({ index })=>({
            deleteDimension: {
                range: {
                    sheetId,
                    dimension: 'ROWS',
                    startIndex: index,
                    endIndex: index + 1
                }
            }
        })).reverse(); // Reverse to handle shifting indices correctly
    if (deleteRequests.length > 0) {
        await sheets.spreadsheets.batchUpdate({
            spreadsheetId: SPREADSHEET_ID,
            resource: {
                requests: deleteRequests
            }
        });
        console.log(`[Sessions] Deleted ${deleteRequests.length} session(s) for user ${email}`);
    }
}
}}),
"[project]/src/lib/drive.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"00186ae8b46ba208c20a4a809212c1f3e6948fe1b2":"getInitialPageTokenForDrive","4019d8efc0e8739c514bfb3847f6eef6107aca4d72":"createFolderInDrive","40b059e63060f3f4feea26611d7aec8c3ec0ede92f":"downloadFileFromDrive","40dd2f09e524554b4ec3a9fff80a021fad2531abc0":"listDatFiles","40eb3992284d3f345830502ed25bef9bf64111ffac":"deleteFileFromDrive","60f30c24add5ece81b8a4e4f22fb29dca30abc29de":"listChangesSincePageToken","70864395bb092dc39044827f4dcf80a5be65f97fdf":"checkFileExists","7cada598f594d88c11337b2248ef7320b7b540f236":"uploadFileToDrive"},"",""] */ __turbopack_context__.s({
    "checkFileExists": (()=>checkFileExists),
    "createFolderInDrive": (()=>createFolderInDrive),
    "deleteFileFromDrive": (()=>deleteFileFromDrive),
    "downloadFileFromDrive": (()=>downloadFileFromDrive),
    "getInitialPageTokenForDrive": (()=>getInitialPageTokenForDrive),
    "listChangesSincePageToken": (()=>listChangesSincePageToken),
    "listDatFiles": (()=>listDatFiles),
    "uploadFileToDrive": (()=>uploadFileToDrive)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/googleapis/build/src/index.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/drive-oauth.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
;
const { GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID } = process.env;
async function getDriveClient() {
    const oauth2Client = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2d$oauth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getOAuth2Client"])();
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["google"].drive({
        version: 'v3',
        auth: oauth2Client
    });
}
async function createFolderInDrive(userEmail) {
    if (!GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID) {
        throw new Error('GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID is not configured in .env');
    }
    const drive = await getDriveClient();
    const fileMetadata = {
        name: userEmail,
        mimeType: 'application/vnd.google-apps.folder',
        parents: [
            GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID
        ]
    };
    try {
        const file = await drive.files.create({
            resource: fileMetadata,
            fields: 'id'
        });
        console.log(`[Drive] Created user folder "${userEmail}" with ID: ${file.data.id}`);
        return file.data.id;
    } catch (error) {
        console.error(`[Drive] Error creating user folder "${userEmail}":`, error);
        throw error;
    }
}
async function findFolder(drive, name, parentId) {
    const query = `mimeType='application/vnd.google-apps.folder' and name='${name.replace(/'/g, "\\'")}' and '${parentId}' in parents and trashed=false`;
    try {
        const res = await drive.files.list({
            q: query,
            fields: 'files(id)',
            spaces: 'drive',
            pageSize: 1
        });
        if (res.data.files && res.data.files.length > 0 && res.data.files[0].id) {
            return res.data.files[0].id;
        }
        return null;
    } catch (error) {
        console.error(`[Drive] Error finding folder "${name}" in parent "${parentId}":`, error);
        return null;
    }
}
async function createFolder(drive, name, parentId) {
    const fileMetadata = {
        name: name,
        mimeType: 'application/vnd.google-apps.folder',
        parents: [
            parentId
        ]
    };
    const folder = await drive.files.create({
        resource: fileMetadata,
        fields: 'id'
    });
    if (!folder.data.id) throw new Error(`Failed to create folder "${name}"`);
    console.log(`[Drive] Created folder "${name}" with ID: ${folder.data.id}.`);
    return folder.data.id;
}
async function getOrCreateFolderByPath(drive, rootFolderId, path) {
    let currentParentId = rootFolderId;
    const datFilesFolderName = 'DATFiles';
    let datFilesFolderId = await findFolder(drive, datFilesFolderName, currentParentId);
    if (!datFilesFolderId) {
        datFilesFolderId = await createFolder(drive, datFilesFolderName, currentParentId);
    }
    currentParentId = datFilesFolderId;
    for (const folderName of path){
        let nextFolderId = await findFolder(drive, folderName, currentParentId);
        if (!nextFolderId) {
            nextFolderId = await createFolder(drive, folderName, currentParentId);
        }
        currentParentId = nextFolderId;
    }
    return currentParentId;
}
async function checkFileExists(fileName, rootFolderId, path) {
    try {
        const drive = await getDriveClient();
        const finalFolderId = await getOrCreateFolderByPath(drive, rootFolderId, path);
        const query = `name='${fileName.replace(/'/g, "\\'")}' and '${finalFolderId}' in parents and trashed=false`;
        const res = await drive.files.list({
            q: query,
            fields: 'files(id)',
            pageSize: 1
        });
        return !!(res.data.files && res.data.files.length > 0);
    } catch (error) {
        console.error(`[Drive] Error checking if file '${fileName}' exists:`, error);
        return false;
    }
}
async function uploadFileToDrive(fileName, fileContent, rootFolderId, path, overwrite = false) {
    try {
        const drive = await getDriveClient();
        const finalFolderId = await getOrCreateFolderByPath(drive, rootFolderId, path);
        console.log(`[Drive] Final folder for upload is '${finalFolderId}'.`);
        const media = {
            mimeType: 'text/plain',
            body: fileContent
        };
        const fileFields = 'id, name, modifiedTime';
        if (overwrite) {
            const query = `name='${fileName.replace(/'/g, "\\'")}' and '${finalFolderId}' in parents and trashed=false`;
            const res = await drive.files.list({
                q: query,
                fields: 'files(id)',
                pageSize: 1
            });
            if (res.data.files && res.data.files.length > 0 && res.data.files[0].id) {
                const fileId = res.data.files[0].id;
                console.log(`[Drive] Overwriting existing file '${fileName}' with ID: ${fileId}`);
                const updatedFile = await drive.files.update({
                    fileId: fileId,
                    media: media,
                    fields: fileFields
                });
                if (!updatedFile.data.id || !updatedFile.data.name || !updatedFile.data.modifiedTime) {
                    throw new Error('File update did not return complete data.');
                }
                return {
                    id: updatedFile.data.id,
                    name: updatedFile.data.name,
                    path: path.join(' / '),
                    modifiedTime: updatedFile.data.modifiedTime
                };
            }
        }
        // If not overwriting or file doesn't exist, create a new one.
        const fileMetadata = {
            name: fileName,
            parents: [
                finalFolderId
            ]
        };
        const file = await drive.files.create({
            requestBody: fileMetadata,
            media: media,
            fields: fileFields
        });
        if (!file.data.id || !file.data.name || !file.data.modifiedTime) {
            throw new Error('File creation did not return complete data.');
        }
        console.log(`[Drive] Successfully uploaded new file '${fileName}', File ID: ${file.data.id}`);
        return {
            id: file.data.id,
            name: file.data.name,
            path: path.join(' / '),
            modifiedTime: file.data.modifiedTime
        };
    } catch (error) {
        const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred.';
        console.error(`[Drive] Failed to upload file '${fileName}':`, errorMessage);
        throw new Error(`Failed to upload file to Google Drive: ${errorMessage}`);
    }
}
async function listDatFiles(rootFolderId) {
    const drive = await getDriveClient();
    const datFilesFolderId = await findFolder(drive, "DATFiles", rootFolderId);
    if (!datFilesFolderId) {
        console.log('[Drive] "DATFiles" folder not found, returning empty list.');
        return {
            files: [],
            folderIds: []
        };
    }
    const folderMap = new Map();
    const allFiles = [];
    const allFolderIds = new Set([
        datFilesFolderId
    ]);
    async function walkFolders(folderId) {
        let pageToken = undefined;
        do {
            const res = await drive.files.list({
                q: `'${folderId}' in parents and trashed=false`,
                fields: "nextPageToken, files(id, name, mimeType, modifiedTime, parents)",
                spaces: "drive",
                pageToken,
                pageSize: 1000
            });
            const folderPromises = [];
            if (res.data.files) {
                for (const file of res.data.files){
                    if (file.mimeType === "application/vnd.google-apps.folder") {
                        if (file.id) {
                            allFolderIds.add(file.id);
                            if (file.parents && file.parents.length > 0) {
                                folderMap.set(file.id, {
                                    name: file.name,
                                    parentId: file.parents[0]
                                });
                            }
                            folderPromises.push(walkFolders(file.id));
                        }
                    } else if (file.name?.endsWith(".DAT")) {
                        let pathParts = [];
                        let currentParentId = file.parents?.[0];
                        while(currentParentId && currentParentId !== datFilesFolderId){
                            const parentFolder = folderMap.get(currentParentId);
                            if (parentFolder) {
                                pathParts.unshift(parentFolder.name);
                                currentParentId = parentFolder.parentId;
                            } else {
                                break;
                            }
                        }
                        allFiles.push({
                            id: file.id,
                            name: file.name,
                            path: pathParts.join(" / "),
                            modifiedTime: file.modifiedTime
                        });
                    }
                }
            }
            await Promise.all(folderPromises);
            pageToken = res.data.nextPageToken;
        }while (pageToken)
    }
    folderMap.set(datFilesFolderId, {
        name: "DATFiles",
        parentId: rootFolderId
    });
    await walkFolders(datFilesFolderId);
    return {
        files: allFiles,
        folderIds: Array.from(allFolderIds)
    };
}
async function downloadFileFromDrive(fileId) {
    const drive = await getDriveClient();
    try {
        const response = await drive.files.get({
            fileId: fileId,
            alt: 'media'
        }, {
            responseType: 'stream'
        });
        return new Promise((resolve, reject)=>{
            let buf = [];
            response.data.on('data', (chunk)=>buf.push(chunk)).on('end', ()=>{
                const content = Buffer.concat(buf).toString();
                resolve(content);
            }).on('error', (err)=>{
                console.error(`[Drive] Error downloading file ${fileId}:`, err);
                reject(err);
            });
        });
    } catch (error) {
        if (error.code === 404) {
            throw new Error('File not found.');
        }
        console.error(`[Drive] API error on download for file ${fileId}:`, error);
        throw error;
    }
}
async function deleteFileFromDrive(fileId) {
    const drive = await getDriveClient();
    try {
        await drive.files.delete({
            fileId: fileId
        });
        console.log(`[Drive] Successfully deleted file with ID: ${fileId}`);
    } catch (error) {
        if (error.code === 404) {
            throw new Error('File not found.');
        }
        console.error(`[Drive] Error deleting file ${fileId}:`, error);
        throw error;
    }
}
async function getInitialPageTokenForDrive() {
    const drive = await getDriveClient();
    try {
        const response = await drive.changes.getStartPageToken({
            supportsAllDrives: true
        });
        if (!response.data.startPageToken) {
            throw new Error('Failed to get a start page token.');
        }
        return response.data.startPageToken;
    } catch (error) {
        console.error('[Drive] Error getting initial page token:', error);
        throw error;
    }
}
async function listChangesSincePageToken(allFolderIds, pageToken) {
    const drive = await getDriveClient();
    let newPageToken = pageToken;
    let hasRelevantChanges = false;
    let lastResponse;
    try {
        const folderIdSet = new Set(allFolderIds);
        do {
            lastResponse = await drive.changes.list({
                pageToken: newPageToken,
                spaces: "drive",
                fields: "nextPageToken, newStartPageToken, changes(fileId, removed, file(name, parents, mimeType))",
                includeItemsFromAllDrives: true,
                supportsAllDrives: true
            });
            const changes = lastResponse.data.changes || [];
            if (changes.length > 0) {
                const relevantChange = changes.some((c)=>{
                    // A file was deleted. We can't know its parent, so we must refresh.
                    if (c.removed) return true;
                    if (c.file && c.file.parents) {
                        // Check if the file's parent is one of our tracked folders.
                        const parentIsTracked = c.file.parents.some((p)=>folderIdSet.has(p));
                        if (parentIsTracked) {
                            // It's a folder or a .DAT file within our structure
                            if (c.file.mimeType === 'application/vnd.google-apps.folder' || c.file.name?.toUpperCase().endsWith(".DAT")) {
                                return true;
                            }
                        }
                    }
                    return false;
                });
                if (relevantChange) {
                    hasRelevantChanges = true;
                    break;
                }
            }
            if (lastResponse.data.nextPageToken) {
                newPageToken = lastResponse.data.nextPageToken;
            } else {
                break;
            }
        }while (lastResponse.data.nextPageToken)
        const finalToken = lastResponse.data.newStartPageToken || newPageToken;
        return {
            hasChanges: hasRelevantChanges,
            newPageToken: finalToken
        };
    } catch (error) {
        console.error("[Drive] Error listing changes:", error);
        return {
            hasChanges: false,
            newPageToken: pageToken
        };
    }
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    createFolderInDrive,
    checkFileExists,
    uploadFileToDrive,
    listDatFiles,
    downloadFileFromDrive,
    deleteFileFromDrive,
    getInitialPageTokenForDrive,
    listChangesSincePageToken
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(createFolderInDrive, "4019d8efc0e8739c514bfb3847f6eef6107aca4d72", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(checkFileExists, "70864395bb092dc39044827f4dcf80a5be65f97fdf", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(uploadFileToDrive, "7cada598f594d88c11337b2248ef7320b7b540f236", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(listDatFiles, "40dd2f09e524554b4ec3a9fff80a021fad2531abc0", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(downloadFileFromDrive, "40b059e63060f3f4feea26611d7aec8c3ec0ede92f", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(deleteFileFromDrive, "40eb3992284d3f345830502ed25bef9bf64111ffac", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(getInitialPageTokenForDrive, "00186ae8b46ba208c20a4a809212c1f3e6948fe1b2", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(listChangesSincePageToken, "60f30c24add5ece81b8a4e4f22fb29dca30abc29de", null);
}}),
"[externals]/dns [external] (dns, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("dns", () => require("dns"));

module.exports = mod;
}}),
"[project]/src/lib/email.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"60a1dc70aa5a2013eb181161c0f9a5c4fabdb0d153":"sendPasswordResetEmail","70560c40f4d2cc065f1d58a4b24cac873fa71403bb":"sendVerificationEmail"},"",""] */ __turbopack_context__.s({
    "sendPasswordResetEmail": (()=>sendPasswordResetEmail),
    "sendVerificationEmail": (()=>sendVerificationEmail)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nodemailer$2f$lib$2f$nodemailer$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/nodemailer/lib/nodemailer.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
const { EMAIL_SERVER_HOST, EMAIL_SERVER_PORT, EMAIL_SERVER_USER, EMAIL_SERVER_PASSWORD, EMAIL_FROM } = process.env;
const transporter = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$nodemailer$2f$lib$2f$nodemailer$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["default"].createTransport({
    host: EMAIL_SERVER_HOST,
    port: Number(EMAIL_SERVER_PORT),
    secure: true,
    auth: {
        user: EMAIL_SERVER_USER,
        pass: EMAIL_SERVER_PASSWORD
    },
    requireTLS: true
});
async function sendVerificationEmail(to, name, link) {
    const mailOptions = {
        from: EMAIL_FROM,
        to,
        subject: 'DATGenie: Verify Your Email Address',
        html: `
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>DATGenie Account Verification</title>
                <style>
                    body {
                        margin: 0;
                        padding: 0;
                        font-family: 'Inter', Arial, sans-serif;
                        background-color: #E0F7FA;
                    }
                    .container {
                        padding: 20px;
                        background-color: #E0F7FA;
                    }
                    .card {
                        background-color: #ffffff;
                        border-radius: 8px;
                        padding: 40px;
                        margin: 40px auto;
                        max-width: 600px;
                        text-align: center;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                    }
                    .logo {
                        margin-bottom: 20px;
                    }
                    h2 {
                        color: #333333;
                        font-size: 24px;
                        margin-bottom: 10px;
                    }
                    p {
                        color: #555555;
                        font-size: 16px;
                        line-height: 1.5;
                        margin-bottom: 20px;
                    }
                    .button {
                        background-color: #29ABE2;
                        color: #ffffff !important;
                        padding: 8px 25px;
                        text-decoration: none;
                        border-radius: 5px;
                        display: inline-block;
                        font-weight: bold;
                        font-size: 16px;
                    }
                    .footer {
                        text-align: center;
                        font-size: 12px;
                        color: #888888;
                        margin-top: 20px;
                    }
                    .note {
                        font-size: 12px; 
                        color: #555;
                        margin-top: 30px;
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="card">
                        <img src="https://placehold.co/60x60/29ABE2/FFFFFF?text=LOGO" alt="DATGenie Logo" width="60" class="logo">
                        <h2>Hello ${name},</h2>
                        <p>Thank you for signing up for DATGenie! To complete your registration, please verify your email address by clicking the button below:</p>
                        <a href="${link}" class="button" style="color: #ffffff;">Verify</a>
                        <p class="note">Please note: This verification link is valid for one hour only.</p>
                    </div>
                    <div class="footer">
                        <p>If you did not sign up for this account, you can safely ignore this email.</p>
                        <p>&copy; ${new Date().getFullYear()} DATGenie. All Rights Reserved.</p>
                    </div>
                </div>
            </body>
            </html>
        `
    };
    try {
        await transporter.sendMail(mailOptions);
        console.log('Verification email sent to:', to);
    } catch (error) {
        console.error('Error sending verification email:', error);
        throw new Error('Could not send verification email.');
    }
}
async function sendPasswordResetEmail(to, link) {
    const mailOptions = {
        from: EMAIL_FROM,
        to,
        subject: 'DATGenie: Password Reset Request',
        html: `
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>DATGenie Password Reset</title>
                <style>
                    body {
                        margin: 0;
                        padding: 0;
                        font-family: 'Inter', Arial, sans-serif;
                        background-color: #E0F7FA;
                    }
                    .container {
                        padding: 20px;
                        background-color: #E0F7FA;
                    }
                    .card {
                        background-color: #ffffff;
                        border-radius: 8px;
                        padding: 40px;
                        margin: 40px auto;
                        max-width: 600px;
                        text-align: center;
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                    }
                    .logo {
                        margin-bottom: 20px;
                    }
                    h2 {
                        color: #333333;
                        font-size: 24px;
                        margin-bottom: 10px;
                    }
                    p {
                        color: #555555;
                        font-size: 16px;
                        line-height: 1.5;
                        margin-bottom: 20px;
                    }
                    .button {
                        background-color: #29ABE2;
                        color: #ffffff !important;
                        padding: 8px 25px;
                        text-decoration: none;
                        border-radius: 5px;
                        display: inline-block;
                        font-weight: bold;
                        font-size: 16px;
                    }
                    .footer {
                        text-align: center;
                        font-size: 12px;
                        color: #888888;
                        margin-top: 20px;
                    }
                    .note {
                        font-size: 12px; 
                        color: #555;
                        margin-top: 30px;
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <div class="card">
                        <img src="https://placehold.co/60x60/29ABE2/FFFFFF?text=LOGO" alt="DATGenie Logo" width="60" class="logo">
                        <h2>Password Reset Request</h2>
                        <p>We received a request to reset your password. If you did not make this request, you can ignore this email. Otherwise, you can reset your password using this link:</p>
                        <a href="${link}" class="button" style="color: #ffffff;">Reset Password</a>
                        <p class="note">Please note: This password reset link is valid for one hour only.</p>
                    </div>
                    <div class="footer">
                        <p>&copy; ${new Date().getFullYear()} DATGenie. All Rights Reserved.</p>
                    </div>
                </div>
            </body>
            </html>
        `
    };
    try {
        await transporter.sendMail(mailOptions);
        console.log('Password reset email sent to:', to);
    } catch (error) {
        console.error('Error sending password reset email:', error);
        throw new Error('Could not send password reset email.');
    }
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    sendVerificationEmail,
    sendPasswordResetEmail
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(sendVerificationEmail, "70560c40f4d2cc065f1d58a4b24cac873fa71403bb", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(sendPasswordResetEmail, "60a1dc70aa5a2013eb181161c0f9a5c4fabdb0d153", null);
}}),
"[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"0077798b1627f8549856e5ef771e5b5197af078b59":"logoutUser","4042067a83252849717e7a5b3e62744a492bf4012c":"loginUser","40ae828c6e9f5db562a01c76329ee06eccca978d8b":"verifyUserAccount","601c69a0cf1eb35745f684de1abc78b63dea440da2":"resetUserPassword","60c6312d939e0f94e11390cab80586edc945c86980":"signUpUser","60fb327b88e41260b914a55950525e6a28b471e0a0":"requestPasswordReset"},"",""] */ __turbopack_context__.s({
    "loginUser": (()=>loginUser),
    "logoutUser": (()=>logoutUser),
    "requestPasswordReset": (()=>requestPasswordReset),
    "resetUserPassword": (()=>resetUserPassword),
    "signUpUser": (()=>signUpUser),
    "verifyUserAccount": (()=>verifyUserAccount)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/googlesheets.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/drive.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$email$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/email.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/headers.js [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/crypto [external] (crypto, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-rsc] (ecmascript)");
;
;
;
;
;
;
;
;
const AuthResultSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    success: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean(),
    error: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().nullable(),
    user: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
        userName: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string(),
        email: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        databaseId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional(),
        folderId: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].string().optional()
    }).nullable()
});
async function signUpUser(userData, origin) {
    try {
        const users = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getAllUsers"])();
        const userNameExists = users.some((user)=>user.userName.toLowerCase() === userData.userName.toLowerCase());
        if (userNameExists) {
            return {
                success: false,
                error: 'This username is already taken. Please choose another one.'
            };
        }
        const emailExists = users.some((user)=>user.emailAddress.toLowerCase() === userData.email.toLowerCase());
        if (emailExists) {
            return {
                success: false,
                error: 'An account with this email address already exists.'
            };
        }
        const verificationToken = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["randomUUID"])();
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["addPendingUser"])({
            ...userData,
            token: verificationToken,
            type: 'signup',
            expires: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString()
        });
        const verificationLink = `${origin}/verify?token=${verificationToken}`;
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$email$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["sendVerificationEmail"])(userData.email, userData.userName, verificationLink);
        return {
            success: true,
            error: null
        };
    } catch (e) {
        console.error('Error during sign up:', e);
        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';
        return {
            success: false,
            error: `Sign up failed: ${errorMessage}`
        };
    }
}
async function verifyUserAccount(token) {
    try {
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getPendingUserByToken"])(token);
        if (!result) {
            return {
                success: false,
                error: 'This verification link is invalid or has expired.'
            };
        }
        const { user: pendingUser, rowIndex } = result;
        if (new Date(pendingUser.expires) < new Date()) {
            // Fire and forget deletion, no need to wait
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["deletePendingUserByRow"])(rowIndex).catch((err)=>{
                console.error(`[Background] Failed to delete expired pending user at row ${rowIndex}:`, err);
            });
            return {
                success: false,
                error: 'This verification link has expired. Please sign up again.'
            };
        }
        const folderId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createFolderInDrive"])(pendingUser.email);
        const databaseId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createDatabaseSheet"])(pendingUser.email, folderId);
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["addUser"])({
            email: pendingUser.email,
            userName: pendingUser.userName,
            password: pendingUser.password,
            folderId: folderId,
            databaseId: databaseId
        });
        // Fire-and-forget the cleanup operation.
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["deletePendingUserByRow"])(rowIndex).catch((err)=>{
            console.error(`[Background] Failed to delete verified pending user at row ${rowIndex}:`, err);
        });
        return {
            success: true
        };
    } catch (e) {
        console.error(`Error verifying user with token ${token}:`, e);
        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';
        return {
            success: false,
            error: `Account verification failed: ${errorMessage}`
        };
    }
}
async function loginUser(credentials) {
    try {
        const users = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getAllUsers"])();
        const user = users.find((u)=>u.userName === credentials.userName && u.pwd === credentials.password);
        if (user) {
            let folderId = user.folderId;
            let databaseId = user.databaseId;
            if (!folderId) {
                console.log(`User ${user.userName} does not have a folderId. Creating one now.`);
                folderId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$drive$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createFolderInDrive"])(user.emailAddress);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["updateUserFolderId"])(user.userName, folderId);
                console.log(`Successfully created and assigned folderId ${folderId} to user ${user.userName}.`);
            }
            if (!databaseId) {
                console.log(`User ${user.userName} does not have a databaseId. Creating one now.`);
                databaseId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["createDatabaseSheet"])(user.emailAddress, folderId);
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["updateUserDatabaseId"])(user.userName, databaseId);
                console.log(`Successfully created and assigned databaseId ${databaseId} to user ${user.userName}.`);
            }
            if (databaseId) {
                try {
                    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getAllHeaderDataFromSheet"])(databaseId);
                } catch (sheetError) {
                    console.error(`Failed to access sheet with ID ${databaseId}`, sheetError);
                    return {
                        success: false,
                        error: 'Failed to retrieve data from Google Sheet. Check Sheet ID and permissions.',
                        user: null
                    };
                }
            }
            const sessionToken = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["randomUUID"])();
            const headersList = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["headers"])();
            const ipAddress = headersList.get('x-forwarded-for') || 'Unknown';
            const deviceInfo = headersList.get('user-agent') || 'Unknown';
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["addSessionToSheet"])({
                emailAddress: user.emailAddress,
                sessionToken,
                ipAddress,
                deviceInfo
            });
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["cookies"])().set('sessionToken', sessionToken, {
                httpOnly: true,
                secure: ("TURBOPACK compile-time value", "development") === 'production',
                maxAge: 60 * 60 * 24 * 7,
                path: '/'
            });
            return {
                success: true,
                error: null,
                user: {
                    userName: user.userName,
                    email: user.emailAddress,
                    databaseId: databaseId,
                    folderId: folderId
                }
            };
        } else {
            return {
                success: false,
                error: 'Invalid username or password.',
                user: null
            };
        }
    } catch (e) {
        console.error('Error logging in user:', e);
        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';
        return {
            success: false,
            error: `Failed to login: ${errorMessage}`,
            user: null
        };
    }
}
async function requestPasswordReset(email, origin) {
    try {
        const users = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getAllUsers"])();
        const userExists = users.some((user)=>user.emailAddress.toLowerCase() === email.toLowerCase());
        if (!userExists) {
            return {
                success: false,
                error: 'This email is not registered with an account.'
            };
        }
        const verificationToken = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$crypto__$5b$external$5d$__$28$crypto$2c$__cjs$29$__["randomUUID"])();
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["addPendingUser"])({
            email: email,
            token: verificationToken,
            type: 'forgotpassword',
            expires: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString()
        });
        const resetLink = `${origin}/reset-password?token=${verificationToken}`;
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$email$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["sendPasswordResetEmail"])(email, resetLink);
        return {
            success: true
        };
    } catch (e) {
        console.error('Error during password reset request:', e);
        // We return a generic error message to the user, but log the specific error.
        return {
            success: false,
            error: 'An unexpected error occurred. Please try again.'
        };
    }
}
async function resetUserPassword(token, newPassword) {
    try {
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["getPendingUserByToken"])(token);
        if (!result) {
            return {
                success: false,
                error: 'This password reset link is invalid or has expired.'
            };
        }
        const { user: pendingUser, rowIndex } = result;
        if (new Date(pendingUser.expires) < new Date()) {
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["deletePendingUserByRow"])(rowIndex).catch((err)=>{
                console.error(`[Background] Failed to delete expired pending user at row ${rowIndex}:`, err);
            });
            return {
                success: false,
                error: 'This password reset link has expired. Please request a new one.'
            };
        }
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["updateUserPasswordByEmail"])(pendingUser.email, newPassword);
        // Security measure: Log out all active sessions for this user.
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["deleteAllSessionsByEmail"])(pendingUser.email);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["deletePendingUserByRow"])(rowIndex).catch((err)=>{
            console.error(`[Background] Failed to delete verified pending user at row ${rowIndex}:`, err);
        });
        return {
            success: true
        };
    } catch (e) {
        console.error(`Error resetting password with token ${token}:`, e);
        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';
        return {
            success: false,
            error: `Password reset failed: ${errorMessage}`
        };
    }
}
const LogoutResultSchema = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].object({
    success: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["z"].boolean()
});
async function logoutUser() {
    const sessionToken = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["cookies"])().get('sessionToken')?.value;
    if (sessionToken) {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$googlesheets$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["deleteSessionByToken"])(sessionToken);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$headers$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["cookies"])().delete('sessionToken');
    }
    return {
        success: true
    };
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    signUpUser,
    verifyUserAccount,
    loginUser,
    requestPasswordReset,
    resetUserPassword,
    logoutUser
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(signUpUser, "60c6312d939e0f94e11390cab80586edc945c86980", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(verifyUserAccount, "40ae828c6e9f5db562a01c76329ee06eccca978d8b", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(loginUser, "4042067a83252849717e7a5b3e62744a492bf4012c", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(requestPasswordReset, "60fb327b88e41260b914a55950525e6a28b471e0a0", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(resetUserPassword, "601c69a0cf1eb35745f684de1abc78b63dea440da2", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerServerReference"])(logoutUser, "0077798b1627f8549856e5ef771e5b5197af078b59", null);
}}),
"[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => \"[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <locals>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)");
;
}}),
"[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => \"[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <module evaluation>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f2e$next$2d$internal$2f$server$2f$app$2f$login$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i('[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => "[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <locals>');
}}),
"[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => \"[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript) <exports>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "4042067a83252849717e7a5b3e62744a492bf4012c": (()=>__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["loginUser"])
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f2e$next$2d$internal$2f$server$2f$app$2f$login$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i('[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => "[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <locals>');
}}),
"[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => \"[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)\" } [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "4042067a83252849717e7a5b3e62744a492bf4012c": (()=>__TURBOPACK__imported__module__$5b$project$5d2f2e$next$2d$internal$2f$server$2f$app$2f$login$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$exports$3e$__["4042067a83252849717e7a5b3e62744a492bf4012c"])
});
var __TURBOPACK__imported__module__$5b$project$5d2f2e$next$2d$internal$2f$server$2f$app$2f$login$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i('[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => "[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <module evaluation>');
var __TURBOPACK__imported__module__$5b$project$5d2f2e$next$2d$internal$2f$server$2f$app$2f$login$2f$page$2f$actions$2e$js__$7b$__ACTIONS_MODULE0__$3d3e$__$225b$project$5d2f$src$2f$lib$2f$actions$2f$auth$2e$ts__$5b$app$2d$rsc$5d$__$28$ecmascript$2922$__$7d$__$5b$app$2d$rsc$5d$__$28$server__actions__loader$2c$__ecmascript$29$__$3c$exports$3e$__ = __turbopack_context__.i('[project]/.next-internal/server/app/login/page/actions.js { ACTIONS_MODULE0 => "[project]/src/lib/actions/auth.ts [app-rsc] (ecmascript)" } [app-rsc] (server actions loader, ecmascript) <exports>');
}}),
"[project]/src/app/favicon.ico.mjs { IMAGE => \"[project]/src/app/favicon.ico (static in ecmascript)\" } [app-rsc] (structured image object, ecmascript, Next.js server component)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.n(__turbopack_context__.i("[project]/src/app/favicon.ico.mjs { IMAGE => \"[project]/src/app/favicon.ico (static in ecmascript)\" } [app-rsc] (structured image object, ecmascript)"));
}}),
"[project]/src/app/layout.tsx [app-rsc] (ecmascript, Next.js server component)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.n(__turbopack_context__.i("[project]/src/app/layout.tsx [app-rsc] (ecmascript)"));
}}),
"[project]/src/app/login/page.tsx (client reference/proxy) <module evaluation>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server-edge.js [app-rsc] (ecmascript)");
;
const __TURBOPACK__default__export__ = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call the default export of [project]/src/app/login/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/src/app/login/page.tsx <module evaluation>", "default");
}}),
"[project]/src/app/login/page.tsx (client reference/proxy)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>__TURBOPACK__default__export__)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/route-modules/app-page/vendored/rsc/react-server-dom-turbopack-server-edge.js [app-rsc] (ecmascript)");
;
const __TURBOPACK__default__export__ = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$route$2d$modules$2f$app$2d$page$2f$vendored$2f$rsc$2f$react$2d$server$2d$dom$2d$turbopack$2d$server$2d$edge$2e$js__$5b$app$2d$rsc$5d$__$28$ecmascript$29$__["registerClientReference"])(function() {
    throw new Error("Attempted to call the default export of [project]/src/app/login/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.");
}, "[project]/src/app/login/page.tsx", "default");
}}),
"[project]/src/app/login/page.tsx [app-rsc] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$login$2f$page$2e$tsx__$28$client__reference$2f$proxy$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/src/app/login/page.tsx (client reference/proxy) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$login$2f$page$2e$tsx__$28$client__reference$2f$proxy$29$__ = __turbopack_context__.i("[project]/src/app/login/page.tsx (client reference/proxy)");
;
__turbopack_context__.n(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$login$2f$page$2e$tsx__$28$client__reference$2f$proxy$29$__);
}}),
"[project]/src/app/login/page.tsx [app-rsc] (ecmascript, Next.js server component)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.n(__turbopack_context__.i("[project]/src/app/login/page.tsx [app-rsc] (ecmascript)"));
}}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__abf92c9d._.js.map
{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 183, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/drive-oauth.ts"],"sourcesContent":["\nimport { google } from 'googleapis';\n\nconst {\n  GOOGLE_OAUTH_CLIENT_ID,\n  GOOGLE_OAUTH_CLIENT_SECRET,\n  GOOGLE_OAUTH_REFRESH_TOKEN,\n} = process.env;\n\nif (!GOOGLE_OAUTH_CLIENT_ID || !GOOGLE_OAUTH_CLIENT_SECRET || !GOOGLE_OAUTH_REFRESH_TOKEN) {\n  // This check is important but shouldn't throw an error that crashes the server on startup,\n  // as the credentials might not be used on every page load.\n  // We will let the functions that use it handle the error.\n  console.warn('Google OAuth credentials are not fully configured in .env. Some Drive/Sheets features may not work.');\n}\n\n// This is a fixed value for web applications\nconst GOOGLE_OAUTH_REDIRECT_URI = 'https://developers.google.com/oauthplayground';\n\nlet oauth2Client: import('google-auth-library').OAuth2Client | null = null;\n\nexport async function getOAuth2Client() {\n  // Add the check here to provide a clear error when the credentials are used.\n  if (!GOOGLE_OAUTH_CLIENT_ID || !GOOGLE_OAUTH_CLIENT_SECRET || !GOOGLE_OAUTH_REFRESH_TOKEN) {\n    throw new Error('Google OAuth credentials (CLIENT_ID, CLIENT_SECRET, REFRESH_TOKEN) must be configured in your .env file.');\n  }\n  \n  if (oauth2Client) {\n    // Check if the token is about to expire (within 60 seconds) and refresh if needed\n    if (oauth2Client.credentials.expiry_date && oauth2Client.credentials.expiry_date < (Date.now() + 60 * 1000)) {\n        console.log('[OAuth] Access token expiring soon, refreshing...');\n        await oauth2Client.refreshAccessToken();\n        console.log('[OAuth] Access token refreshed.');\n    }\n    return oauth2Client;\n  }\n\n  const client = new google.auth.OAuth2(\n    GOOGLE_OAUTH_CLIENT_ID,\n    GOOGLE_OAUTH_CLIENT_SECRET,\n    GOOGLE_OAUTH_REDIRECT_URI\n  );\n\n  client.setCredentials({\n    refresh_token: GOOGLE_OAUTH_REFRESH_TOKEN,\n  });\n\n  // Do an initial token refresh to get the access token\n  try {\n    console.log('[OAuth] Initializing and refreshing access token...');\n    await client.refreshAccessToken();\n    console.log('[OAuth] Initial token refreshed successfully.');\n  } catch (error) {\n    console.error('[OAuth] Failed to refresh access token:', error);\n    throw new Error('Failed to refresh access token. Check your refresh token and credentials.');\n  }\n\n  oauth2Client = client;\n  return oauth2Client;\n}\n\nexport async function getSheetsClient() {\n    const oauth2Client = await getOAuth2Client();\n    return google.sheets({ version: 'v4', auth: oauth2Client });\n}\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,EACJ,sBAAsB,EACtB,0BAA0B,EAC1B,0BAA0B,EAC3B,GAAG,QAAQ,GAAG;AAEf,IAAI,CAAC,0BAA0B,CAAC,8BAA8B,CAAC,4BAA4B;IACzF,2FAA2F;IAC3F,2DAA2D;IAC3D,0DAA0D;IAC1D,QAAQ,IAAI,CAAC;AACf;AAEA,6CAA6C;AAC7C,MAAM,4BAA4B;AAElC,IAAI,eAAkE;AAE/D,eAAe;IACpB,6EAA6E;IAC7E,IAAI,CAAC,0BAA0B,CAAC,8BAA8B,CAAC,4BAA4B;QACzF,MAAM,IAAI,MAAM;IAClB;IAEA,IAAI,cAAc;QAChB,kFAAkF;QAClF,IAAI,aAAa,WAAW,CAAC,WAAW,IAAI,aAAa,WAAW,CAAC,WAAW,GAAI,KAAK,GAAG,KAAK,KAAK,MAAO;YACzG,QAAQ,GAAG,CAAC;YACZ,MAAM,aAAa,kBAAkB;YACrC,QAAQ,GAAG,CAAC;QAChB;QACA,OAAO;IACT;IAEA,MAAM,SAAS,IAAI,mJAAA,CAAA,SAAM,CAAC,IAAI,CAAC,MAAM,CACnC,wBACA,4BACA;IAGF,OAAO,cAAc,CAAC;QACpB,eAAe;IACjB;IAEA,sDAAsD;IACtD,IAAI;QACF,QAAQ,GAAG,CAAC;QACZ,MAAM,OAAO,kBAAkB;QAC/B,QAAQ,GAAG,CAAC;IACd,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C;QACzD,MAAM,IAAI,MAAM;IAClB;IAEA,eAAe;IACf,OAAO;AACT;AAEO,eAAe;IAClB,MAAM,eAAe,MAAM;IAC3B,OAAO,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM;IAAa;AAC7D","debugId":null}},
    {"offset": {"line": 242, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/googlesheets.ts"],"sourcesContent":["\nimport { z } from 'zod';\nimport type { TaxProfile, UserUpdateData, SessionInfo } from './schemas';\nimport { getOAuth2Client } from './drive-oauth';\nimport { google } from 'googleapis';\n\nconst signupSchema = z.object({\n  userName: z.string(),\n  email: z.string().email(),\n  password: z.string(),\n});\n\nconst loginSchema = z.object({\n  userName: z.string(),\n  password: z.string(),\n});\n\nexport type SignupData = z.infer<typeof signupSchema>;\nexport type LoginData = z.infer<typeof loginSchema>;\n\n\nconst {\n  GOOGLE_SHEETS_SHEET_ID,\n  GOOGLE_SHEETS_DB_TEMPLATE_ID,\n  GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID\n} = process.env;\n\nif (!GOOGLE_SHEETS_SHEET_ID) {\n  throw new Error('GOOGLE_SHEETS_SHEET_ID is not configured in .env');\n}\nif (!GOOGLE_SHEETS_DB_TEMPLATE_ID) {\n    throw new Error('GOOGLE_SHEETS_DB_TEMPLATE_ID is not configured in .env')\n}\nif (!GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID) {\n  throw new Error('GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID is not configured in .env');\n}\n\nconst SPREADSHEET_ID = GOOGLE_SHEETS_SHEET_ID;\nconst TEMPLATE_SPREADSHEET_ID = GOOGLE_SHEETS_DB_TEMPLATE_ID;\nconst CREDENTIALS_SHEET_NAME = 'credentials';\nconst PENDING_VERIFICATIONS_SHEET_NAME = 'PendingVerifications';\nconst SESSIONS_SHEET_NAME = 'ActiveSessions';\n\nexport async function createDatabaseSheet(userEmail: string, parentFolderId: string): Promise<string> {\n    const oauth2Client = await getOAuth2Client();\n    const drive = google.drive({ version: 'v3', auth: oauth2Client });\n    const newSheetName = `Database - ${userEmail}`;\n    \n    try {\n        const copiedFile = await drive.files.copy({\n            fileId: TEMPLATE_SPREADSHEET_ID,\n            requestBody: {\n                name: newSheetName,\n                parents: [parentFolderId]\n            }\n        });\n\n        const newSpreadsheetId = copiedFile.data.id;\n        if (!newSpreadsheetId) {\n            throw new Error('Failed to get ID of the new spreadsheet.');\n        }\n\n        console.log(`[Sheets] Cloned template sheet for \"${newSheetName}\" with ID: ${newSpreadsheetId}`);\n        return newSpreadsheetId;\n\n    } catch(err) {\n        console.error('The API returned an error: ' + err);\n        throw new Error('Failed to create database sheet.');\n    }\n}\n\n\nexport async function getAllUsers() {\n    try {\n        const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n        const response = await sheets.spreadsheets.values.get({\n            spreadsheetId: SPREADSHEET_ID,\n            range: CREDENTIALS_SHEET_NAME,\n        });\n\n        const rows = response.data.values;\n        if (!rows || rows.length < 2) {\n            return [];\n        }\n\n        const header = rows[0];\n        const emailIndex = header.indexOf('emailAddress');\n        const userNameIndex = header.indexOf('userName');\n        const pwdIndex = header.indexOf('pwd');\n        const databaseIdIndex = header.indexOf('databaseID');\n        const folderIdIndex = header.indexOf('folderID');\n\n        if (userNameIndex === -1 || pwdIndex === -1 || emailIndex === -1 || databaseIdIndex === -1 || folderIdIndex === -1) {\n            console.error('One or more required columns are missing from the credentials sheet:', header);\n            throw new Error('Could not find required columns in the credentials sheet. Please check sheet headers.');\n        }\n        \n        return rows.slice(1).map(row => ({\n            emailAddress: row[emailIndex] || '',\n            userName: row[userNameIndex] || '',\n            pwd: row[pwdIndex] || '',\n            databaseId: row[databaseIdIndex] || '',\n            folderId: row[folderIdIndex] || '',\n        })).filter(u => u.userName); // Filter out empty rows\n\n    } catch (err) {\n        console.error('The API returned an error when getting all users: ' + err);\n        throw new Error('Failed to retrieve data from Google Sheet.');\n    }\n}\n\nexport async function updateUserFolderId(userName: string, folderId: string) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${CREDENTIALS_SHEET_NAME}!A:H`; \n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length === 0) {\n        throw new Error('No users found in credentials sheet.');\n    }\n\n    const header = rows[0];\n    const userNameIndex = header.indexOf('userName');\n    const folderIdIndex = header.indexOf('folderID');\n\n    if (userNameIndex === -1 || folderIdIndex === -1) {\n        throw new Error('userName or folderID column not found.');\n    }\n\n    const userRowIndex = rows.findIndex(row => row[userNameIndex] === userName);\n    if (userRowIndex === -1) {\n        throw new Error(`User ${userName} not found.`);\n    }\n\n    const rowToUpdate = userRowIndex + 1;\n    const columnToUpdate = String.fromCharCode('A'.charCodeAt(0) + folderIdIndex);\n\n    await sheets.spreadsheets.values.update({\n        spreadsheetId: SPREADSHEET_ID,\n        range: `${CREDENTIALS_SHEET_NAME}!${columnToUpdate}${rowToUpdate}`,\n        valueInputOption: 'RAW',\n        resource: {\n            values: [[folderId]],\n        },\n    });\n}\n\nexport async function updateUserDatabaseId(userName: string, databaseId: string) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${CREDENTIALS_SHEET_NAME}!A:H`;\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length === 0) {\n        throw new Error('No users found in credentials sheet.');\n    }\n    const header = rows[0];\n    const userNameIndex = header.indexOf('userName');\n    const databaseIdIndex = header.indexOf('databaseID');\n\n    if (userNameIndex === -1 || databaseIdIndex === -1) {\n        throw new Error('userName or databaseID column not found.');\n    }\n\n    const userRowIndex = rows.findIndex(row => row[userNameIndex] === userName);\n    if (userRowIndex === -1) {\n        throw new Error(`User ${userName} not found.`);\n    }\n\n    const rowToUpdate = userRowIndex + 1;\n    const columnToUpdate = String.fromCharCode('A'.charCodeAt(0) + databaseIdIndex);\n\n    await sheets.spreadsheets.values.update({\n        spreadsheetId: SPREADSHEET_ID,\n        range: `${CREDENTIALS_SHEET_NAME}!${columnToUpdate}${rowToUpdate}`,\n        valueInputOption: 'RAW',\n        resource: {\n            values: [[databaseId]],\n        },\n    });\n}\n\n\nexport async function getAllHeaderDataFromSheet(databaseId: string): Promise<TaxProfile[]> {\n  try {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const response = await sheets.spreadsheets.values.get({\n      spreadsheetId: databaseId,\n      range: 'tpList!A:Q',\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) {\n      return [];\n    }\n\n    const header = rows[0];\n    const dataRows = rows.slice(1);\n    \n    const objects = dataRows\n        .map(row => {\n            const rowData: { [key: string]: any } = {};\n            header.forEach((key, headerIndex) => {\n                rowData[key] = row[headerIndex] || '';\n            });\n            return rowData as TaxProfile;\n        })\n        .filter(profile => profile.tpTIN && typeof profile.tpTIN === 'string' && profile.tpTIN.trim() !== '');\n\n    return objects;\n\n  } catch (err) {\n    console.error(`The API returned an error for spreadsheet ${databaseId}: ` + err);\n    throw new Error('Failed to retrieve header data from Google Sheet.');\n  }\n}\n\nexport async function appendHeaderDataToSheet(profileData: TaxProfile, databaseId: string) {\n  const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n  const headerResponse = await sheets.spreadsheets.values.get({\n    spreadsheetId: databaseId,\n    range: 'tpList!A1:Q1',\n  });\n  \n  const headers = headerResponse.data.values?.[0];\n  if (!headers) {\n    throw new Error('Could not retrieve headers from tpList sheet.');\n  }\n\n  const values = [headers.map(header => profileData[header as keyof TaxProfile] || '')];\n\n  const request = {\n    spreadsheetId: databaseId,\n    range: `tpList!A1`,\n    valueInputOption: 'USER_ENTERED',\n    resource: {\n      values,\n    },\n  };\n\n  try {\n    const response = await sheets.spreadsheets.values.append(request);\n    console.log('Appended to sheet:', response.data);\n    return response.data;\n  } catch (err) {\n    console.error('The API returned an error: ' + err);\n    throw new Error('Failed to append data to Google Sheet.');\n  }\n}\n\nexport async function updateHeaderDataInSheet(profileData: TaxProfile, databaseId: string) {\n  const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n  const range = 'tpList!A:Q';\n  const getResponse = await sheets.spreadsheets.values.get({\n    spreadsheetId: databaseId,\n    range,\n  });\n\n  const rows = getResponse.data.values;\n  if (!rows || rows.length === 0) {\n    throw new Error('No data found in the sheet.');\n  }\n\n  const headers = rows[0];\n  const tinIndex = headers.indexOf('tpTIN');\n  if (tinIndex === -1) {\n    throw new Error('TIN column not found in the sheet.');\n  }\n  \n  const rowIndex = rows.findIndex(row => row[tinIndex] === profileData.tpTIN);\n\n  if (rowIndex === -1) {\n    throw new Error('Profile with the specified TIN not found.');\n  }\n  \n  const rowToUpdate = rowIndex + 1;\n  const values = [headers.map(header => profileData[header as keyof TaxProfile] || '')];\n\n  const request = {\n    spreadsheetId: databaseId,\n    range: `tpList!A${rowToUpdate}`,\n    valueInputOption: 'USER_ENTERED',\n    resource: {\n      values,\n    },\n  };\n\n  try {\n    const response = await sheets.spreadsheets.values.update(request);\n    console.log('Updated sheet:', response.data);\n    return response.data;\n  } catch (err) {\n    console.error('The API returned an error: ' + err);\n    throw new Error('Failed to update data in Google Sheet.');\n  }\n}\n\nasync function getSheetId(spreadsheetId: string, sheetName: string): Promise<number | null> {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const response = await sheets.spreadsheets.get({\n        spreadsheetId,\n    });\n    const sheet = response.data.sheets?.find(s => s.properties?.title === sheetName);\n    return sheet?.properties?.sheetId ?? null;\n}\n\nexport async function deleteHeaderDataRowInSheet(tpTIN: string, databaseId: string) {\n  const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n  const sheetName = 'tpList';\n  const range = `${sheetName}!A:Q`;\n\n  const getResponse = await sheets.spreadsheets.values.get({\n    spreadsheetId: databaseId,\n    range,\n  });\n\n  const rows = getResponse.data.values;\n  if (!rows || rows.length === 0) {\n    console.log('No data found in the sheet to delete.');\n    return;\n  }\n\n  const headers = rows[0];\n  const tinIndex = headers.indexOf('tpTIN');\n  if (tinIndex === -1) {\n    throw new Error('TIN column not found in the sheet.');\n  }\n\n  const rowIndex = rows.findIndex(row => row[tinIndex] === tpTIN);\n\n  if (rowIndex === -1) {\n    console.log(`Profile with TIN ${tpTIN} not found for deletion.`);\n    return;\n  }\n\n  const sheetId = await getSheetId(databaseId, sheetName);\n  if (sheetId === null) {\n      throw new Error(`Sheet with name \"${sheetName}\" not found.`);\n  }\n\n  const batchUpdateRequest = {\n    spreadsheetId: databaseId,\n    resource: {\n      requests: [\n        {\n          deleteDimension: {\n            range: {\n              sheetId: sheetId,\n              dimension: 'ROWS',\n              startIndex: rowIndex, \n              endIndex: rowIndex + 1\n            }\n          }\n        },\n        {\n          appendDimension: {\n            sheetId: sheetId,\n            dimension: \"ROWS\",\n            length: 1\n          }\n        }\n      ]\n    }\n  };\n\n  try {\n    await sheets.spreadsheets.batchUpdate(batchUpdateRequest);\n    console.log(`Successfully deleted row at index ${rowIndex} and added a new one.`);\n  } catch (err) {\n    console.error('The API returned an error during batch update: ' + err);\n    throw new Error('Failed to delete row from Google Sheet.');\n  }\n}\n\n\nexport async function updateUserDataInSheet(currentUserName: string, updates: UserUpdateData) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${CREDENTIALS_SHEET_NAME}!A:H`; \n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length === 0) {\n        throw new Error('No users found in credentials sheet.');\n    }\n\n    const header = rows[0];\n    const userNameIndex = header.indexOf('userName');\n    const pwdIndex = header.indexOf('pwd');\n\n    if (userNameIndex === -1 || pwdIndex === -1) {\n        throw new Error('Required columns (userName, pwd) not found.');\n    }\n\n    const userRowIndex = rows.findIndex(row => row[userNameIndex] === currentUserName);\n    if (userRowIndex === -1) {\n        throw new Error(`User '${currentUserName}' not found.`);\n    }\n\n    const rowToUpdate = userRowIndex + 1;\n    const userRow = [...rows[userRowIndex]];\n\n    if (updates.newPassword) {\n        if (!updates.currentPassword) {\n            throw new Error(\"Current password is required to change password.\");\n        }\n        if (userRow[pwdIndex] !== updates.currentPassword) {\n            throw new Error(\"Incorrect current password.\");\n        }\n        userRow[pwdIndex] = updates.newPassword;\n    }\n\n    if (updates.newUserName) {\n         const isUserNameTaken = rows.slice(1).some((row, index) => index !== userRowIndex -1 && row[userNameIndex] === updates.newUserName);\n         if (isUserNameTaken) {\n            throw new Error(`Username '${updates.newUserName}' is already taken.`);\n         }\n        userRow[userNameIndex] = updates.newUserName;\n    }\n\n    const updateRequest = {\n        spreadsheetId: SPREADSHEET_ID,\n        range: `${CREDENTIALS_SHEET_NAME}!A${rowToUpdate}:H${rowToUpdate}`,\n        valueInputOption: 'RAW',\n        resource: {\n            values: [userRow],\n        },\n    };\n\n    await sheets.spreadsheets.values.update(updateRequest);\n    console.log(`Successfully updated user data for '${currentUserName}'. New username: '${updates.newUserName || currentUserName}'`);\n}\n\nexport async function updateUserPasswordByEmail(email: string, newPassword: string): Promise<void> {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${CREDENTIALS_SHEET_NAME}!A:E`;\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) {\n        throw new Error('No users found in credentials sheet.');\n    }\n\n    const header = rows[0];\n    const emailIndex = header.indexOf('emailAddress');\n    const pwdIndex = header.indexOf('pwd');\n\n    if (emailIndex === -1 || pwdIndex === -1) {\n        throw new Error('Required columns (emailAddress, pwd) not found.');\n    }\n\n    const userRowIndex = rows.findIndex(row => row[emailIndex] === email);\n    if (userRowIndex === -1) {\n        throw new Error(`User with email ${email} not found.`);\n    }\n\n    const rowToUpdate = userRowIndex + 1;\n    const columnToUpdate = String.fromCharCode('A'.charCodeAt(0) + pwdIndex);\n\n    await sheets.spreadsheets.values.update({\n        spreadsheetId: SPREADSHEET_ID,\n        range: `${CREDENTIALS_SHEET_NAME}!${columnToUpdate}${rowToUpdate}`,\n        valueInputOption: 'RAW',\n        resource: {\n            values: [[newPassword]],\n        },\n    });\n\n    console.log(`Successfully updated password for user ${email}.`);\n}\n\n\n// Verification Flow Functions\n\ninterface PendingUser {\n    email: string;\n    userName?: string;\n    password?: string;\n    token: string;\n    type: string;\n    expires: string;\n}\n\n\nexport async function addPendingUser(user: PendingUser) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const sheetName = PENDING_VERIFICATIONS_SHEET_NAME;\n\n    const getResponse = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range: `${sheetName}!A:A`, \n    });\n\n    const rows = getResponse.data.values || [];\n    const existingRowIndex = rows.findIndex(row => row[0] === user.email);\n\n    const values = [[user.email, user.userName || '', user.password || '', user.token, user.type, user.expires]];\n\n    if (existingRowIndex !== -1) {\n        const rowToUpdate = existingRowIndex + 1;\n        console.log(`[Sheets] Found existing pending verification for ${user.email} at row ${rowToUpdate}. Updating.`);\n        \n        await sheets.spreadsheets.values.update({\n            spreadsheetId: SPREADSHEET_ID,\n            range: `${sheetName}!A${rowToUpdate}:F${rowToUpdate}`,\n            valueInputOption: 'USER_ENTERED',\n            resource: { values },\n        });\n    } else {\n        console.log(`[Sheets] No existing pending verification for ${user.email}. Appending new row.`);\n        await sheets.spreadsheets.values.append({\n            spreadsheetId: SPREADSHEET_ID,\n            range: `${sheetName}!A1`,\n            valueInputOption: 'USER_ENTERED',\n            resource: { values },\n        });\n    }\n}\n\nexport async function getPendingUserByToken(token: string): Promise<{ user: PendingUser; rowIndex: number } | null> {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range: PENDING_VERIFICATIONS_SHEET_NAME,\n    });\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) return null;\n\n    const header = rows[0];\n    const tokenIndex = header.indexOf('token');\n    \n    const rowIndex = rows.findIndex((row, index) => index > 0 && row[tokenIndex] === token);\n\n    if (rowIndex === -1) return null;\n    \n    const userRow = rows[rowIndex];\n\n    const user: PendingUser = {\n        email: userRow[header.indexOf('emailAddress')],\n        userName: userRow[header.indexOf('userName')],\n        password: userRow[header.indexOf('password')],\n        token: userRow[tokenIndex],\n        type: userRow[header.indexOf('type')],\n        expires: userRow[header.indexOf('expiration')],\n    };\n\n    return { user, rowIndex };\n}\n\n\nexport async function deletePendingUserByRow(rowIndex: number) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const sheetId = await getSheetId(SPREADSHEET_ID, PENDING_VERIFICATIONS_SHEET_NAME);\n    if (sheetId === null) throw new Error('Sheet not found');\n\n    await sheets.spreadsheets.batchUpdate({\n        spreadsheetId: SPREADSHEET_ID,\n        resource: {\n            requests: [{\n                deleteDimension: {\n                    range: { sheetId, dimension: 'ROWS', startIndex: rowIndex, endIndex: rowIndex + 1 },\n                },\n            }],\n        },\n    });\n}\n\n\nexport async function addUser(userData: SignupData & { folderId: string, databaseId: string, password?: string }) {\n  const { email, userName, password, folderId, databaseId } = userData;\n  const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n  \n  const headerResponse = await sheets.spreadsheets.values.get({\n    spreadsheetId: SPREADSHEET_ID,\n    range: `${CREDENTIALS_SHEET_NAME}!A1:E1`,\n  });\n\n  const headers = headerResponse.data.values?.[0];\n  if (!headers) {\n    throw new Error('Could not retrieve headers from credentials sheet.');\n  }\n\n  const userObject: {[key: string]: string} = {\n    emailAddress: email,\n    userName: userName,\n    pwd: password || '',\n    databaseID: databaseId,\n    folderID: folderId\n  }\n\n  const values = [headers.map(header => userObject[header] || '')];\n\n  const request = {\n    spreadsheetId: SPREADSHEET_ID,\n    range: `${CREDENTIALS_SHEET_NAME}!A1`, \n    valueInputOption: 'USER_ENTERED',\n    resource: { values },\n  };\n  await sheets.spreadsheets.values.append(request);\n}\n\n\n// ============== ActiveSessions Sheet Functions ==============\n\nexport async function addSessionToSheet(sessionData: {\n  emailAddress: string;\n  sessionToken: string;\n  ipAddress: string;\n  deviceInfo: string;\n}) {\n  const { emailAddress, sessionToken, ipAddress, deviceInfo } = sessionData;\n  const loginTime = new Date().toISOString();\n  const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n  const sheetName = SESSIONS_SHEET_NAME;\n\n  const getResponse = await sheets.spreadsheets.values.get({\n    spreadsheetId: SPREADSHEET_ID,\n    range: `${sheetName}!A:E`,\n  });\n\n  const rows = getResponse.data.values;\n  if (rows && rows.length > 1) { \n    const header = rows[0];\n    const emailIndex = header.indexOf('emailAddress');\n    const deviceInfoIndex = header.indexOf('deviceInfo');\n\n    const existingSessionRowIndex = rows.findIndex(\n      (row, index) => index > 0 && row[emailIndex] === emailAddress && row[deviceInfoIndex] === deviceInfo\n    );\n\n    if (existingSessionRowIndex !== -1) {\n      console.log(`[Sessions] Found existing session for ${emailAddress} on device. Removing before adding new one.`);\n      const sheetId = await getSheetId(SPREADSHEET_ID, sheetName);\n      if (sheetId === null) {\n        throw new Error(`Sheet with name \"${sheetName}\" not found.`);\n      }\n\n      await sheets.spreadsheets.batchUpdate({\n        spreadsheetId: SPREADSHEET_ID,\n        resource: {\n          requests: [{\n            deleteDimension: {\n              range: {\n                sheetId,\n                dimension: 'ROWS',\n                startIndex: existingSessionRowIndex,\n                endIndex: existingSessionRowIndex + 1,\n              },\n            },\n          }],\n        },\n      });\n    }\n  }\n\n  const values = [[emailAddress, sessionToken, loginTime, ipAddress, deviceInfo]];\n  const appendRequest = {\n    spreadsheetId: SPREADSHEET_ID,\n    range: `${sheetName}!A1`,\n    valueInputOption: 'USER_ENTERED',\n    resource: {\n      values,\n    },\n  };\n\n  try {\n    await sheets.spreadsheets.values.append(appendRequest);\n    console.log(`[Sessions] Added new session for user ${emailAddress}`);\n  } catch (err) {\n    console.error('The API returned an error while adding a session: ' + err);\n    throw new Error('Failed to add session to Google Sheet.');\n  }\n}\n\nexport async function getSessionsByEmail(email: string): Promise<SessionInfo[]> {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range: SESSIONS_SHEET_NAME,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) return [];\n\n    const header = rows[0];\n    const emailIndex = header.indexOf('emailAddress');\n    const tokenIndex = header.indexOf('sessionToken');\n    const timeIndex = header.indexOf('loginTime');\n    const ipIndex = header.indexOf('ipAddress');\n    const deviceIndex = header.indexOf('deviceInfo');\n\n    return rows.slice(1)\n        .filter(row => row[emailIndex] === email)\n        .map(row => ({\n            token: row[tokenIndex],\n            loginTime: row[timeIndex],\n            ipAddress: row[ipIndex],\n            deviceInfo: row[deviceIndex],\n        }));\n}\n\nasync function findRowIndexByToken(token: string): Promise<{ sheetId: number, rowIndex: number }> {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const sheetName = SESSIONS_SHEET_NAME;\n\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range: `${sheetName}!B:B`, // Only need to check the token column\n    });\n\n    const rows = response.data.values;\n    if (!rows) throw new Error('Could not find session.');\n\n    const rowIndex = rows.findIndex(row => row[0] === token);\n    if (rowIndex === -1) throw new Error('Session token not found.');\n\n    const sheetId = await getSheetId(SPREADSHEET_ID, sheetName);\n    if (sheetId === null) throw new Error('Could not find sheet ID for sessions.');\n    \n    return { sheetId, rowIndex };\n}\n\nexport async function findUserByTokenFromSheet(token: string): Promise<{ email: string } | null> {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${SESSIONS_SHEET_NAME}!A:B`; // emailAddress and sessionToken columns\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) return null;\n\n    const header = rows[0];\n    const emailIndex = header.indexOf('emailAddress');\n    const tokenIndex = header.indexOf('sessionToken');\n\n    const sessionRow = rows.slice(1).find(row => row[tokenIndex] === token);\n\n    if (sessionRow) {\n        return { email: sessionRow[emailIndex] };\n    }\n    return null;\n}\n\n\nexport async function deleteSessionByToken(token: string) {\n    const { sheetId, rowIndex } = await findRowIndexByToken(token);\n    \n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    await sheets.spreadsheets.batchUpdate({\n        spreadsheetId: SPREADSHEET_ID,\n        resource: {\n            requests: [{\n                deleteDimension: {\n                    range: {\n                        sheetId,\n                        dimension: 'ROWS',\n                        startIndex: rowIndex,\n                        endIndex: rowIndex + 1,\n                    },\n                },\n            }],\n        },\n    });\n    console.log(`[Sessions] Deleted session with token ending in ...${token.slice(-4)}`);\n}\n\nexport async function deleteAllOtherSessionsByToken(currentToken: string) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${SESSIONS_SHEET_NAME}!A:E`;\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) return;\n\n    const header = rows[0];\n    const tokenIndex = header.indexOf('sessionToken');\n    const emailIndex = header.indexOf('emailAddress');\n    \n    const currentUserRow = rows.find(row => row[tokenIndex] === currentToken);\n    if (!currentUserRow) return;\n\n    const currentUserEmail = currentUserRow[emailIndex];\n\n    const sheetId = await getSheetId(SPREADSHEET_ID, SESSIONS_SHEET_NAME);\n    if (sheetId === null) throw new Error('Could not find sheet ID.');\n\n    const deleteRequests = rows\n        .map((row, index) => ({ row, index }))\n        .filter(({ row }) => row[emailIndex] === currentUserEmail && row[tokenIndex] !== currentToken)\n        .map(({ index }) => ({\n            deleteDimension: {\n                range: {\n                    sheetId,\n                    dimension: 'ROWS',\n                    startIndex: index,\n                    endIndex: index + 1,\n                },\n            },\n        }))\n        .reverse(); \n\n    if (deleteRequests.length > 0) {\n        await sheets.spreadsheets.batchUpdate({\n            spreadsheetId: SPREADSHEET_ID,\n            resource: { requests: deleteRequests },\n        });\n        console.log(`[Sessions] Deleted ${deleteRequests.length} other session(s) for user ${currentUserEmail}`);\n    }\n}\n\nexport async function deleteAllSessionsByEmail(email: string) {\n    const sheets = google.sheets({ version: 'v4', auth: await getOAuth2Client() });\n    const range = `${SESSIONS_SHEET_NAME}!A:E`;\n    const response = await sheets.spreadsheets.values.get({\n        spreadsheetId: SPREADSHEET_ID,\n        range,\n    });\n\n    const rows = response.data.values;\n    if (!rows || rows.length < 2) return;\n\n    const header = rows[0];\n    const emailIndex = header.indexOf('emailAddress');\n    \n    const sheetId = await getSheetId(SPREADSHEET_ID, SESSIONS_SHEET_NAME);\n    if (sheetId === null) throw new Error('Could not find sheet ID.');\n\n    const deleteRequests = rows\n        .map((row, index) => ({ row, index }))\n        .filter(({ row, index }) => index > 0 && row[emailIndex] === email)\n        .map(({ index }) => ({\n            deleteDimension: {\n                range: {\n                    sheetId,\n                    dimension: 'ROWS',\n                    startIndex: index,\n                    endIndex: index + 1,\n                },\n            },\n        }))\n        .reverse(); // Reverse to handle shifting indices correctly\n\n    if (deleteRequests.length > 0) {\n        await sheets.spreadsheets.batchUpdate({\n            spreadsheetId: SPREADSHEET_ID,\n            resource: { requests: deleteRequests },\n        });\n        console.log(`[Sessions] Deleted ${deleteRequests.length} session(s) for user ${email}`);\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AACA;AAEA;AACA;;;;AAEA,MAAM,eAAe,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC5B,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM;IAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,KAAK;IACvB,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM;AACpB;AAEA,MAAM,cAAc,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC3B,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM;IAClB,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM;AACpB;AAMA,MAAM,EACJ,sBAAsB,EACtB,4BAA4B,EAC5B,+BAA+B,EAChC,GAAG,QAAQ,GAAG;AAEf,IAAI,CAAC,wBAAwB;IAC3B,MAAM,IAAI,MAAM;AAClB;AACA,IAAI,CAAC,8BAA8B;IAC/B,MAAM,IAAI,MAAM;AACpB;AACA,IAAI,CAAC,iCAAiC;IACpC,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,iBAAiB;AACvB,MAAM,0BAA0B;AAChC,MAAM,yBAAyB;AAC/B,MAAM,mCAAmC;AACzC,MAAM,sBAAsB;AAErB,eAAe,oBAAoB,SAAiB,EAAE,cAAsB;IAC/E,MAAM,eAAe,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IACzC,MAAM,QAAQ,mJAAA,CAAA,SAAM,CAAC,KAAK,CAAC;QAAE,SAAS;QAAM,MAAM;IAAa;IAC/D,MAAM,eAAe,CAAC,WAAW,EAAE,WAAW;IAE9C,IAAI;QACA,MAAM,aAAa,MAAM,MAAM,KAAK,CAAC,IAAI,CAAC;YACtC,QAAQ;YACR,aAAa;gBACT,MAAM;gBACN,SAAS;oBAAC;iBAAe;YAC7B;QACJ;QAEA,MAAM,mBAAmB,WAAW,IAAI,CAAC,EAAE;QAC3C,IAAI,CAAC,kBAAkB;YACnB,MAAM,IAAI,MAAM;QACpB;QAEA,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,aAAa,WAAW,EAAE,kBAAkB;QAC/F,OAAO;IAEX,EAAE,OAAM,KAAK;QACT,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM,IAAI,MAAM;IACpB;AACJ;AAGO,eAAe;IAClB,IAAI;QACA,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;YAAE,SAAS;YAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;QAAI;QAC5E,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YAClD,eAAe;YACf,OAAO;QACX;QAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;QACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG;YAC1B,OAAO,EAAE;QACb;QAEA,MAAM,SAAS,IAAI,CAAC,EAAE;QACtB,MAAM,aAAa,OAAO,OAAO,CAAC;QAClC,MAAM,gBAAgB,OAAO,OAAO,CAAC;QACrC,MAAM,WAAW,OAAO,OAAO,CAAC;QAChC,MAAM,kBAAkB,OAAO,OAAO,CAAC;QACvC,MAAM,gBAAgB,OAAO,OAAO,CAAC;QAErC,IAAI,kBAAkB,CAAC,KAAK,aAAa,CAAC,KAAK,eAAe,CAAC,KAAK,oBAAoB,CAAC,KAAK,kBAAkB,CAAC,GAAG;YAChH,QAAQ,KAAK,CAAC,wEAAwE;YACtF,MAAM,IAAI,MAAM;QACpB;QAEA,OAAO,KAAK,KAAK,CAAC,GAAG,GAAG,CAAC,CAAA,MAAO,CAAC;gBAC7B,cAAc,GAAG,CAAC,WAAW,IAAI;gBACjC,UAAU,GAAG,CAAC,cAAc,IAAI;gBAChC,KAAK,GAAG,CAAC,SAAS,IAAI;gBACtB,YAAY,GAAG,CAAC,gBAAgB,IAAI;gBACpC,UAAU,GAAG,CAAC,cAAc,IAAI;YACpC,CAAC,GAAG,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,GAAG,wBAAwB;IAEzD,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,uDAAuD;QACrE,MAAM,IAAI,MAAM;IACpB;AACJ;AAEO,eAAe,mBAAmB,QAAgB,EAAE,QAAgB;IACvE,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,uBAAuB,IAAI,CAAC;IAC7C,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC5B,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,gBAAgB,OAAO,OAAO,CAAC;IACrC,MAAM,gBAAgB,OAAO,OAAO,CAAC;IAErC,IAAI,kBAAkB,CAAC,KAAK,kBAAkB,CAAC,GAAG;QAC9C,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,eAAe,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,cAAc,KAAK;IAClE,IAAI,iBAAiB,CAAC,GAAG;QACrB,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,SAAS,WAAW,CAAC;IACjD;IAEA,MAAM,cAAc,eAAe;IACnC,MAAM,iBAAiB,OAAO,YAAY,CAAC,IAAI,UAAU,CAAC,KAAK;IAE/D,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACpC,eAAe;QACf,OAAO,GAAG,uBAAuB,CAAC,EAAE,iBAAiB,aAAa;QAClE,kBAAkB;QAClB,UAAU;YACN,QAAQ;gBAAC;oBAAC;iBAAS;aAAC;QACxB;IACJ;AACJ;AAEO,eAAe,qBAAqB,QAAgB,EAAE,UAAkB;IAC3E,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,uBAAuB,IAAI,CAAC;IAC7C,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC5B,MAAM,IAAI,MAAM;IACpB;IACA,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,gBAAgB,OAAO,OAAO,CAAC;IACrC,MAAM,kBAAkB,OAAO,OAAO,CAAC;IAEvC,IAAI,kBAAkB,CAAC,KAAK,oBAAoB,CAAC,GAAG;QAChD,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,eAAe,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,cAAc,KAAK;IAClE,IAAI,iBAAiB,CAAC,GAAG;QACrB,MAAM,IAAI,MAAM,CAAC,KAAK,EAAE,SAAS,WAAW,CAAC;IACjD;IAEA,MAAM,cAAc,eAAe;IACnC,MAAM,iBAAiB,OAAO,YAAY,CAAC,IAAI,UAAU,CAAC,KAAK;IAE/D,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACpC,eAAe;QACf,OAAO,GAAG,uBAAuB,CAAC,EAAE,iBAAiB,aAAa;QAClE,kBAAkB;QAClB,UAAU;YACN,QAAQ;gBAAC;oBAAC;iBAAW;aAAC;QAC1B;IACJ;AACJ;AAGO,eAAe,0BAA0B,UAAkB;IAChE,IAAI;QACF,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;YAAE,SAAS;YAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;QAAI;QAC5E,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;YACpD,eAAe;YACf,OAAO;QACT;QAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;QACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG;YAC5B,OAAO,EAAE;QACX;QAEA,MAAM,SAAS,IAAI,CAAC,EAAE;QACtB,MAAM,WAAW,KAAK,KAAK,CAAC;QAE5B,MAAM,UAAU,SACX,GAAG,CAAC,CAAA;YACD,MAAM,UAAkC,CAAC;YACzC,OAAO,OAAO,CAAC,CAAC,KAAK;gBACjB,OAAO,CAAC,IAAI,GAAG,GAAG,CAAC,YAAY,IAAI;YACvC;YACA,OAAO;QACX,GACC,MAAM,CAAC,CAAA,UAAW,QAAQ,KAAK,IAAI,OAAO,QAAQ,KAAK,KAAK,YAAY,QAAQ,KAAK,CAAC,IAAI,OAAO;QAEtG,OAAO;IAET,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,CAAC,0CAA0C,EAAE,WAAW,EAAE,CAAC,GAAG;QAC5E,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,wBAAwB,WAAuB,EAAE,UAAkB;IACvF,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,iBAAiB,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAC1D,eAAe;QACf,OAAO;IACT;IAEA,MAAM,UAAU,eAAe,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE;IAC/C,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,SAAS;QAAC,QAAQ,GAAG,CAAC,CAAA,SAAU,WAAW,CAAC,OAA2B,IAAI;KAAI;IAErF,MAAM,UAAU;QACd,eAAe;QACf,OAAO,CAAC,SAAS,CAAC;QAClB,kBAAkB;QAClB,UAAU;YACR;QACF;IACF;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACzD,QAAQ,GAAG,CAAC,sBAAsB,SAAS,IAAI;QAC/C,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,wBAAwB,WAAuB,EAAE,UAAkB;IACvF,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ;IACd,MAAM,cAAc,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QACvD,eAAe;QACf;IACF;IAEA,MAAM,OAAO,YAAY,IAAI,CAAC,MAAM;IACpC,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC9B,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,UAAU,IAAI,CAAC,EAAE;IACvB,MAAM,WAAW,QAAQ,OAAO,CAAC;IACjC,IAAI,aAAa,CAAC,GAAG;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,SAAS,KAAK,YAAY,KAAK;IAE1E,IAAI,aAAa,CAAC,GAAG;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,cAAc,WAAW;IAC/B,MAAM,SAAS;QAAC,QAAQ,GAAG,CAAC,CAAA,SAAU,WAAW,CAAC,OAA2B,IAAI;KAAI;IAErF,MAAM,UAAU;QACd,eAAe;QACf,OAAO,CAAC,QAAQ,EAAE,aAAa;QAC/B,kBAAkB;QAClB,UAAU;YACR;QACF;IACF;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACzD,QAAQ,GAAG,CAAC,kBAAkB,SAAS,IAAI;QAC3C,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM,IAAI,MAAM;IAClB;AACF;AAEA,eAAe,WAAW,aAAqB,EAAE,SAAiB;IAC9D,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,GAAG,CAAC;QAC3C;IACJ;IACA,MAAM,QAAQ,SAAS,IAAI,CAAC,MAAM,EAAE,KAAK,CAAA,IAAK,EAAE,UAAU,EAAE,UAAU;IACtE,OAAO,OAAO,YAAY,WAAW;AACzC;AAEO,eAAe,2BAA2B,KAAa,EAAE,UAAkB;IAChF,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,YAAY;IAClB,MAAM,QAAQ,GAAG,UAAU,IAAI,CAAC;IAEhC,MAAM,cAAc,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QACvD,eAAe;QACf;IACF;IAEA,MAAM,OAAO,YAAY,IAAI,CAAC,MAAM;IACpC,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC9B,QAAQ,GAAG,CAAC;QACZ;IACF;IAEA,MAAM,UAAU,IAAI,CAAC,EAAE;IACvB,MAAM,WAAW,QAAQ,OAAO,CAAC;IACjC,IAAI,aAAa,CAAC,GAAG;QACnB,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,WAAW,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,SAAS,KAAK;IAEzD,IAAI,aAAa,CAAC,GAAG;QACnB,QAAQ,GAAG,CAAC,CAAC,iBAAiB,EAAE,MAAM,wBAAwB,CAAC;QAC/D;IACF;IAEA,MAAM,UAAU,MAAM,WAAW,YAAY;IAC7C,IAAI,YAAY,MAAM;QAClB,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,UAAU,YAAY,CAAC;IAC/D;IAEA,MAAM,qBAAqB;QACzB,eAAe;QACf,UAAU;YACR,UAAU;gBACR;oBACE,iBAAiB;wBACf,OAAO;4BACL,SAAS;4BACT,WAAW;4BACX,YAAY;4BACZ,UAAU,WAAW;wBACvB;oBACF;gBACF;gBACA;oBACE,iBAAiB;wBACf,SAAS;wBACT,WAAW;wBACX,QAAQ;oBACV;gBACF;aACD;QACH;IACF;IAEA,IAAI;QACF,MAAM,OAAO,YAAY,CAAC,WAAW,CAAC;QACtC,QAAQ,GAAG,CAAC,CAAC,kCAAkC,EAAE,SAAS,qBAAqB,CAAC;IAClF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,oDAAoD;QAClE,MAAM,IAAI,MAAM;IAClB;AACF;AAGO,eAAe,sBAAsB,eAAuB,EAAE,OAAuB;IACxF,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,uBAAuB,IAAI,CAAC;IAC7C,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG;QAC5B,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,gBAAgB,OAAO,OAAO,CAAC;IACrC,MAAM,WAAW,OAAO,OAAO,CAAC;IAEhC,IAAI,kBAAkB,CAAC,KAAK,aAAa,CAAC,GAAG;QACzC,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,eAAe,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,cAAc,KAAK;IAClE,IAAI,iBAAiB,CAAC,GAAG;QACrB,MAAM,IAAI,MAAM,CAAC,MAAM,EAAE,gBAAgB,YAAY,CAAC;IAC1D;IAEA,MAAM,cAAc,eAAe;IACnC,MAAM,UAAU;WAAI,IAAI,CAAC,aAAa;KAAC;IAEvC,IAAI,QAAQ,WAAW,EAAE;QACrB,IAAI,CAAC,QAAQ,eAAe,EAAE;YAC1B,MAAM,IAAI,MAAM;QACpB;QACA,IAAI,OAAO,CAAC,SAAS,KAAK,QAAQ,eAAe,EAAE;YAC/C,MAAM,IAAI,MAAM;QACpB;QACA,OAAO,CAAC,SAAS,GAAG,QAAQ,WAAW;IAC3C;IAEA,IAAI,QAAQ,WAAW,EAAE;QACpB,MAAM,kBAAkB,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC,KAAK,QAAU,UAAU,eAAc,KAAK,GAAG,CAAC,cAAc,KAAK,QAAQ,WAAW;QAClI,IAAI,iBAAiB;YAClB,MAAM,IAAI,MAAM,CAAC,UAAU,EAAE,QAAQ,WAAW,CAAC,mBAAmB,CAAC;QACxE;QACD,OAAO,CAAC,cAAc,GAAG,QAAQ,WAAW;IAChD;IAEA,MAAM,gBAAgB;QAClB,eAAe;QACf,OAAO,GAAG,uBAAuB,EAAE,EAAE,YAAY,EAAE,EAAE,aAAa;QAClE,kBAAkB;QAClB,UAAU;YACN,QAAQ;gBAAC;aAAQ;QACrB;IACJ;IAEA,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;IACxC,QAAQ,GAAG,CAAC,CAAC,oCAAoC,EAAE,gBAAgB,kBAAkB,EAAE,QAAQ,WAAW,IAAI,gBAAgB,CAAC,CAAC;AACpI;AAEO,eAAe,0BAA0B,KAAa,EAAE,WAAmB;IAC9E,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,uBAAuB,IAAI,CAAC;IAC7C,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG;QAC1B,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,aAAa,OAAO,OAAO,CAAC;IAClC,MAAM,WAAW,OAAO,OAAO,CAAC;IAEhC,IAAI,eAAe,CAAC,KAAK,aAAa,CAAC,GAAG;QACtC,MAAM,IAAI,MAAM;IACpB;IAEA,MAAM,eAAe,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,WAAW,KAAK;IAC/D,IAAI,iBAAiB,CAAC,GAAG;QACrB,MAAM,IAAI,MAAM,CAAC,gBAAgB,EAAE,MAAM,WAAW,CAAC;IACzD;IAEA,MAAM,cAAc,eAAe;IACnC,MAAM,iBAAiB,OAAO,YAAY,CAAC,IAAI,UAAU,CAAC,KAAK;IAE/D,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACpC,eAAe;QACf,OAAO,GAAG,uBAAuB,CAAC,EAAE,iBAAiB,aAAa;QAClE,kBAAkB;QAClB,UAAU;YACN,QAAQ;gBAAC;oBAAC;iBAAY;aAAC;QAC3B;IACJ;IAEA,QAAQ,GAAG,CAAC,CAAC,uCAAuC,EAAE,MAAM,CAAC,CAAC;AAClE;AAeO,eAAe,eAAe,IAAiB;IAClD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,YAAY;IAElB,MAAM,cAAc,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QACrD,eAAe;QACf,OAAO,GAAG,UAAU,IAAI,CAAC;IAC7B;IAEA,MAAM,OAAO,YAAY,IAAI,CAAC,MAAM,IAAI,EAAE;IAC1C,MAAM,mBAAmB,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,EAAE,KAAK,KAAK,KAAK;IAEpE,MAAM,SAAS;QAAC;YAAC,KAAK,KAAK;YAAE,KAAK,QAAQ,IAAI;YAAI,KAAK,QAAQ,IAAI;YAAI,KAAK,KAAK;YAAE,KAAK,IAAI;YAAE,KAAK,OAAO;SAAC;KAAC;IAE5G,IAAI,qBAAqB,CAAC,GAAG;QACzB,MAAM,cAAc,mBAAmB;QACvC,QAAQ,GAAG,CAAC,CAAC,iDAAiD,EAAE,KAAK,KAAK,CAAC,QAAQ,EAAE,YAAY,WAAW,CAAC;QAE7G,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACpC,eAAe;YACf,OAAO,GAAG,UAAU,EAAE,EAAE,YAAY,EAAE,EAAE,aAAa;YACrD,kBAAkB;YAClB,UAAU;gBAAE;YAAO;QACvB;IACJ,OAAO;QACH,QAAQ,GAAG,CAAC,CAAC,8CAA8C,EAAE,KAAK,KAAK,CAAC,oBAAoB,CAAC;QAC7F,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;YACpC,eAAe;YACf,OAAO,GAAG,UAAU,GAAG,CAAC;YACxB,kBAAkB;YAClB,UAAU;gBAAE;YAAO;QACvB;IACJ;AACJ;AAEO,eAAe,sBAAsB,KAAa;IACrD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf,OAAO;IACX;IACA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG,OAAO;IAErC,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,aAAa,OAAO,OAAO,CAAC;IAElC,MAAM,WAAW,KAAK,SAAS,CAAC,CAAC,KAAK,QAAU,QAAQ,KAAK,GAAG,CAAC,WAAW,KAAK;IAEjF,IAAI,aAAa,CAAC,GAAG,OAAO;IAE5B,MAAM,UAAU,IAAI,CAAC,SAAS;IAE9B,MAAM,OAAoB;QACtB,OAAO,OAAO,CAAC,OAAO,OAAO,CAAC,gBAAgB;QAC9C,UAAU,OAAO,CAAC,OAAO,OAAO,CAAC,YAAY;QAC7C,UAAU,OAAO,CAAC,OAAO,OAAO,CAAC,YAAY;QAC7C,OAAO,OAAO,CAAC,WAAW;QAC1B,MAAM,OAAO,CAAC,OAAO,OAAO,CAAC,QAAQ;QACrC,SAAS,OAAO,CAAC,OAAO,OAAO,CAAC,cAAc;IAClD;IAEA,OAAO;QAAE;QAAM;IAAS;AAC5B;AAGO,eAAe,uBAAuB,QAAgB;IACzD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,UAAU,MAAM,WAAW,gBAAgB;IACjD,IAAI,YAAY,MAAM,MAAM,IAAI,MAAM;IAEtC,MAAM,OAAO,YAAY,CAAC,WAAW,CAAC;QAClC,eAAe;QACf,UAAU;YACN,UAAU;gBAAC;oBACP,iBAAiB;wBACb,OAAO;4BAAE;4BAAS,WAAW;4BAAQ,YAAY;4BAAU,UAAU,WAAW;wBAAE;oBACtF;gBACJ;aAAE;QACN;IACJ;AACJ;AAGO,eAAe,QAAQ,QAAkF;IAC9G,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG;IAC5D,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAE5E,MAAM,iBAAiB,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAC1D,eAAe;QACf,OAAO,GAAG,uBAAuB,MAAM,CAAC;IAC1C;IAEA,MAAM,UAAU,eAAe,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE;IAC/C,IAAI,CAAC,SAAS;QACZ,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,aAAsC;QAC1C,cAAc;QACd,UAAU;QACV,KAAK,YAAY;QACjB,YAAY;QACZ,UAAU;IACZ;IAEA,MAAM,SAAS;QAAC,QAAQ,GAAG,CAAC,CAAA,SAAU,UAAU,CAAC,OAAO,IAAI;KAAI;IAEhE,MAAM,UAAU;QACd,eAAe;QACf,OAAO,GAAG,uBAAuB,GAAG,CAAC;QACrC,kBAAkB;QAClB,UAAU;YAAE;QAAO;IACrB;IACA,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;AAC1C;AAKO,eAAe,kBAAkB,WAKvC;IACC,MAAM,EAAE,YAAY,EAAE,YAAY,EAAE,SAAS,EAAE,UAAU,EAAE,GAAG;IAC9D,MAAM,YAAY,IAAI,OAAO,WAAW;IACxC,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,YAAY;IAElB,MAAM,cAAc,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QACvD,eAAe;QACf,OAAO,GAAG,UAAU,IAAI,CAAC;IAC3B;IAEA,MAAM,OAAO,YAAY,IAAI,CAAC,MAAM;IACpC,IAAI,QAAQ,KAAK,MAAM,GAAG,GAAG;QAC3B,MAAM,SAAS,IAAI,CAAC,EAAE;QACtB,MAAM,aAAa,OAAO,OAAO,CAAC;QAClC,MAAM,kBAAkB,OAAO,OAAO,CAAC;QAEvC,MAAM,0BAA0B,KAAK,SAAS,CAC5C,CAAC,KAAK,QAAU,QAAQ,KAAK,GAAG,CAAC,WAAW,KAAK,gBAAgB,GAAG,CAAC,gBAAgB,KAAK;QAG5F,IAAI,4BAA4B,CAAC,GAAG;YAClC,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,aAAa,2CAA2C,CAAC;YAC9G,MAAM,UAAU,MAAM,WAAW,gBAAgB;YACjD,IAAI,YAAY,MAAM;gBACpB,MAAM,IAAI,MAAM,CAAC,iBAAiB,EAAE,UAAU,YAAY,CAAC;YAC7D;YAEA,MAAM,OAAO,YAAY,CAAC,WAAW,CAAC;gBACpC,eAAe;gBACf,UAAU;oBACR,UAAU;wBAAC;4BACT,iBAAiB;gCACf,OAAO;oCACL;oCACA,WAAW;oCACX,YAAY;oCACZ,UAAU,0BAA0B;gCACtC;4BACF;wBACF;qBAAE;gBACJ;YACF;QACF;IACF;IAEA,MAAM,SAAS;QAAC;YAAC;YAAc;YAAc;YAAW;YAAW;SAAW;KAAC;IAC/E,MAAM,gBAAgB;QACpB,eAAe;QACf,OAAO,GAAG,UAAU,GAAG,CAAC;QACxB,kBAAkB;QAClB,UAAU;YACR;QACF;IACF;IAEA,IAAI;QACF,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,MAAM,CAAC;QACxC,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,cAAc;IACrE,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,uDAAuD;QACrE,MAAM,IAAI,MAAM;IAClB;AACF;AAEO,eAAe,mBAAmB,KAAa;IAClD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf,OAAO;IACX;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG,OAAO,EAAE;IAEvC,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,aAAa,OAAO,OAAO,CAAC;IAClC,MAAM,aAAa,OAAO,OAAO,CAAC;IAClC,MAAM,YAAY,OAAO,OAAO,CAAC;IACjC,MAAM,UAAU,OAAO,OAAO,CAAC;IAC/B,MAAM,cAAc,OAAO,OAAO,CAAC;IAEnC,OAAO,KAAK,KAAK,CAAC,GACb,MAAM,CAAC,CAAA,MAAO,GAAG,CAAC,WAAW,KAAK,OAClC,GAAG,CAAC,CAAA,MAAO,CAAC;YACT,OAAO,GAAG,CAAC,WAAW;YACtB,WAAW,GAAG,CAAC,UAAU;YACzB,WAAW,GAAG,CAAC,QAAQ;YACvB,YAAY,GAAG,CAAC,YAAY;QAChC,CAAC;AACT;AAEA,eAAe,oBAAoB,KAAa;IAC5C,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,YAAY;IAElB,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf,OAAO,GAAG,UAAU,IAAI,CAAC;IAC7B;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAE3B,MAAM,WAAW,KAAK,SAAS,CAAC,CAAA,MAAO,GAAG,CAAC,EAAE,KAAK;IAClD,IAAI,aAAa,CAAC,GAAG,MAAM,IAAI,MAAM;IAErC,MAAM,UAAU,MAAM,WAAW,gBAAgB;IACjD,IAAI,YAAY,MAAM,MAAM,IAAI,MAAM;IAEtC,OAAO;QAAE;QAAS;IAAS;AAC/B;AAEO,eAAe,yBAAyB,KAAa;IACxD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,oBAAoB,IAAI,CAAC,EAAE,wCAAwC;IACpF,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG,OAAO;IAErC,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,aAAa,OAAO,OAAO,CAAC;IAClC,MAAM,aAAa,OAAO,OAAO,CAAC;IAElC,MAAM,aAAa,KAAK,KAAK,CAAC,GAAG,IAAI,CAAC,CAAA,MAAO,GAAG,CAAC,WAAW,KAAK;IAEjE,IAAI,YAAY;QACZ,OAAO;YAAE,OAAO,UAAU,CAAC,WAAW;QAAC;IAC3C;IACA,OAAO;AACX;AAGO,eAAe,qBAAqB,KAAa;IACpD,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE,GAAG,MAAM,oBAAoB;IAExD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,OAAO,YAAY,CAAC,WAAW,CAAC;QAClC,eAAe;QACf,UAAU;YACN,UAAU;gBAAC;oBACP,iBAAiB;wBACb,OAAO;4BACH;4BACA,WAAW;4BACX,YAAY;4BACZ,UAAU,WAAW;wBACzB;oBACJ;gBACJ;aAAE;QACN;IACJ;IACA,QAAQ,GAAG,CAAC,CAAC,mDAAmD,EAAE,MAAM,KAAK,CAAC,CAAC,IAAI;AACvF;AAEO,eAAe,8BAA8B,YAAoB;IACpE,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,oBAAoB,IAAI,CAAC;IAC1C,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG;IAE9B,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,aAAa,OAAO,OAAO,CAAC;IAClC,MAAM,aAAa,OAAO,OAAO,CAAC;IAElC,MAAM,iBAAiB,KAAK,IAAI,CAAC,CAAA,MAAO,GAAG,CAAC,WAAW,KAAK;IAC5D,IAAI,CAAC,gBAAgB;IAErB,MAAM,mBAAmB,cAAc,CAAC,WAAW;IAEnD,MAAM,UAAU,MAAM,WAAW,gBAAgB;IACjD,IAAI,YAAY,MAAM,MAAM,IAAI,MAAM;IAEtC,MAAM,iBAAiB,KAClB,GAAG,CAAC,CAAC,KAAK,QAAU,CAAC;YAAE;YAAK;QAAM,CAAC,GACnC,MAAM,CAAC,CAAC,EAAE,GAAG,EAAE,GAAK,GAAG,CAAC,WAAW,KAAK,oBAAoB,GAAG,CAAC,WAAW,KAAK,cAChF,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,GAAK,CAAC;YACjB,iBAAiB;gBACb,OAAO;oBACH;oBACA,WAAW;oBACX,YAAY;oBACZ,UAAU,QAAQ;gBACtB;YACJ;QACJ,CAAC,GACA,OAAO;IAEZ,IAAI,eAAe,MAAM,GAAG,GAAG;QAC3B,MAAM,OAAO,YAAY,CAAC,WAAW,CAAC;YAClC,eAAe;YACf,UAAU;gBAAE,UAAU;YAAe;QACzC;QACA,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,eAAe,MAAM,CAAC,2BAA2B,EAAE,kBAAkB;IAC3G;AACJ;AAEO,eAAe,yBAAyB,KAAa;IACxD,MAAM,SAAS,mJAAA,CAAA,SAAM,CAAC,MAAM,CAAC;QAAE,SAAS;QAAM,MAAM,MAAM,CAAA,GAAA,4HAAA,CAAA,kBAAe,AAAD;IAAI;IAC5E,MAAM,QAAQ,GAAG,oBAAoB,IAAI,CAAC;IAC1C,MAAM,WAAW,MAAM,OAAO,YAAY,CAAC,MAAM,CAAC,GAAG,CAAC;QAClD,eAAe;QACf;IACJ;IAEA,MAAM,OAAO,SAAS,IAAI,CAAC,MAAM;IACjC,IAAI,CAAC,QAAQ,KAAK,MAAM,GAAG,GAAG;IAE9B,MAAM,SAAS,IAAI,CAAC,EAAE;IACtB,MAAM,aAAa,OAAO,OAAO,CAAC;IAElC,MAAM,UAAU,MAAM,WAAW,gBAAgB;IACjD,IAAI,YAAY,MAAM,MAAM,IAAI,MAAM;IAEtC,MAAM,iBAAiB,KAClB,GAAG,CAAC,CAAC,KAAK,QAAU,CAAC;YAAE;YAAK;QAAM,CAAC,GACnC,MAAM,CAAC,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,GAAK,QAAQ,KAAK,GAAG,CAAC,WAAW,KAAK,OAC5D,GAAG,CAAC,CAAC,EAAE,KAAK,EAAE,GAAK,CAAC;YACjB,iBAAiB;gBACb,OAAO;oBACH;oBACA,WAAW;oBACX,YAAY;oBACZ,UAAU,QAAQ;gBACtB;YACJ;QACJ,CAAC,GACA,OAAO,IAAI,+CAA+C;IAE/D,IAAI,eAAe,MAAM,GAAG,GAAG;QAC3B,MAAM,OAAO,YAAY,CAAC,WAAW,CAAC;YAClC,eAAe;YACf,UAAU;gBAAE,UAAU;YAAe;QACzC;QACA,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,eAAe,MAAM,CAAC,qBAAqB,EAAE,OAAO;IAC1F;AACJ","debugId":null}},
    {"offset": {"line": 1094, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/drive.ts"],"sourcesContent":["\n'use server';\n\nimport { google } from 'googleapis';\nimport type { drive_v3 } from 'googleapis';\nimport { getOAuth2Client } from './drive-oauth';\nimport type { DatFile } from './schemas';\n\nconst { GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID } = process.env;\n\nasync function getDriveClient(): Promise<drive_v3.Drive> {\n    const oauth2Client = await getOAuth2Client();\n    return google.drive({ version: 'v3', auth: oauth2Client });\n}\n\n/**\n * Creates a folder for a user inside the main accounts folder.\n * @param userEmail The user's email, which will be the name of the folder.\n * @returns The ID of the created folder.\n */\nexport async function createFolderInDrive(userEmail: string): Promise<string> {\n    if (!GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID) {\n        throw new Error('GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID is not configured in .env');\n    }\n    const drive = await getDriveClient();\n    const fileMetadata = {\n        name: userEmail,\n        mimeType: 'application/vnd.google-apps.folder',\n        parents: [GOOGLE_DRIVE_ACCOUNTS_FOLDER_ID],\n    };\n    try {\n        const file = await drive.files.create({\n            resource: fileMetadata,\n            fields: 'id',\n        });\n        console.log(`[Drive] Created user folder \"${userEmail}\" with ID: ${file.data.id}`);\n        return file.data.id!;\n    } catch (error) {\n        console.error(`[Drive] Error creating user folder \"${userEmail}\":`, error);\n        throw error;\n    }\n}\n\nasync function findFolder(drive: drive_v3.Drive, name: string, parentId: string): Promise<string | null> {\n    const query = `mimeType='application/vnd.google-apps.folder' and name='${name.replace(/'/g, \"\\\\'\")}' and '${parentId}' in parents and trashed=false`;\n    try {\n        const res = await drive.files.list({\n            q: query,\n            fields: 'files(id)',\n            spaces: 'drive',\n            pageSize: 1,\n        });\n        if (res.data.files && res.data.files.length > 0 && res.data.files[0].id) {\n            return res.data.files[0].id;\n        }\n        return null;\n    } catch (error) {\n        console.error(`[Drive] Error finding folder \"${name}\" in parent \"${parentId}\":`, error);\n        return null;\n    }\n}\n\nasync function createFolder(drive: drive_v3.Drive, name: string, parentId: string): Promise<string> {\n    const fileMetadata = {\n        name: name,\n        mimeType: 'application/vnd.google-apps.folder',\n        parents: [parentId],\n    };\n    const folder = await drive.files.create({\n        resource: fileMetadata,\n        fields: 'id',\n    });\n    if (!folder.data.id) throw new Error(`Failed to create folder \"${name}\"`);\n    console.log(`[Drive] Created folder \"${name}\" with ID: ${folder.data.id}.`);\n    return folder.data.id;\n}\n\n\nasync function getOrCreateFolderByPath(drive: drive_v3.Drive, rootFolderId: string, path: string[]): Promise<string> {\n    let currentParentId = rootFolderId;\n    \n    const datFilesFolderName = 'DATFiles';\n    let datFilesFolderId = await findFolder(drive, datFilesFolderName, currentParentId);\n    if (!datFilesFolderId) {\n        datFilesFolderId = await createFolder(drive, datFilesFolderName, currentParentId);\n    }\n    currentParentId = datFilesFolderId;\n\n    for (const folderName of path) {\n        let nextFolderId = await findFolder(drive, folderName, currentParentId);\n        if (!nextFolderId) {\n            nextFolderId = await createFolder(drive, folderName, currentParentId);\n        }\n        currentParentId = nextFolderId;\n    }\n    return currentParentId;\n}\n\nexport async function checkFileExists(fileName: string, rootFolderId: string, path: string[]): Promise<boolean> {\n    try {\n        const drive = await getDriveClient();\n        const finalFolderId = await getOrCreateFolderByPath(drive, rootFolderId, path);\n        const query = `name='${fileName.replace(/'/g, \"\\\\'\")}' and '${finalFolderId}' in parents and trashed=false`;\n        \n        const res = await drive.files.list({\n            q: query,\n            fields: 'files(id)',\n            pageSize: 1,\n        });\n\n        return !!(res.data.files && res.data.files.length > 0);\n    } catch (error) {\n        console.error(`[Drive] Error checking if file '${fileName}' exists:`, error);\n        return false;\n    }\n}\n\n/**\n * Uploads or updates a file in a specific Google Drive folder path.\n * @param fileName The name of the file.\n * @param fileContent The content of the file.\n * @param rootFolderId The ID of the user's root folder in Drive.\n * @param path An array representing the folder path inside \"DATFiles\".\n * @param overwrite If true, will update the existing file. If false, will not upload if file exists.\n * @returns The DatFile object for the created/updated file.\n */\nexport async function uploadFileToDrive(fileName: string, fileContent: string, rootFolderId: string, path: string[], overwrite: boolean = false): Promise<DatFile> {\n  try {\n    const drive = await getDriveClient();\n    const finalFolderId = await getOrCreateFolderByPath(drive, rootFolderId, path);\n    console.log(`[Drive] Final folder for upload is '${finalFolderId}'.`);\n\n    const media = {\n        mimeType: 'text/plain',\n        body: fileContent,\n    };\n    \n    const fileFields = 'id, name, modifiedTime';\n\n    if (overwrite) {\n        const query = `name='${fileName.replace(/'/g, \"\\\\'\")}' and '${finalFolderId}' in parents and trashed=false`;\n        const res = await drive.files.list({ q: query, fields: 'files(id)', pageSize: 1 });\n\n        if (res.data.files && res.data.files.length > 0 && res.data.files[0].id) {\n            const fileId = res.data.files[0].id;\n            console.log(`[Drive] Overwriting existing file '${fileName}' with ID: ${fileId}`);\n            const updatedFile = await drive.files.update({\n                fileId: fileId,\n                media: media,\n                fields: fileFields,\n            });\n            if (!updatedFile.data.id || !updatedFile.data.name || !updatedFile.data.modifiedTime) {\n                throw new Error('File update did not return complete data.');\n            }\n             return { id: updatedFile.data.id, name: updatedFile.data.name, path: path.join(' / '), modifiedTime: updatedFile.data.modifiedTime };\n        }\n    }\n    \n    // If not overwriting or file doesn't exist, create a new one.\n    const fileMetadata = {\n      name: fileName,\n      parents: [finalFolderId],\n    };\n\n    const file = await drive.files.create({\n      requestBody: fileMetadata,\n      media: media,\n      fields: fileFields,\n    });\n\n    if (!file.data.id || !file.data.name || !file.data.modifiedTime) {\n        throw new Error('File creation did not return complete data.');\n    }\n    console.log(`[Drive] Successfully uploaded new file '${fileName}', File ID: ${file.data.id}`);\n    return { id: file.data.id, name: file.data.name, path: path.join(' / '), modifiedTime: file.data.modifiedTime };\n\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred.';\n    console.error(`[Drive] Failed to upload file '${fileName}':`, errorMessage);\n    throw new Error(`Failed to upload file to Google Drive: ${errorMessage}`);\n  }\n}\n\n/**\n * Lists all .DAT files within a user's DATFiles directory structure and all subfolder IDs.\n * @param rootFolderId The root folder ID for the user.\n * @returns A list of file details and a list of all folder IDs within the DATFiles structure.\n */\nexport async function listDatFiles(rootFolderId: string): Promise<{ files: DatFile[]; folderIds: string[] }> {\n    const drive = await getDriveClient();\n\n    const datFilesFolderId = await findFolder(drive, \"DATFiles\", rootFolderId);\n    if (!datFilesFolderId) {\n        console.log('[Drive] \"DATFiles\" folder not found, returning empty list.');\n        return { files: [], folderIds: [] };\n    }\n\n    const folderMap = new Map<string, { name: string; parentId: string }>();\n    const allFiles: DatFile[] = [];\n    const allFolderIds = new Set<string>([datFilesFolderId]);\n\n    async function walkFolders(folderId: string): Promise<void> {\n        let pageToken: string | undefined = undefined;\n        do {\n            const res = await drive.files.list({\n                q: `'${folderId}' in parents and trashed=false`,\n                fields: \"nextPageToken, files(id, name, mimeType, modifiedTime, parents)\",\n                spaces: \"drive\",\n                pageToken,\n                pageSize: 1000,\n            });\n\n            const folderPromises: Promise<void>[] = [];\n\n            if (res.data.files) {\n                for (const file of res.data.files) {\n                    if (file.mimeType === \"application/vnd.google-apps.folder\") {\n                        if (file.id) {\n                            allFolderIds.add(file.id);\n                            if (file.parents && file.parents.length > 0) {\n                                folderMap.set(file.id, { name: file.name!, parentId: file.parents[0] });\n                            }\n                            folderPromises.push(walkFolders(file.id));\n                        }\n                    } else if (file.name?.endsWith(\".DAT\")) {\n                        let pathParts: string[] = [];\n                        let currentParentId = file.parents?.[0];\n\n                        while (currentParentId && currentParentId !== datFilesFolderId) {\n                            const parentFolder = folderMap.get(currentParentId);\n                            if (parentFolder) {\n                                pathParts.unshift(parentFolder.name);\n                                currentParentId = parentFolder.parentId;\n                            } else {\n                                break;\n                            }\n                        }\n\n                        allFiles.push({\n                            id: file.id!,\n                            name: file.name!,\n                            path: pathParts.join(\" / \"),\n                            modifiedTime: file.modifiedTime!,\n                        });\n                    }\n                }\n            }\n            await Promise.all(folderPromises);\n            pageToken = res.data.nextPageToken;\n        } while (pageToken);\n    }\n\n    folderMap.set(datFilesFolderId, { name: \"DATFiles\", parentId: rootFolderId });\n    await walkFolders(datFilesFolderId);\n\n    return { files: allFiles, folderIds: Array.from(allFolderIds) };\n}\n\n\n\n/**\n * Downloads the content of a file from Google Drive.\n * @param fileId The ID of the file to download.\n * @returns The content of the file as a string.\n */\nexport async function downloadFileFromDrive(fileId: string): Promise<string> {\n    const drive = await getDriveClient();\n    try {\n        const response = await drive.files.get(\n            { fileId: fileId, alt: 'media' },\n            { responseType: 'stream' }\n        );\n\n        return new Promise((resolve, reject) => {\n            let buf: any[] = [];\n            response.data\n                .on('data', (chunk) => buf.push(chunk))\n                .on('end', () => {\n                    const content = Buffer.concat(buf).toString();\n                    resolve(content);\n                })\n                .on('error', (err) => {\n                    console.error(`[Drive] Error downloading file ${fileId}:`, err);\n                    reject(err);\n                });\n        });\n\n    } catch (error: any) {\n        if (error.code === 404) {\n            throw new Error('File not found.');\n        }\n        console.error(`[Drive] API error on download for file ${fileId}:`, error);\n        throw error;\n    }\n}\n\n\n/**\n * Deletes a file from Google Drive permanently.\n * @param fileId The ID of the file to delete.\n */\nexport async function deleteFileFromDrive(fileId: string): Promise<void> {\n    const drive = await getDriveClient();\n    try {\n        await drive.files.delete({\n            fileId: fileId,\n        });\n        console.log(`[Drive] Successfully deleted file with ID: ${fileId}`);\n    } catch (error: any) {\n        if (error.code === 404) {\n            throw new Error('File not found.');\n        }\n        console.error(`[Drive] Error deleting file ${fileId}:`, error);\n        throw error;\n    }\n}\n\n/**\n * Gets the starting page token for the changes feed for the entire user's Drive.\n * @returns The starting page token.\n */\nexport async function getInitialPageTokenForDrive(): Promise<string> {\n    const drive = await getDriveClient();\n    try {\n        const response = await drive.changes.getStartPageToken({\n             supportsAllDrives: true,\n        });\n        if (!response.data.startPageToken) {\n            throw new Error('Failed to get a start page token.');\n        }\n        return response.data.startPageToken;\n    } catch (error) {\n        console.error('[Drive] Error getting initial page token:', error);\n        throw error;\n    }\n}\n\n/**\n * Lists changes for a user's account and checks if they are relevant to the user's folder structure.\n * @param allFolderIds An array of all folder IDs that belong to the user's DAT file structure.\n * @param pageToken The page token from which to retrieve changes.\n * @returns An object with hasChanges boolean and the new page token.\n */\nexport async function listChangesSincePageToken(\n    allFolderIds: string[],\n    pageToken: string\n): Promise<{ hasChanges: boolean; newPageToken: string }> {\n    const drive = await getDriveClient();\n    let newPageToken = pageToken;\n    let hasRelevantChanges = false;\n    let lastResponse: any;\n\n    try {\n        const folderIdSet = new Set(allFolderIds);\n\n        do {\n            lastResponse = await drive.changes.list({\n                pageToken: newPageToken,\n                spaces: \"drive\",\n                fields: \"nextPageToken, newStartPageToken, changes(fileId, removed, file(name, parents, mimeType))\",\n                includeItemsFromAllDrives: true,\n                supportsAllDrives: true,\n            });\n\n            const changes = lastResponse.data.changes || [];\n\n            if (changes.length > 0) {\n                const relevantChange = changes.some((c: any) => {\n                    // A file was deleted. We can't know its parent, so we must refresh.\n                    if (c.removed) return true; \n\n                    if (c.file && c.file.parents) {\n                        // Check if the file's parent is one of our tracked folders.\n                        const parentIsTracked = c.file.parents.some((p: string) => folderIdSet.has(p));\n                        if (parentIsTracked) {\n                            // It's a folder or a .DAT file within our structure\n                            if (c.file.mimeType === 'application/vnd.google-apps.folder' || c.file.name?.toUpperCase().endsWith(\".DAT\")) {\n                                return true;\n                            }\n                        }\n                    }\n                    return false;\n                });\n\n                if (relevantChange) {\n                    hasRelevantChanges = true;\n                    break; \n                }\n            }\n\n            if (lastResponse.data.nextPageToken) {\n                newPageToken = lastResponse.data.nextPageToken;\n            } else {\n                break;\n            }\n        } while (lastResponse.data.nextPageToken);\n\n        const finalToken = lastResponse.data.newStartPageToken || newPageToken;\n\n        return { hasChanges: hasRelevantChanges, newPageToken: finalToken };\n    } catch (error) {\n        console.error(\"[Drive] Error listing changes:\", error);\n        return { hasChanges: false, newPageToken: pageToken };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1496, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/email.ts"],"sourcesContent":["\n'use server';\n\nimport nodemailer from 'nodemailer';\n\nconst { \n    EMAIL_SERVER_HOST, \n    EMAIL_SERVER_PORT, \n    EMAIL_SERVER_USER, \n    EMAIL_SERVER_PASSWORD,\n    EMAIL_FROM\n} = process.env;\n\nconst transporter = nodemailer.createTransport({\n  host: EMAIL_SERVER_HOST,\n  port: Number(EMAIL_SERVER_PORT),\n  secure: true, // true for 465\n  auth: {\n    user: EMAIL_SERVER_USER,\n    pass: EMAIL_SERVER_PASSWORD,\n  },\n  requireTLS: true,\n});\n\nexport async function sendVerificationEmail(to: string, name: string, link: string) {\n    const mailOptions = {\n        from: EMAIL_FROM,\n        to,\n        subject: 'DATGenie: Verify Your Email Address',\n        html: `\n            <!DOCTYPE html>\n            <html lang=\"en\">\n            <head>\n                <meta charset=\"UTF-8\">\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n                <title>DATGenie Account Verification</title>\n                <style>\n                    body {\n                        margin: 0;\n                        padding: 0;\n                        font-family: 'Inter', Arial, sans-serif;\n                        background-color: #E0F7FA;\n                    }\n                    .container {\n                        padding: 20px;\n                        background-color: #E0F7FA;\n                    }\n                    .card {\n                        background-color: #ffffff;\n                        border-radius: 8px;\n                        padding: 40px;\n                        margin: 40px auto;\n                        max-width: 600px;\n                        text-align: center;\n                        box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n                    }\n                    .logo {\n                        margin-bottom: 20px;\n                    }\n                    h2 {\n                        color: #333333;\n                        font-size: 24px;\n                        margin-bottom: 10px;\n                    }\n                    p {\n                        color: #555555;\n                        font-size: 16px;\n                        line-height: 1.5;\n                        margin-bottom: 20px;\n                    }\n                    .button {\n                        background-color: #29ABE2;\n                        color: #ffffff !important;\n                        padding: 8px 25px;\n                        text-decoration: none;\n                        border-radius: 5px;\n                        display: inline-block;\n                        font-weight: bold;\n                        font-size: 16px;\n                    }\n                    .footer {\n                        text-align: center;\n                        font-size: 12px;\n                        color: #888888;\n                        margin-top: 20px;\n                    }\n                    .note {\n                        font-size: 12px; \n                        color: #555;\n                        margin-top: 30px;\n                    }\n                </style>\n            </head>\n            <body>\n                <div class=\"container\">\n                    <div class=\"card\">\n                        <img src=\"https://i.imgur.com/YuFtLr0.png\" alt=\"DATGenie Logo\" width=\"60\" class=\"logo\">\n                        <h2>Hello ${name},</h2>\n                        <p>Thank you for signing up for DATGenie! To complete your registration, please verify your email address by clicking the button below:</p>\n                        <a href=\"${link}\" class=\"button\" style=\"color: #ffffff;\">Verify</a>\n                        <p class=\"note\">Please note: This verification link is valid for one hour only.</p>\n                    </div>\n                    <div class=\"footer\">\n                        <p>If you did not sign up for this account, you can safely ignore this email.</p>\n                        <p>&copy; ${new Date().getFullYear()} DATGenie. All Rights Reserved.</p>\n                    </div>\n                </div>\n            </body>\n            </html>\n        `,\n    };\n\n    try {\n        await transporter.sendMail(mailOptions);\n        console.log('Verification email sent to:', to);\n    } catch (error) {\n        console.error('Error sending verification email:', error);\n        throw new Error('Could not send verification email.');\n    }\n}\n\n\nexport async function sendPasswordResetEmail(to: string, link: string) {\n    const mailOptions = {\n        from: EMAIL_FROM,\n        to,\n        subject: 'DATGenie: Password Reset Request',\n        html: `\n            <!DOCTYPE html>\n            <html lang=\"en\">\n            <head>\n                <meta charset=\"UTF-8\">\n                <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n                <title>DATGenie Password Reset</title>\n                <style>\n                    body {\n                        margin: 0;\n                        padding: 0;\n                        font-family: 'Inter', Arial, sans-serif;\n                        background-color: #E0F7FA;\n                    }\n                    .container {\n                        padding: 20px;\n                        background-color: #E0F7FA;\n                    }\n                    .card {\n                        background-color: #ffffff;\n                        border-radius: 8px;\n                        padding: 40px;\n                        margin: 40px auto;\n                        max-width: 600px;\n                        text-align: center;\n                        box-shadow: 0 4px 8px rgba(0,0,0,0.1);\n                    }\n                    .logo {\n                        margin-bottom: 20px;\n                    }\n                    h2 {\n                        color: #333333;\n                        font-size: 24px;\n                        margin-bottom: 10px;\n                    }\n                    p {\n                        color: #555555;\n                        font-size: 16px;\n                        line-height: 1.5;\n                        margin-bottom: 20px;\n                    }\n                    .button {\n                        background-color: #29ABE2;\n                        color: #ffffff !important;\n                        padding: 8px 25px;\n                        text-decoration: none;\n                        border-radius: 5px;\n                        display: inline-block;\n                        font-weight: bold;\n                        font-size: 16px;\n                    }\n                    .footer {\n                        text-align: center;\n                        font-size: 12px;\n                        color: #888888;\n                        margin-top: 20px;\n                    }\n                    .note {\n                        font-size: 12px; \n                        color: #555;\n                        margin-top: 30px;\n                    }\n                </style>\n            </head>\n            <body>\n                <div class=\"container\">\n                    <div class=\"card\">\n                        <img src=\"https://i.imgur.com/YuFtLr0.png\" alt=\"DATGenie Logo\" width=\"60\" class=\"logo\">\n                        <h2>Password Reset Request</h2>\n                        <p>We received a request to reset your password. If you did not make this request, you can ignore this email. Otherwise, you can reset your password using this link:</p>\n                        <a href=\"${link}\" class=\"button\" style=\"color: #ffffff;\">Reset Password</a>\n                        <p class=\"note\">Please note: This password reset link is valid for one hour only.</p>\n                    </div>\n                    <div class=\"footer\">\n                        <p>&copy; ${new Date().getFullYear()} DATGenie. All Rights Reserved.</p>\n                    </div>\n                </div>\n            </body>\n            </html>\n        `,\n    };\n\n    try {\n        await transporter.sendMail(mailOptions);\n        console.log('Password reset email sent to:', to);\n    } catch (error) {\n        console.error('Error sending password reset email:', error);\n        throw new Error('Could not send password reset email.');\n    }\n}\n"],"names":[],"mappings":";;;;;;AAGA;;;;;AAEA,MAAM,EACF,iBAAiB,EACjB,iBAAiB,EACjB,iBAAiB,EACjB,qBAAqB,EACrB,UAAU,EACb,GAAG,QAAQ,GAAG;AAEf,MAAM,cAAc,+IAAA,CAAA,UAAU,CAAC,eAAe,CAAC;IAC7C,MAAM;IACN,MAAM,OAAO;IACb,QAAQ;IACR,MAAM;QACJ,MAAM;QACN,MAAM;IACR;IACA,YAAY;AACd;AAEO,eAAe,sBAAsB,EAAU,EAAE,IAAY,EAAE,IAAY;IAC9E,MAAM,cAAc;QAChB,MAAM;QACN;QACA,SAAS;QACT,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;kCAoEmB,EAAE,KAAK;;iCAER,EAAE,KAAK;;;;;kCAKN,EAAE,IAAI,OAAO,WAAW,GAAG;;;;;QAKrD,CAAC;IACL;IAEA,IAAI;QACA,MAAM,YAAY,QAAQ,CAAC;QAC3B,QAAQ,GAAG,CAAC,+BAA+B;IAC/C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,MAAM,IAAI,MAAM;IACpB;AACJ;AAGO,eAAe,uBAAuB,EAAU,EAAE,IAAY;IACjE,MAAM,cAAc;QAChB,MAAM;QACN;QACA,SAAS;QACT,MAAM,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;iCAsEkB,EAAE,KAAK;;;;kCAIN,EAAE,IAAI,OAAO,WAAW,GAAG;;;;;QAKrD,CAAC;IACL;IAEA,IAAI;QACA,MAAM,YAAY,QAAQ,CAAC;QAC3B,QAAQ,GAAG,CAAC,iCAAiC;IACjD,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uCAAuC;QACrD,MAAM,IAAI,MAAM;IACpB;AACJ;;;IAhMsB;IAkGA;;AAlGA,+OAAA;AAkGA,+OAAA","debugId":null}},
    {"offset": {"line": 1720, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions/auth.ts"],"sourcesContent":["\n'use server';\n\nimport { \n    getAllUsers, \n    type SignupData, \n    type LoginData, \n    updateUserFolderId, \n    getAllHeaderDataFromSheet,\n    addSessionToSheet,\n    deleteSessionByToken,\n    addPendingUser,\n    getPendingUserByToken,\n    deletePendingUserByRow,\n    addUser,\n    createDatabaseSheet,\n    updateUserDatabaseId,\n    updateUserPasswordByEmail,\n    deleteAllSessionsByEmail,\n} from '../googlesheets';\nimport { createFolderInDrive } from '../drive';\nimport { sendVerificationEmail, sendPasswordResetEmail } from '../email';\nimport { z } from 'zod';\nimport { headers, cookies } from 'next/headers';\nimport { randomUUID } from 'crypto';\n\n\nconst AuthResultSchema = z.object({\n    success: z.boolean(),\n    error: z.string().nullable(),\n    user: z.object({\n        userName: z.string(),\n        email: z.string().optional(),\n        databaseId: z.string().optional(),\n        folderId: z.string().optional(),\n    }).nullable(),\n});\n\ntype AuthResult = z.infer<typeof AuthResultSchema>;\n\nexport async function signUpUser(userData: SignupData, origin: string): Promise<Pick<AuthResult, 'success' | 'error'>> {\n  try {\n    const users = await getAllUsers();\n    \n    const userNameExists = users.some(user => user.userName.toLowerCase() === userData.userName.toLowerCase());\n    if (userNameExists) {\n        return { success: false, error: 'This username is already taken. Please choose another one.' };\n    }\n\n    const emailExists = users.some(user => user.emailAddress.toLowerCase() === userData.email.toLowerCase());\n    if (emailExists) {\n        return { success: false, error: 'An account with this email address already exists.' };\n    }\n\n    const verificationToken = randomUUID();\n    await addPendingUser({\n        ...userData,\n        token: verificationToken,\n        type: 'signup',\n        expires: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(), // 1 hour from now\n    });\n\n    const verificationLink = `${origin}/verify?token=${verificationToken}`;\n    await sendVerificationEmail(userData.email, userData.userName, verificationLink);\n\n    return { success: true, error: null };\n\n  } catch (e) {\n    console.error('Error during sign up:', e);\n    const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n    return { success: false, error: `Sign up failed: ${errorMessage}` };\n  }\n}\n\nexport async function verifyUserAccount(token: string): Promise<{ success: boolean; error?: string; }> {\n    try {\n        const result = await getPendingUserByToken(token);\n\n        if (!result) {\n            return { success: false, error: 'This verification link is invalid or has expired.' };\n        }\n        \n        const { user: pendingUser, rowIndex } = result;\n\n        if (new Date(pendingUser.expires) < new Date()) {\n            // Fire and forget deletion, no need to wait\n            deletePendingUserByRow(rowIndex).catch(err => {\n                console.error(`[Background] Failed to delete expired pending user at row ${rowIndex}:`, err);\n            });\n            return { success: false, error: 'This verification link has expired. Please sign up again.' };\n        }\n        \n        const folderId = await createFolderInDrive(pendingUser.email);\n        const databaseId = await createDatabaseSheet(pendingUser.email, folderId);\n        \n        await addUser({ \n            email: pendingUser.email,\n            userName: pendingUser.userName,\n            password: pendingUser.password,\n            folderId: folderId,\n            databaseId: databaseId\n        });\n\n        // Fire-and-forget the cleanup operation.\n        deletePendingUserByRow(rowIndex).catch(err => {\n             console.error(`[Background] Failed to delete verified pending user at row ${rowIndex}:`, err);\n        });\n\n        return { success: true };\n\n    } catch (e) {\n        console.error(`Error verifying user with token ${token}:`, e);\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, error: `Account verification failed: ${errorMessage}` };\n    }\n}\n\n\nexport async function loginUser(credentials: LoginData): Promise<AuthResult> {\n    try {\n        const users = await getAllUsers();\n        const user = users.find(u => u.userName === credentials.userName && u.pwd === credentials.password);\n\n        if (user) {\n            let folderId = user.folderId;\n            let databaseId = user.databaseId;\n\n            if (!folderId) {\n                console.log(`User ${user.userName} does not have a folderId. Creating one now.`);\n                folderId = await createFolderInDrive(user.emailAddress);\n                await updateUserFolderId(user.userName, folderId);\n                console.log(`Successfully created and assigned folderId ${folderId} to user ${user.userName}.`);\n            }\n            if (!databaseId) {\n                console.log(`User ${user.userName} does not have a databaseId. Creating one now.`);\n                databaseId = await createDatabaseSheet(user.emailAddress, folderId);\n                await updateUserDatabaseId(user.userName, databaseId);\n                 console.log(`Successfully created and assigned databaseId ${databaseId} to user ${user.userName}.`);\n            }\n\n            if (databaseId) {\n                 try {\n                    await getAllHeaderDataFromSheet(databaseId);\n                } catch(sheetError) {\n                    console.error(`Failed to access sheet with ID ${databaseId}`, sheetError);\n                    return { success: false, error: 'Failed to retrieve data from Google Sheet. Check Sheet ID and permissions.', user: null };\n                }\n            }\n            \n            const sessionToken = randomUUID();\n            const headersList = headers();\n            const ipAddress = headersList.get('x-forwarded-for') || 'Unknown';\n            const deviceInfo = headersList.get('user-agent') || 'Unknown';\n\n            await addSessionToSheet({\n                emailAddress: user.emailAddress,\n                sessionToken,\n                ipAddress,\n                deviceInfo,\n            });\n            \n            cookies().set('sessionToken', sessionToken, {\n                httpOnly: true,\n                secure: process.env.NODE_ENV === 'production',\n                maxAge: 60 * 60 * 24 * 7, // One week\n                path: '/',\n            });\n\n            return { \n                success: true, \n                error: null, \n                user: { \n                    userName: user.userName, \n                    email: user.emailAddress, \n                    databaseId: databaseId, \n                    folderId: folderId,\n                } \n            };\n        } else {\n            return { success: false, error: 'Invalid username or password.', user: null };\n        }\n    } catch (e) {\n        console.error('Error logging in user:', e);\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, error: `Failed to login: ${errorMessage}`, user: null };\n    }\n}\n\nexport async function requestPasswordReset(email: string, origin: string): Promise<{ success: boolean; error?: string }> {\n    try {\n        const users = await getAllUsers();\n        const userExists = users.some(user => user.emailAddress.toLowerCase() === email.toLowerCase());\n\n        if (!userExists) {\n            return { success: false, error: 'This email is not registered with an account.' };\n        }\n        \n        const verificationToken = randomUUID();\n        await addPendingUser({\n            email: email,\n            token: verificationToken,\n            type: 'forgotpassword',\n            expires: new Date(Date.now() + 1 * 60 * 60 * 1000).toISOString(), // 1 hour from now\n        });\n\n        const resetLink = `${origin}/reset-password?token=${verificationToken}`;\n        await sendPasswordResetEmail(email, resetLink);\n        \n        return { success: true };\n\n    } catch (e) {\n        console.error('Error during password reset request:', e);\n        // We return a generic error message to the user, but log the specific error.\n        return { success: false, error: 'An unexpected error occurred. Please try again.' };\n    }\n}\n\nexport async function resetUserPassword(token: string, newPassword: string): Promise<{ success: boolean; error?: string; }> {\n    try {\n        const result = await getPendingUserByToken(token);\n\n        if (!result) {\n            return { success: false, error: 'This password reset link is invalid or has expired.' };\n        }\n        \n        const { user: pendingUser, rowIndex } = result;\n        \n        if (new Date(pendingUser.expires) < new Date()) {\n            deletePendingUserByRow(rowIndex).catch(err => {\n                console.error(`[Background] Failed to delete expired pending user at row ${rowIndex}:`, err);\n            });\n            return { success: false, error: 'This password reset link has expired. Please request a new one.' };\n        }\n\n        await updateUserPasswordByEmail(pendingUser.email, newPassword);\n\n        // Security measure: Log out all active sessions for this user.\n        await deleteAllSessionsByEmail(pendingUser.email);\n        \n        deletePendingUserByRow(rowIndex).catch(err => {\n             console.error(`[Background] Failed to delete verified pending user at row ${rowIndex}:`, err);\n        });\n\n        return { success: true };\n\n    } catch(e) {\n        console.error(`Error resetting password with token ${token}:`, e);\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, error: `Password reset failed: ${errorMessage}` };\n    }\n}\n\nconst LogoutResultSchema = z.object({ success: z.boolean() });\ntype LogoutResult = z.infer<typeof LogoutResultSchema>;\n\nexport async function logoutUser(): Promise<LogoutResult> {\n    const sessionToken = cookies().get('sessionToken')?.value;\n    if (sessionToken) {\n        await deleteSessionByToken(sessionToken);\n        cookies().delete('sessionToken');\n    }\n    return { success: true };\n}\n"],"names":[],"mappings":";;;;;;;;;;AAGA;AAiBA;AACA;AACA;AACA;AACA;;;;;;;;;;AAGA,MAAM,mBAAmB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC9B,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,MAAM,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;QACX,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM;QAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;QAC1B,YAAY,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;QAC/B,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,GAAG,QAAQ;AACf;AAIO,eAAe,WAAW,QAAoB,EAAE,MAAc;IACnE,IAAI;QACF,MAAM,QAAQ,MAAM,CAAA,GAAA,0HAAA,CAAA,cAAW,AAAD;QAE9B,MAAM,iBAAiB,MAAM,IAAI,CAAC,CAAA,OAAQ,KAAK,QAAQ,CAAC,WAAW,OAAO,SAAS,QAAQ,CAAC,WAAW;QACvG,IAAI,gBAAgB;YAChB,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAA6D;QACjG;QAEA,MAAM,cAAc,MAAM,IAAI,CAAC,CAAA,OAAQ,KAAK,YAAY,CAAC,WAAW,OAAO,SAAS,KAAK,CAAC,WAAW;QACrG,IAAI,aAAa;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAqD;QACzF;QAEA,MAAM,oBAAoB,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD;QACnC,MAAM,CAAA,GAAA,0HAAA,CAAA,iBAAc,AAAD,EAAE;YACjB,GAAG,QAAQ;YACX,OAAO;YACP,MAAM;YACN,SAAS,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,MAAM,WAAW;QAClE;QAEA,MAAM,mBAAmB,GAAG,OAAO,cAAc,EAAE,mBAAmB;QACtE,MAAM,CAAA,GAAA,mHAAA,CAAA,wBAAqB,AAAD,EAAE,SAAS,KAAK,EAAE,SAAS,QAAQ,EAAE;QAE/D,OAAO;YAAE,SAAS;YAAM,OAAO;QAAK;IAEtC,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,yBAAyB;QACvC,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,gBAAgB,EAAE,cAAc;QAAC;IACpE;AACF;AAEO,eAAe,kBAAkB,KAAa;IACjD,IAAI;QACA,MAAM,SAAS,MAAM,CAAA,GAAA,0HAAA,CAAA,wBAAqB,AAAD,EAAE;QAE3C,IAAI,CAAC,QAAQ;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAoD;QACxF;QAEA,MAAM,EAAE,MAAM,WAAW,EAAE,QAAQ,EAAE,GAAG;QAExC,IAAI,IAAI,KAAK,YAAY,OAAO,IAAI,IAAI,QAAQ;YAC5C,4CAA4C;YAC5C,CAAA,GAAA,0HAAA,CAAA,yBAAsB,AAAD,EAAE,UAAU,KAAK,CAAC,CAAA;gBACnC,QAAQ,KAAK,CAAC,CAAC,0DAA0D,EAAE,SAAS,CAAC,CAAC,EAAE;YAC5F;YACA,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAA4D;QAChG;QAEA,MAAM,WAAW,MAAM,CAAA,GAAA,mHAAA,CAAA,sBAAmB,AAAD,EAAE,YAAY,KAAK;QAC5D,MAAM,aAAa,MAAM,CAAA,GAAA,0HAAA,CAAA,sBAAmB,AAAD,EAAE,YAAY,KAAK,EAAE;QAEhE,MAAM,CAAA,GAAA,0HAAA,CAAA,UAAO,AAAD,EAAE;YACV,OAAO,YAAY,KAAK;YACxB,UAAU,YAAY,QAAQ;YAC9B,UAAU,YAAY,QAAQ;YAC9B,UAAU;YACV,YAAY;QAChB;QAEA,yCAAyC;QACzC,CAAA,GAAA,0HAAA,CAAA,yBAAsB,AAAD,EAAE,UAAU,KAAK,CAAC,CAAA;YAClC,QAAQ,KAAK,CAAC,CAAC,2DAA2D,EAAE,SAAS,CAAC,CAAC,EAAE;QAC9F;QAEA,OAAO;YAAE,SAAS;QAAK;IAE3B,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,MAAM,CAAC,CAAC,EAAE;QAC3D,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,6BAA6B,EAAE,cAAc;QAAC;IACnF;AACJ;AAGO,eAAe,UAAU,WAAsB;IAClD,IAAI;QACA,MAAM,QAAQ,MAAM,CAAA,GAAA,0HAAA,CAAA,cAAW,AAAD;QAC9B,MAAM,OAAO,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK,YAAY,QAAQ,IAAI,EAAE,GAAG,KAAK,YAAY,QAAQ;QAElG,IAAI,MAAM;YACN,IAAI,WAAW,KAAK,QAAQ;YAC5B,IAAI,aAAa,KAAK,UAAU;YAEhC,IAAI,CAAC,UAAU;gBACX,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,KAAK,QAAQ,CAAC,4CAA4C,CAAC;gBAC/E,WAAW,MAAM,CAAA,GAAA,mHAAA,CAAA,sBAAmB,AAAD,EAAE,KAAK,YAAY;gBACtD,MAAM,CAAA,GAAA,0HAAA,CAAA,qBAAkB,AAAD,EAAE,KAAK,QAAQ,EAAE;gBACxC,QAAQ,GAAG,CAAC,CAAC,2CAA2C,EAAE,SAAS,SAAS,EAAE,KAAK,QAAQ,CAAC,CAAC,CAAC;YAClG;YACA,IAAI,CAAC,YAAY;gBACb,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,KAAK,QAAQ,CAAC,8CAA8C,CAAC;gBACjF,aAAa,MAAM,CAAA,GAAA,0HAAA,CAAA,sBAAmB,AAAD,EAAE,KAAK,YAAY,EAAE;gBAC1D,MAAM,CAAA,GAAA,0HAAA,CAAA,uBAAoB,AAAD,EAAE,KAAK,QAAQ,EAAE;gBACzC,QAAQ,GAAG,CAAC,CAAC,6CAA6C,EAAE,WAAW,SAAS,EAAE,KAAK,QAAQ,CAAC,CAAC,CAAC;YACvG;YAEA,IAAI,YAAY;gBACX,IAAI;oBACD,MAAM,CAAA,GAAA,0HAAA,CAAA,4BAAyB,AAAD,EAAE;gBACpC,EAAE,OAAM,YAAY;oBAChB,QAAQ,KAAK,CAAC,CAAC,+BAA+B,EAAE,YAAY,EAAE;oBAC9D,OAAO;wBAAE,SAAS;wBAAO,OAAO;wBAA8E,MAAM;oBAAK;gBAC7H;YACJ;YAEA,MAAM,eAAe,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD;YAC9B,MAAM,cAAc,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;YAC1B,MAAM,YAAY,YAAY,GAAG,CAAC,sBAAsB;YACxD,MAAM,aAAa,YAAY,GAAG,CAAC,iBAAiB;YAEpD,MAAM,CAAA,GAAA,0HAAA,CAAA,oBAAiB,AAAD,EAAE;gBACpB,cAAc,KAAK,YAAY;gBAC/B;gBACA;gBACA;YACJ;YAEA,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,IAAI,GAAG,CAAC,gBAAgB,cAAc;gBACxC,UAAU;gBACV,QAAQ,oDAAyB;gBACjC,QAAQ,KAAK,KAAK,KAAK;gBACvB,MAAM;YACV;YAEA,OAAO;gBACH,SAAS;gBACT,OAAO;gBACP,MAAM;oBACF,UAAU,KAAK,QAAQ;oBACvB,OAAO,KAAK,YAAY;oBACxB,YAAY;oBACZ,UAAU;gBACd;YACJ;QACJ,OAAO;YACH,OAAO;gBAAE,SAAS;gBAAO,OAAO;gBAAiC,MAAM;YAAK;QAChF;IACJ,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,0BAA0B;QACxC,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,iBAAiB,EAAE,cAAc;YAAE,MAAM;QAAK;IACnF;AACJ;AAEO,eAAe,qBAAqB,KAAa,EAAE,MAAc;IACpE,IAAI;QACA,MAAM,QAAQ,MAAM,CAAA,GAAA,0HAAA,CAAA,cAAW,AAAD;QAC9B,MAAM,aAAa,MAAM,IAAI,CAAC,CAAA,OAAQ,KAAK,YAAY,CAAC,WAAW,OAAO,MAAM,WAAW;QAE3F,IAAI,CAAC,YAAY;YACb,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAgD;QACpF;QAEA,MAAM,oBAAoB,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD;QACnC,MAAM,CAAA,GAAA,0HAAA,CAAA,iBAAc,AAAD,EAAE;YACjB,OAAO;YACP,OAAO;YACP,MAAM;YACN,SAAS,IAAI,KAAK,KAAK,GAAG,KAAK,IAAI,KAAK,KAAK,MAAM,WAAW;QAClE;QAEA,MAAM,YAAY,GAAG,OAAO,sBAAsB,EAAE,mBAAmB;QACvE,MAAM,CAAA,GAAA,mHAAA,CAAA,yBAAsB,AAAD,EAAE,OAAO;QAEpC,OAAO;YAAE,SAAS;QAAK;IAE3B,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,wCAAwC;QACtD,6EAA6E;QAC7E,OAAO;YAAE,SAAS;YAAO,OAAO;QAAkD;IACtF;AACJ;AAEO,eAAe,kBAAkB,KAAa,EAAE,WAAmB;IACtE,IAAI;QACA,MAAM,SAAS,MAAM,CAAA,GAAA,0HAAA,CAAA,wBAAqB,AAAD,EAAE;QAE3C,IAAI,CAAC,QAAQ;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAsD;QAC1F;QAEA,MAAM,EAAE,MAAM,WAAW,EAAE,QAAQ,EAAE,GAAG;QAExC,IAAI,IAAI,KAAK,YAAY,OAAO,IAAI,IAAI,QAAQ;YAC5C,CAAA,GAAA,0HAAA,CAAA,yBAAsB,AAAD,EAAE,UAAU,KAAK,CAAC,CAAA;gBACnC,QAAQ,KAAK,CAAC,CAAC,0DAA0D,EAAE,SAAS,CAAC,CAAC,EAAE;YAC5F;YACA,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAkE;QACtG;QAEA,MAAM,CAAA,GAAA,0HAAA,CAAA,4BAAyB,AAAD,EAAE,YAAY,KAAK,EAAE;QAEnD,+DAA+D;QAC/D,MAAM,CAAA,GAAA,0HAAA,CAAA,2BAAwB,AAAD,EAAE,YAAY,KAAK;QAEhD,CAAA,GAAA,0HAAA,CAAA,yBAAsB,AAAD,EAAE,UAAU,KAAK,CAAC,CAAA;YAClC,QAAQ,KAAK,CAAC,CAAC,2DAA2D,EAAE,SAAS,CAAC,CAAC,EAAE;QAC9F;QAEA,OAAO;YAAE,SAAS;QAAK;IAE3B,EAAE,OAAM,GAAG;QACP,QAAQ,KAAK,CAAC,CAAC,oCAAoC,EAAE,MAAM,CAAC,CAAC,EAAE;QAC/D,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,uBAAuB,EAAE,cAAc;QAAC;IAC7E;AACJ;AAEA,MAAM,qBAAqB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAAE,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;AAAG;AAGpD,eAAe;IAClB,MAAM,eAAe,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,IAAI,GAAG,CAAC,iBAAiB;IACpD,IAAI,cAAc;QACd,MAAM,CAAA,GAAA,0HAAA,CAAA,uBAAoB,AAAD,EAAE;QAC3B,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD,IAAI,MAAM,CAAC;IACrB;IACA,OAAO;QAAE,SAAS;IAAK;AAC3B;;;IA9NsB;IAkCA;IA4CA;IAsEA;IA6BA;IAsCA;;AAvNA,+OAAA;AAkCA,+OAAA;AA4CA,+OAAA;AAsEA,+OAAA;AA6BA,+OAAA;AAsCA,+OAAA","debugId":null}},
    {"offset": {"line": 2015, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/schemas.ts"],"sourcesContent":["\nimport { z } from 'zod';\n\nconst alphanumericWithSpaces = (name: string, length: number, required = true) => {\n  const schema = z.string()\n   .max(length, `${name} must be ${length} characters or less.`)\n   .regex(/^[a-zA-Z0-9\\s]*$/, `${name} must only contain letters, numbers, and spaces.`);\n  \n  if (required) {\n    return schema.min(1, `${name} is required.`);\n  }\n  return schema.optional().or(z.literal(''));\n};\n\nexport const TaxProfileSchema = z.object({\n  tpTIN: z.string().regex(/^[0-9]{9}$/, 'TIN must be 9 digits.'),\n  branchCode: z.string().regex(/^[0-9]{4}$/, 'Branch code must be 4 digits.'),\n  rdoCode: z.string().min(1, 'RDO Code is required.'),\n  entityType: z.string(),\n  cycleType: z.string(),\n  monthSelect: z.string().min(1, 'Month is required.'),\n  companyName: alphanumericWithSpaces('Company Name', 50, false),\n  lastName: alphanumericWithSpaces('Last Name', 30, false),\n  firstName: alphanumericWithSpaces('First Name', 30, false),\n  middleName: alphanumericWithSpaces('Middle Name', 30, false),\n  tradeName: alphanumericWithSpaces('Trade Name', 50),\n  subStreet: z.string().max(30, 'Unit/Floor/Substreet must be 30 characters or less.').optional().or(z.literal('')),\n  street: z.string().max(30, 'Street must be 30 characters or less.').min(1, 'Street is required.'),\n  barangay: z.string().max(30, 'Barangay must be 30 characters or less.').min(1, 'Barangay is required.'),\n  cityMunicipality: z.string().max(30, 'City/Municipality must be 30 characters or less.').min(1, 'City/Municipality is required.'),\n  province: z.string().max(30, 'Province must be 30 characters or less.').min(1, 'Province is required.'),\n  zipCode: z.string().regex(/^[0-9]{4}$/, 'Zip code must be 4 digits.'),\n}).passthrough().refine(data => {\n    if (data.entityType === 'Individual') {\n        return !!data.lastName && !!data.firstName && !!data.middleName;\n    }\n    return true;\n}, {\n    message: \"First, Middle, and Last name are required for individuals.\",\n    path: [\"lastName\"], \n}).refine(data => {\n    if (data.entityType === 'Non-Individual') {\n        return !!data.companyName;\n    }\n    return true;\n}, {\n    message: \"Company name is required for non-individuals.\",\n    path: [\"companyName\"],\n});\n\n\nexport type TaxProfile = z.infer<typeof TaxProfileSchema>;\n\n\nexport const MutationResultSchema = z.object({\n    success: z.boolean(),\n    error: z.string().nullable(),\n    data: TaxProfileSchema.nullable(),\n});\n\nexport const DatFileSchema = z.object({\n  id: z.string(),\n  name: z.string(),\n  path: z.string(),\n  modifiedTime: z.string(),\n});\nexport type DatFile = z.infer<typeof DatFileSchema>;\n\n\nexport const UserDetailsSchema = z.object({\n    userName: z.string(),\n    email: z.string().email(),\n    databaseId: z.string().optional(),\n    folderId: z.string().optional(),\n});\nexport type UserDetails = z.infer<typeof UserDetailsSchema>;\n\nexport const UserUpdateDataSchema = z.object({\n    newUserName: z.string().optional(),\n    currentPassword: z.string().optional(),\n    newPassword: z.string().optional(),\n});\nexport type UserUpdateData = z.infer<typeof UserUpdateDataSchema>;\n\nexport const SessionInfoSchema = z.object({\n    token: z.string(),\n    loginTime: z.string(),\n    ipAddress: z.string(),\n    deviceInfo: z.string(),\n});\nexport type SessionInfo = z.infer<typeof SessionInfoSchema>;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2105, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions/profiles.ts"],"sourcesContent":["'use server';\n\nimport type { TaxProfile } from '@/lib/schemas';\nimport { TaxProfileSchema, MutationResultSchema } from '@/lib/schemas';\nimport { getAllHeaderDataFromSheet, appendHeaderDataToSheet, updateHeaderDataInSheet, deleteHeaderDataRowInSheet } from '../googlesheets';\nimport { z } from 'zod';\n\nconst TaxProfileResultSchema = z.object({\n  success: z.boolean(),\n  data: z.array(TaxProfileSchema).nullable(),\n  error: z.string().nullable(),\n});\ntype TaxProfileResult = z.infer<typeof TaxProfileResultSchema>;\n\nexport async function getUserHeaderData(databaseId: string): Promise<TaxProfileResult> {\n  try {\n    if (!databaseId) {\n      return { success: false, data: null, error: 'Database ID is required.' };\n    }\n    const headerData = await getAllHeaderDataFromSheet(databaseId);\n    return { success: true, data: headerData, error: null };\n  } catch (error) {\n    console.error('Error fetching header data:', error);\n    const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred.';\n    return { success: false, data: null, error: `Failed to fetch header data: ${errorMessage}` };\n  }\n}\n\n\ntype MutationResult = z.infer<typeof MutationResultSchema>;\n\nfunction transformToUppercase(data: TaxProfile): TaxProfile {\n  const uppercasedData: { [key: string]: any } = {};\n  for (const key in data) {\n    const value = data[key as keyof TaxProfile];\n    if (typeof value === 'string' && key !== 'entityType' && key !== 'cycleType' && key !== 'monthSelect' && key !== 'rdoCode') {\n      uppercasedData[key] = value.toUpperCase();\n    } else {\n      uppercasedData[key] = value;\n    }\n  }\n  return uppercasedData as TaxProfile;\n}\n\nexport async function addTaxProfile(profileData: TaxProfile, databaseId: string): Promise<MutationResult> {\n  try {\n    const validatedData = TaxProfileSchema.parse(profileData);\n\n    const existingProfiles = await getAllHeaderDataFromSheet(databaseId);\n    const tinExists = existingProfiles.some(p => p.tpTIN === validatedData.tpTIN);\n\n    if (tinExists) {\n        return { \n            success: false, \n            error: 'This TIN already has a profile. Please check your data or refresh the page.', \n            data: null \n        };\n    }\n\n    const uppercasedData = transformToUppercase(validatedData);\n    await appendHeaderDataToSheet(uppercasedData, databaseId);\n    return { success: true, error: null, data: uppercasedData };\n  } catch (e) {\n    console.error('Error adding tax profile:', e);\n    const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n    return { success: false, error: `Failed to add profile: ${errorMessage}`, data: null };\n  }\n}\n\n\nexport async function updateTaxProfile(profileData: TaxProfile, databaseId: string): Promise<MutationResult> {\n  try {\n    const validatedData = TaxProfileSchema.parse(profileData);\n    const uppercasedData = transformToUppercase(validatedData);\n    await updateHeaderDataInSheet(uppercasedData, databaseId);\n    return { success: true, error: null, data: uppercasedData };\n  } catch (e) {\n    console.error('Error updating tax profile:', e);\n    const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n    return { success: false, error: `Failed to update profile: ${errorMessage}`, data: null };\n  }\n}\n\nconst SimpleResultSchema = z.object({\n    success: z.boolean(),\n    error: z.string().nullable(),\n});\ntype SimpleResult = z.infer<typeof SimpleResultSchema>;\n\nexport async function deleteTaxProfile(tpTIN: string, databaseId: string): Promise<SimpleResult> {\n    try {\n        await deleteHeaderDataRowInSheet(tpTIN, databaseId);\n        return { success: true, error: null };\n    } catch (e) {\n        console.error('Error deleting tax profile:', e);\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, error: `Failed to delete profile: ${errorMessage}` };\n    }\n}\n"],"names":[],"mappings":";;;;;;;;AAGA;AACA;AACA;;;;;;;AAEA,MAAM,yBAAyB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACtC,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,MAAM,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,qHAAA,CAAA,mBAAgB,EAAE,QAAQ;IACxC,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAGO,eAAe,kBAAkB,UAAkB;IACxD,IAAI;QACF,IAAI,CAAC,YAAY;YACf,OAAO;gBAAE,SAAS;gBAAO,MAAM;gBAAM,OAAO;YAA2B;QACzE;QACA,MAAM,aAAa,MAAM,CAAA,GAAA,0HAAA,CAAA,4BAAyB,AAAD,EAAE;QACnD,OAAO;YAAE,SAAS;YAAM,MAAM;YAAY,OAAO;QAAK;IACxD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO;YAAE,SAAS;YAAO,MAAM;YAAM,OAAO,CAAC,6BAA6B,EAAE,cAAc;QAAC;IAC7F;AACF;AAKA,SAAS,qBAAqB,IAAgB;IAC5C,MAAM,iBAAyC,CAAC;IAChD,IAAK,MAAM,OAAO,KAAM;QACtB,MAAM,QAAQ,IAAI,CAAC,IAAwB;QAC3C,IAAI,OAAO,UAAU,YAAY,QAAQ,gBAAgB,QAAQ,eAAe,QAAQ,iBAAiB,QAAQ,WAAW;YAC1H,cAAc,CAAC,IAAI,GAAG,MAAM,WAAW;QACzC,OAAO;YACL,cAAc,CAAC,IAAI,GAAG;QACxB;IACF;IACA,OAAO;AACT;AAEO,eAAe,cAAc,WAAuB,EAAE,UAAkB;IAC7E,IAAI;QACF,MAAM,gBAAgB,qHAAA,CAAA,mBAAgB,CAAC,KAAK,CAAC;QAE7C,MAAM,mBAAmB,MAAM,CAAA,GAAA,0HAAA,CAAA,4BAAyB,AAAD,EAAE;QACzD,MAAM,YAAY,iBAAiB,IAAI,CAAC,CAAA,IAAK,EAAE,KAAK,KAAK,cAAc,KAAK;QAE5E,IAAI,WAAW;YACX,OAAO;gBACH,SAAS;gBACT,OAAO;gBACP,MAAM;YACV;QACJ;QAEA,MAAM,iBAAiB,qBAAqB;QAC5C,MAAM,CAAA,GAAA,0HAAA,CAAA,0BAAuB,AAAD,EAAE,gBAAgB;QAC9C,OAAO;YAAE,SAAS;YAAM,OAAO;YAAM,MAAM;QAAe;IAC5D,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,uBAAuB,EAAE,cAAc;YAAE,MAAM;QAAK;IACvF;AACF;AAGO,eAAe,iBAAiB,WAAuB,EAAE,UAAkB;IAChF,IAAI;QACF,MAAM,gBAAgB,qHAAA,CAAA,mBAAgB,CAAC,KAAK,CAAC;QAC7C,MAAM,iBAAiB,qBAAqB;QAC5C,MAAM,CAAA,GAAA,0HAAA,CAAA,0BAAuB,AAAD,EAAE,gBAAgB;QAC9C,OAAO;YAAE,SAAS;YAAM,OAAO;YAAM,MAAM;QAAe;IAC5D,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,0BAA0B,EAAE,cAAc;YAAE,MAAM;QAAK;IAC1F;AACF;AAEA,MAAM,qBAAqB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAChC,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC9B;AAGO,eAAe,iBAAiB,KAAa,EAAE,UAAkB;IACpE,IAAI;QACA,MAAM,CAAA,GAAA,0HAAA,CAAA,6BAA0B,AAAD,EAAE,OAAO;QACxC,OAAO;YAAE,SAAS;YAAM,OAAO;QAAK;IACxC,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,0BAA0B,EAAE,cAAc;QAAC;IAChF;AACJ;;;IApFsB;IA8BA;IA0BA;IAmBA;;AA3EA,+OAAA;AA8BA,+OAAA;AA0BA,+OAAA;AAmBA,+OAAA","debugId":null}},
    {"offset": {"line": 2250, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions/drive.ts"],"sourcesContent":["\n'use server';\n\nimport { listDatFiles, downloadFileFromDrive, deleteFileFromDrive, getInitialPageTokenForDrive, listChangesSincePageToken } from '../drive';\nimport type { DatFile } from '@/lib/schemas';\nimport { DatFileSchema } from '@/lib/schemas';\nimport { z } from 'zod';\n\n\nconst DatFileListingResultSchema = z.object({\n  success: z.boolean(),\n  files: z.array(DatFileSchema).nullable(),\n  folderIds: z.array(z.string()).nullable(),\n  error: z.string().nullable(),\n});\ntype DatFileListingResult = z.infer<typeof DatFileListingResultSchema>;\n\nexport async function getDatFiles(folderId: string): Promise<DatFileListingResult> {\n    if (!folderId) {\n        return { success: false, files: null, folderIds: null, error: 'User folder ID is missing.' };\n    }\n    try {\n        const { files, folderIds } = await listDatFiles(folderId);\n        return { success: true, files, folderIds, error: null };\n    } catch (e) {\n        console.error('[getDatFiles] CRITICAL ERROR:', e);\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, files: null, folderIds: null, error: `Failed to retrieve DAT files: ${errorMessage}` };\n    }\n}\n\nconst DatFileContentResultSchema = z.object({\n    success: z.boolean(),\n    content: z.string().nullable(),\n    error: z.string().nullable(),\n});\ntype DatFileContentResult = z.infer<typeof DatFileContentResultSchema>;\n\nexport async function getDatFileContent(fileId: string): Promise<DatFileContentResult> {\n    try {\n        if (!fileId) {\n            return { success: false, content: null, error: 'File ID is required.' };\n        }\n        const content = await downloadFileFromDrive(fileId);\n        return { success: true, content: content, error: null };\n    } catch (error: any) {\n        if (error.code === 404) {\n            return { success: false, content: null, error: 'File not found.' };\n        }\n        console.error(`[getDatFileContent] CRITICAL ERROR for fileId ${fileId}:`, error);\n        const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred.';\n        return { success: false, content: null, error: `Failed to retrieve file content: ${errorMessage}` };\n    }\n}\n\n\nconst SimpleResultSchema = z.object({\n    success: z.boolean(),\n    error: z.string().nullable(),\n});\ntype SimpleResult = z.infer<typeof SimpleResultSchema>;\n\n\nexport async function deleteDatFile(fileId: string): Promise<SimpleResult> {\n    try {\n        if (!fileId) {\n            return { success: false, error: 'File ID is required.' };\n        }\n        await deleteFileFromDrive(fileId);\n        return { success: true, error: null };\n    } catch (error: any) {\n        if (error.code === 404) {\n            return { success: false, error: 'File not found.' };\n        }\n        console.error(`[deleteDatFile] CRITICAL ERROR for fileId ${fileId}:`, error);\n        const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred.';\n        return { success: false, error: `Failed to delete file: ${errorMessage}` };\n    }\n}\n\nconst PageTokenResultSchema = z.object({\n  success: z.boolean(),\n  token: z.string().nullable(),\n  error: z.string().nullable(),\n});\ntype PageTokenResult = z.infer<typeof PageTokenResultSchema>;\n\nexport async function getInitialPageToken(): Promise<PageTokenResult> {\n    try {\n        const token = await getInitialPageTokenForDrive();\n        return { success: true, token, error: null };\n    } catch (e) {\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, token: null, error: `Failed to get initial page token: ${errorMessage}` };\n    }\n}\n\nconst ChangesResultSchema = z.object({\n  success: z.boolean(),\n  hasChanges: z.boolean(),\n  newToken: z.string().nullable(),\n  error: z.string().nullable(),\n});\ntype ChangesResult = z.infer<typeof ChangesResultSchema>;\n\nexport async function checkForDatFileChanges(allFolderIds: string[], pageToken: string): Promise<ChangesResult> {\n    if (!allFolderIds || allFolderIds.length === 0 || !pageToken) {\n        return { success: false, hasChanges: false, newToken: null, error: 'Folder IDs and page token are required.' };\n    }\n    try {\n        const { hasChanges, newPageToken } = await listChangesSincePageToken(allFolderIds, pageToken);\n        return { success: true, hasChanges, newToken: newPageToken, error: null };\n    } catch (e) {\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, hasChanges: false, newToken: pageToken, error: `Failed to check for changes: ${errorMessage}` };\n    }\n}\n"],"names":[],"mappings":";;;;;;;;;AAGA;AAEA;AACA;;;;;;;AAGA,MAAM,6BAA6B,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC1C,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,qHAAA,CAAA,gBAAa,EAAE,QAAQ;IACtC,WAAW,oIAAA,CAAA,IAAC,CAAC,KAAK,CAAC,oIAAA,CAAA,IAAC,CAAC,MAAM,IAAI,QAAQ;IACvC,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAGO,eAAe,YAAY,QAAgB;IAC9C,IAAI,CAAC,UAAU;QACX,OAAO;YAAE,SAAS;YAAO,OAAO;YAAM,WAAW;YAAM,OAAO;QAA6B;IAC/F;IACA,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,GAAG,MAAM,CAAA,GAAA,mHAAA,CAAA,eAAY,AAAD,EAAE;QAChD,OAAO;YAAE,SAAS;YAAM;YAAO;YAAW,OAAO;QAAK;IAC1D,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC,iCAAiC;QAC/C,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO;YAAM,WAAW;YAAM,OAAO,CAAC,8BAA8B,EAAE,cAAc;QAAC;IAClH;AACJ;AAEA,MAAM,6BAA6B,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACxC,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,SAAS,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAC5B,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC9B;AAGO,eAAe,kBAAkB,MAAc;IAClD,IAAI;QACA,IAAI,CAAC,QAAQ;YACT,OAAO;gBAAE,SAAS;gBAAO,SAAS;gBAAM,OAAO;YAAuB;QAC1E;QACA,MAAM,UAAU,MAAM,CAAA,GAAA,mHAAA,CAAA,wBAAqB,AAAD,EAAE;QAC5C,OAAO;YAAE,SAAS;YAAM,SAAS;YAAS,OAAO;QAAK;IAC1D,EAAE,OAAO,OAAY;QACjB,IAAI,MAAM,IAAI,KAAK,KAAK;YACpB,OAAO;gBAAE,SAAS;gBAAO,SAAS;gBAAM,OAAO;YAAkB;QACrE;QACA,QAAQ,KAAK,CAAC,CAAC,8CAA8C,EAAE,OAAO,CAAC,CAAC,EAAE;QAC1E,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO;YAAE,SAAS;YAAO,SAAS;YAAM,OAAO,CAAC,iCAAiC,EAAE,cAAc;QAAC;IACtG;AACJ;AAGA,MAAM,qBAAqB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAChC,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC9B;AAIO,eAAe,cAAc,MAAc;IAC9C,IAAI;QACA,IAAI,CAAC,QAAQ;YACT,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAuB;QAC3D;QACA,MAAM,CAAA,GAAA,mHAAA,CAAA,sBAAmB,AAAD,EAAE;QAC1B,OAAO;YAAE,SAAS;YAAM,OAAO;QAAK;IACxC,EAAE,OAAO,OAAY;QACjB,IAAI,MAAM,IAAI,KAAK,KAAK;YACpB,OAAO;gBAAE,SAAS;gBAAO,OAAO;YAAkB;QACtD;QACA,QAAQ,KAAK,CAAC,CAAC,0CAA0C,EAAE,OAAO,CAAC,CAAC,EAAE;QACtE,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAC9D,OAAO;YAAE,SAAS;YAAO,OAAO,CAAC,uBAAuB,EAAE,cAAc;QAAC;IAC7E;AACJ;AAEA,MAAM,wBAAwB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACrC,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAC1B,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAGO,eAAe;IAClB,IAAI;QACA,MAAM,QAAQ,MAAM,CAAA,GAAA,mHAAA,CAAA,8BAA2B,AAAD;QAC9C,OAAO;YAAE,SAAS;YAAM;YAAO,OAAO;QAAK;IAC/C,EAAE,OAAO,GAAG;QACR,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,OAAO;YAAM,OAAO,CAAC,kCAAkC,EAAE,cAAc;QAAC;IACrG;AACJ;AAEA,MAAM,sBAAsB,oIAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACnC,SAAS,oIAAA,CAAA,IAAC,CAAC,OAAO;IAClB,YAAY,oIAAA,CAAA,IAAC,CAAC,OAAO;IACrB,UAAU,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAC7B,OAAO,oIAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;AAC5B;AAGO,eAAe,uBAAuB,YAAsB,EAAE,SAAiB;IAClF,IAAI,CAAC,gBAAgB,aAAa,MAAM,KAAK,KAAK,CAAC,WAAW;QAC1D,OAAO;YAAE,SAAS;YAAO,YAAY;YAAO,UAAU;YAAM,OAAO;QAA0C;IACjH;IACA,IAAI;QACA,MAAM,EAAE,UAAU,EAAE,YAAY,EAAE,GAAG,MAAM,CAAA,GAAA,mHAAA,CAAA,4BAAyB,AAAD,EAAE,cAAc;QACnF,OAAO;YAAE,SAAS;YAAM;YAAY,UAAU;YAAc,OAAO;QAAK;IAC5E,EAAE,OAAO,GAAG;QACR,MAAM,eAAe,aAAa,QAAQ,EAAE,OAAO,GAAG;QACtD,OAAO;YAAE,SAAS;YAAO,YAAY;YAAO,UAAU;YAAW,OAAO,CAAC,6BAA6B,EAAE,cAAc;QAAC;IAC3H;AACJ;;;IAnGsB;IAqBA;IAyBA;IAwBA;IAkBA;;AAxFA,+OAAA;AAqBA,+OAAA;AAyBA,+OAAA;AAwBA,+OAAA;AAkBA,+OAAA","debugId":null}},
    {"offset": {"line": 2445, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions/users.ts"],"sourcesContent":["\n'use server';\n\nimport { z } from 'zod';\nimport { getAllUsers, updateUserDataInSheet, getSessionsByEmail, deleteSessionByToken, deleteAllOtherSessionsByToken, findUserByTokenFromSheet } from '../googlesheets';\nimport type { UserDetails, UserUpdateData, SessionInfo } from '../schemas';\nimport { SessionInfoSchema, UserDetailsSchema } from '../schemas';\nimport { cookies } from 'next/headers';\n\nconst UserDetailsResultSchema = z.object({\n    success: z.boolean(),\n    data: UserDetailsSchema.nullable(),\n    error: z.string().nullable(),\n});\ntype UserDetailsResult = z.infer<typeof UserDetailsResultSchema>;\n\n\nexport async function getCurrentUser(): Promise<UserDetailsResult> {\n    try {\n        const sessionToken = cookies().get('sessionToken')?.value;\n        if (!sessionToken) {\n            return { success: false, data: null, error: 'User not authenticated.' };\n        }\n        \n        const users = await getAllUsers();\n        const userByToken = await findUserByTokenFromSheet(sessionToken);\n        if (!userByToken) {\n            return { success: false, data: null, error: 'Invalid session.' };\n        }\n\n        const user = users.find(u => u.emailAddress === userByToken.email);\n\n        if (user) {\n            return {\n                success: true,\n                data: {\n                    userName: user.userName,\n                    email: user.emailAddress,\n                    databaseId: user.databaseId,\n                    folderId: user.folderId,\n                },\n                error: null,\n            };\n        } else {\n            return { success: false, data: null, error: 'User not found.' };\n        }\n\n    } catch (e) {\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, data: null, error: `Failed to fetch user details: ${errorMessage}` };\n    }\n}\n\nconst SimpleResultSchema = z.object({\n    success: z.boolean(),\n    error: z.string().nullable(),\n});\ntype SimpleResult = z.infer<typeof SimpleResultSchema>;\n\nexport async function updateUserDetails(currentUserName: string, updates: UserUpdateData): Promise<SimpleResult> {\n    try {\n        if (!currentUserName) {\n            return { success: false, error: \"Current username is required to identify the user.\" };\n        }\n        \n        await updateUserDataInSheet(currentUserName, updates);\n\n        return { success: true, error: null };\n    } catch (e) {\n        console.error(`Error updating user details for ${currentUserName}:`, e);\n        const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, error: errorMessage };\n    }\n}\n\nconst ActiveSessionsResultSchema = z.object({\n    success: z.boolean(),\n    sessions: z.array(SessionInfoSchema).nullable(),\n    currentSessionToken: z.string().nullable(),\n    error: z.string().nullable(),\n});\ntype ActiveSessionsResult = z.infer<typeof ActiveSessionsResultSchema>;\n\n\nexport async function getActiveSessions(): Promise<ActiveSessionsResult> {\n    try {\n        const currentSessionToken = cookies().get('sessionToken')?.value;\n        if (!currentSessionToken) {\n            return { success: false, sessions: null, currentSessionToken: null, error: 'User not logged in.' };\n        }\n        \n        const user = await findUserByTokenFromSheet(currentSessionToken);\n        if (!user || !user.email) {\n            return { success: false, sessions: null, currentSessionToken: null, error: 'Session is invalid.' };\n        }\n        \n        const sessions = await getSessionsByEmail(user.email);\n        return { success: true, sessions, currentSessionToken, error: null };\n\n    } catch(e) {\n         const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, sessions: null, currentSessionToken: null, error: `Failed to fetch sessions: ${errorMessage}` };\n    }\n}\n\nexport async function logoutSession(sessionToken: string, logoutAll: boolean = false): Promise<SimpleResult> {\n    try {\n        if (!sessionToken) {\n            return { success: false, error: 'Session token is required.'};\n        }\n        \n        if (logoutAll) {\n            await deleteAllOtherSessionsByToken(sessionToken);\n        } else {\n            await deleteSessionByToken(sessionToken);\n        }\n        \n        return { success: true, error: null };\n\n    } catch (e) {\n         const errorMessage = e instanceof Error ? e.message : 'An unknown error occurred.';\n        return { success: false, error: `Failed to logout session: ${errorMessage}` };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2627, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/schedules.ts"],"sourcesContent":["\n\nexport interface AtcScheduleItem {\n    atc: string;\n    rate: number;\n    description: string;\n}\n\nexport const atcWE: AtcScheduleItem[] = [\n    { atc: 'WI010', rate: 5, description: 'Professionals (Lawyers, CPAs, Engineers, etc.)- If gross income for the current year did not exceed P3M' },\n    { atc: 'WI011', rate: 10, description: 'Professional (Lawyers, CPAs, Engineers, etc) - If gross Income is more than P3M or VAT Registered regardless of amount' },\n    { atc: 'WI020', rate: 5, description: 'Professional entertainers, such as, but not limited to, actors and actresses, singers, lyricist, composers, emcees - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI021', rate: 10, description: 'Professional entertainers such as, but not limited to actors & actresses, singers, lyricists, composers, emcees - If gross Income is more than P3M or VAT Registered regardless of amount' },\n    { atc: 'WI030', rate: 5, description: 'Professional athletes, including basketball players, pelotaris and jockeys - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI031', rate: 10, description: 'Professional athletes including basketball players, pelotaris and jockeys - If gross income is more than P3M of VAT Registered regardless of amount' },\n    { atc: 'WI040', rate: 5, description: 'All directors and producers involved in movies, stage, radio, television and musical productions - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI041', rate: 10, description: 'All directors and producers involved in movies, stage, radio, television and musical productions - If gross income is more than P3M of VAT Registered regardless of amount' },\n    { atc: 'WI050', rate: 5, description: 'Management and technical consultants - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI051', rate: 10, description: 'Management and technical consultants - If gross income is more than P3M of VAT Registered regardless of amount' },\n    { atc: 'WI060', rate: 5, description: 'Business and bookkeeping agents and agencies - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI061', rate: 10, description: 'Business and bookkeeping agents and agencies - If gross income is more that P3M of VAT Registered regardless of amount' },\n    { atc: 'WI070', rate: 5, description: 'Insurance agents and insurance adjusters - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI071', rate: 10, description: 'Insurance agents and insurance adjusters - If gross income is more than P3M of VAT Registered regardless of amount' },\n    { atc: 'WI080', rate: 5, description: 'Other recipients of talent fees - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI081', rate: 10, description: 'Other recipients of talent fees - If gross income is more than P3M or VAT Registered regardless of amount' },\n    { atc: 'WI090', rate: 5, description: 'Fees of directors who are not employees of the company - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI091', rate: 10, description: 'Fees of directors who are not employees of the company - If gross income is more than P3M of VAT Registered regardless of amount' },\n    { atc: 'WI100', rate: 5, description: 'Rentals- real/personal properties, poles, satellites & transmission facilities, billboards - Individual' },\n    { atc: 'WI110', rate: 5, description: 'Cinematographic film rentals - Individual' },\n    { atc: 'WI120', rate: 2, description: 'Income payments to prime contractors/sub-contractors - Individual' },\n    { atc: 'WI130', rate: 15, description: 'Income distribution to beneficiaries of estates and trusts' },\n    { atc: 'WI139', rate: 5, description: 'Gross commission or service fees of custom, insurance, stock, real estate, immigration and commercial brokers & fees of agents of professional entertainers - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI140', rate: 10, description: 'Gross commission or service fees of custom, insurance, stock, real estate, immigration and commercial brokers & fees of agents of professional entertainers - If gross income is more than P3M or VAT Registered regardless of amount' },\n    { atc: 'WI151', rate: 5, description: 'Payments for medical/dental/veterinary services thru Hospitals/ Clinics/Health Maintenance Organizations, including direct payments to service providers - If gross income for the current year did not exceed P3M' },\n    { atc: 'WI150', rate: 10, description: 'Payments for medical/dental/veterinary services thru Hospitals/ Clinics/Health Maintenance Organizations, including direct payments to service providers - If gross income > P3M of VAT Registered regardless of amount' },\n    { atc: 'WI152', rate: 10, description: 'Payment by the general professional partnerships (GPP) to its partners - If gross income for the current year did not exceed P720,000' },\n    { atc: 'WI153', rate: 15, description: 'Payment by the General Professional Partnerships (GPPs) to its partners - If gross income exceeds P720,000' },\n    { atc: 'WI156', rate: 0.5, description: 'Payments made by credit card companies - Individual' },\n    { atc: 'WI159', rate: 15, description: 'Additional payments to government personnel from importers, shipping and airline companies or their agents for overtime services' },\n    { atc: 'WI640', rate: 1, description: 'Income payments made by the government to its local/resident suppliers of goods - Individual' },\n    { atc: 'WI157', rate: 2, description: 'Income payments made by the government to its local/resident suppliers of service - Individual' },\n    { atc: 'WI158', rate: 1, description: 'Income payment made by top withholding agents to their local/resident supplier of goods other than those covered by other rates of withholding tax - Individual' },\n    { atc: 'WI160', rate: 2, description: 'Income payment made by top withholding agents to their local/resident supplier of services other than those covered by other rates of withholding tax - Individual' },\n    { atc: 'WI515', rate: 5, description: 'Commission, rebates, discounts & other similar considerations pd/granted to indepndnt & exclusive sales reps & mkting agents & sub-agents of multi-level marketing co. inc. multilevel mrkting co.- If gross income for the current yr did not exceed P3M' },\n    { atc: 'WI516', rate: 10, description: 'Commission, rebates, discounts & other similar considerations pd/granted to indepndnt & exclusive sales reps & mkting agents & sub-agents of multi-level mktng co. inc. multilevel mrkting co.-if gross income > P3M or VAT Registered regardless of amt' },\n    { atc: 'WI530', rate: 1, description: 'Gross payments to embalmers by funeral parlors' },\n    { atc: 'WI535', rate: 1, description: 'Payments made by pre-need companies to funeral parlors - Individual' },\n    { atc: 'WI540', rate: 5, description: 'Tolling fee paid to refineries - Individual' },\n    { atc: 'WI610', rate: 1, description: 'Income payments made to suppliers of Agricultural products - Individual' },\n    { atc: 'WI630', rate: 5, description: 'Income payments on purchases of minerals, mineral products & quarry resources - Individual' },\n    { atc: 'WI632', rate: 1, description: 'Income payments on purchases of gold by Bangko Sentral ng Pilipinas (BSP) from gold miners/suppliers under PD 1899, as amended by R.A. No. 7076- Individual' },\n    { atc: 'WI650', rate: 15, description: 'On gross amount of refund given by Meralco to customers with active contracts as classified by Meralco - Individual' },\n    { atc: 'WI651', rate: 15, description: 'On gross amount of refund given by Meralco to customers with terminated contracts as classified by Meralco - Individual' },\n    { atc: 'WI660', rate: 10, description: \"WITHHOLDING ON GROSS AMOUNT OF INTEREST ON THE REFUND OF METER DEPOSIT WHETHER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED AGAINST CUSTOMER'S BILLING - RESIDENTIAL AND GENERAL SERVICE CUSTOMERS WHOSE MONTHLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS C\" },\n    { atc: 'WI661', rate: 15, description: \"WITHHOLDING ON GROSS AMOUNT OF INTERST ONT HE REFIND OF METER DEPOSIT WHETER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED AGAINST CUSTOMER'S BILLING - RESIDENTIAL AND GENERA; SERVICE CUSTOMERS WHOSE MONTLY ELECTRICITY CONSUMPTION EXCEEDS200 KWH AS CLASS\" },\n    { atc: 'WI662', rate: 10, description: \"WITHHOLDING ON GROSS AMOUNT OF INTERESTO N THE REFUND OF METER DEPOSIT WHETHEER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED AGAINST CUSTOMER'S BILLING - RESIDENTIAL AND GENERAL SERVICE CUSTOMERS WHOSE MONTLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS CL\" },\n    { atc: 'WI663', rate: 15, description: \"WITHHOLDING ON GROSS AMOUNT OF INTEREST ON THE REFUND OF METER DEPOSIT WHETHER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED CUSTOMER'S BILLING - NON - RESIDENTIAL CUSTOMERS WHOSE MONTLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS CLASSIFIED BY OTH\" },\n    { atc: 'WI680', rate: 5, description: 'INCOME PAYMENTS MADE BY POLITICAL PARTIES AND CANDIDATES OF LOCAL AND NATIONAL ELECTIONS OF ALL THEIR CAMPAIGN EXPENDITURES, AND INCOME PAYMENTS MADE BY INDIVIDUALS OR JURIDICAL PERSONS FOR THEIR PURCHASES OF GOODS AND SERVICES INTENDED TO BE GIVEN A' },\n    { atc: 'WI710', rate: 15, description: 'INTEREST INCOME DERIVED FROM ANY OTHER DEBT INSTRUMENTS NOT WITHIN THE COVERAGE OF DEPOSIT SUBSTITUTES' },\n    { atc: 'WI720', rate: 1, description: 'Income payments on locally produced raw sugar - Individual' },\n    { atc: 'WI770', rate: 1, description: 'Income payments made by joint ventures, whether incorporated or not, taxable or non-taxable, to their local/resident supplier of goods' },\n    { atc: 'WI780', rate: 2, description: 'Income payments made by joint ventures, whether incorporated or not, taxable or non-taxable, to their local/resident supplier of services' },\n    { atc: 'WI820', rate: 0.5, description: 'On the gross remittances by e-marketplace operators to the sellers/merchants for the goods or services sold/paid through their platform/facility' },\n    { atc: 'WI830', rate: 0.5, description: 'On the gross remittances by digital financial services providers to the sellers/merchants for the goods or services sold/paid through their platform/facility' },\n    { atc: 'WC010', rate: 10, description: 'Professionals/ talent fees paid to juridical persons - If the current years gross income is P720,000 and below' },\n    { atc: 'WC011', rate: 15, description: 'Professionals/ talent fees paid to juridical persons - If the current years gross income exceeds P 720,000' },\n    { atc: 'WC020', rate: 10, description: 'Professional entertainers such as, but not limited to actors and actresses, singers, lyricists, composers, emcees - If gross income for the current year did not exceed P 720,000' },\n    { atc: 'WC021', rate: 15, description: 'Professional entertainers such as, but not limited to actors and actresses, singers, lyricists, composers, emcees - - If gross income exceeds P 720,000' },\n    { atc: 'WC030', rate: 10, description: 'Professional athletes including basketball players, pelotaris and jockeys - If gross income for the current year did not exceed P 720,000' },\n    { atc: 'WC031', rate: 15, description: 'Professional athletes including basketball players, pelotaris and jockeys -  - If gross income exceeds P 720,000' },\n    { atc: 'WC040', rate: 10, description: 'All directors and producers involved in movies, stage, radio, television and musical productions - If gross income for the current year did not exceed P 720,000' },\n    { atc: 'WC041', rate: 15, description: 'All directors and producers involved in movies, stage, radio, television and musical productions - If gross income exceeds P 720,000' },\n    { atc: 'WC050', rate: 10, description: 'Management and technical consultants paid to juridical person - If the current years gross income is P 720,000 and below' },\n    { atc: 'WC051', rate: 15, description: 'Management and technical consultants paid to juridical person - If the currents years gross income exceeds P720,000' },\n    { atc: 'WC060', rate: 10, description: 'Business and bookkeeping agents and agencies - If gross income for the current year did not exceed P 720,000' },\n    { atc: 'WC061', rate: 15, description: 'Business and bookkeeping agents and agencies - If gross income exceeds P 720,000' },\n    { atc: 'WC070', rate: 10, description: 'Insurance agents and insurance adjusters - If gross income for the current year did not exceed P 720,000' },\n    { atc: 'WC071', rate: 15, description: 'Insurance agents and insurance adjusters - If gross income exceeds P 720,000' },\n    { atc: 'WC080', rate: 10, description: 'Other recipients of talent fees - If gross income for the current year did not exceed P 720,000' },\n    { atc: 'WC081', rate: 15, description: 'Other recipients of talent fees - If gross income exceeds P 720,000' },\n    { atc: 'WC100', rate: 5, description: 'Rentals- real/personal properties, poles, satellites & transmission facilities, billiboards - Corporate' },\n    { atc: 'WC110', rate: 5, description: 'Cinematographic film rentals - Corporate' },\n    { atc: 'WC120', rate: 2, description: 'Income payments to prime contractors/sub-contractors - Corporate' },\n    { atc: 'WC139', rate: 10, description: 'Gross commission or service fees of custom, insurance, stock, real estate, immigration and commercial brokers & fees of agents of professional entertainers - if gross income did not exceed 720,000- Corporate' },\n    { atc: 'WC140', rate: 15, description: 'Gross commission or service fees of custom, insurance, stock, real estate, immigration and commercial brokers & fees of agents of professional entertainers - if gross income exceeds 720,000- Corporate' },\n    { atc: 'WC151', rate: 10, description: 'Professional fees paid to medical practitioners (inc.doctors of medicine doctors of veterinary sciences & dentists) by hospitals & clinics or paid directly by Health Maintenance Org (HMOs) &/or similar est - If gross income for the current yr < P720K' },\n    { atc: 'WC150', rate: 15, description: 'Professional fees paid to medical practitioners (inc.doctors of medicine doctors of veterinary sciences & dentists) by hospitals & clinics or paid directly by Health Maintenance Org (HMOs) &/or similar est - If gross income exceeds P720K' },\n    { atc: 'WC156', rate: 0.5, description: 'Payments made by credit card companies - Corporate' },\n    { atc: 'WC640', rate: 1, description: 'Income payments made by the government to its local/resident suppliers of goods - Corporate' },\n    { atc: 'WC157', rate: 2, description: 'Income payments made by the government to its local/resident suppliers of services - Corporate' },\n    { atc: 'WC158', rate: 1, description: 'Income payment made by top withholding agents to their local/resident supplier of goods other than those covered by other rates of withholding tax - Corporate' },\n    { atc: 'WC160', rate: 2, description: 'Income payment made by top withholding agents to their local/resident supplier of services other than those covered by other rates of withholding tax - Corporate' },\n    { atc: 'WC535', rate: 1, description: 'Payments made by pre-need companies to funeral parlors - Corporate' },\n    { atc: 'WC540', rate: 5, description: 'Tolling fee paid to refineries - Corporate' },\n    { atc: 'WC610', rate: 1, description: 'Income payments made to suppliers of Agricultural products - Corporate' },\n    { atc: 'WC630', rate: 5, description: 'Income payments on purchases of minerals, mineral products & quarry resources - Corporate' },\n    { atc: 'WC632', rate: 1, description: 'Income payments on purchases of gold by Bangko Sentral ng Pilipinas (BSP) from gold miners/suppliers under PD 1899, as amended by R.A. No. 7076- Corporate' },\n    { atc: 'WC650', rate: 15, description: 'On gross amount of refund given by Meralco to customers with active contracts as classified by Meralco - Corporate' },\n    { atc: 'WC651', rate: 15, description: 'On gross amount of refund given by Meralco to customers with terminated contracts as classified by Meralco - Corporate' },\n    { atc: 'WC660', rate: 10, description: \"WITHHOLDING ON GROSS AMOUNT OF INTEREST ON THE REFUND OF METER DEPOSIT WHETHER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED AGAINST CUSTOMER'S BILLING - RESIDENTIAL AND GENERAL SERVICE CUSTOMERS WHOSE MONTHLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS C\" },\n    { atc: 'WC661', rate: 15, description: \"WITHHOLDING ON GROSS AMOUNT OF INTEREST ON THE REFUND OF METER DEPOSIT WHETHER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED AGAINST CUSTOMER'S BILLING - NON - RESIDENTIAL CUSTOMERS WHOSE MONTLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS CLASSIFIED BY ME\" },\n    { atc: 'WC662', rate: 10, description: \"WITHHOLDING ON GROSS AMOUNT OF INTEREST ON THE REFUND OF METER DEPOSIT WHETHEER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED AGAINST CUSTOMER'S BILLING - RESIDENTIAL AND GENERAL SERVICE CUSTOMERS WHOSE MONTLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS C\" },\n    { atc: 'WC663', rate: 15, description: \"WITHHOLDING ON GROSS AMOUNT OF INTEREST ON THE REFUND OF METER DEPOSIT WHETHER PAID DIRECTLY TO THE CUSTOMERS OR APPLIED CUSTOMER'S BILLING - NON - RESIDENTIAL CUSTOMERS WHOSE MONTLY ELECTRICITY CONSUMPTION EXCEEDS 200 KWH AS CLASSIFIED BY OTHER ELEC\" },\n    { atc: 'WC680', rate: 5, description: 'INCOME PAYMENTS MADE BY POLITICAL PARTIES AND CANDIDATES OF LOCAL AND NATIONAL ELECTIONS OF ALL THEIR CAMPAIGN EXPENDITURES, AND INCOME PAYMENTS MADE BY INDIVIDUALS OR JURIDICAL PERSONS FOR THEIR PURCHASES OF GOODS AND SERVICES INTENDED TO BE GIVEN A' },\n    { atc: 'WC690', rate: 1, description: 'Income payments received by Real Estate Investment Trust (REIT)' },\n    { atc: 'WC710', rate: 15, description: 'INTEREST INCOME DERIVED FROM ANY OTHER DEBT INSTRUMENTS NOT WITHIN THE COVERAGE OF DEPOSIT SUBSTITUTES' },\n    { atc: 'WC720', rate: 1, description: 'Income payments on locally produced raw sugar - Corporation' },\n    { atc: 'WC770', rate: 1, description: 'Income payments made by joint ventures, whether incorporated or not, taxable or non-taxable, to their local/resident supplier of goods' },\n    { atc: 'WC780', rate: 2, description: 'Income payments made by joint ventures, whether incorporated or not, taxable or non-taxable, to their local/resident supplier of services' },\n    { atc: 'WC790', rate: 15, description: 'On the share of each co-venturer/member from the net income of the joint venture/consortium not taxable as corporation prior to actual or constructive distribution thereof' },\n    { atc: 'WC820', rate: 0.5, description: 'On the gross remittances by e-marketplace operators to the sellers/merchants for the goods or services sold/paid through their platform/facility' },\n    { atc: 'WC830', rate: 0.5, description: 'On the gross remittances by digital financial services providers to the sellers/merchants for the goods or services sold/paid through their platform/facility' },\n];\n\nexport const atcExempt: AtcScheduleItem[] = [\n    { atc: 'MC040', rate: 0, description: 'INCOME FROM FORFEITED PROPERTIES' },\n    { atc: 'MC030', rate: 0, description: 'COMP. PYMTS ON DELQNT. ACCOUNTS & DISP. ASSESSMENTS' },\n    { atc: 'MC021', rate: 0, description: 'CORPORATE TAXPAYERS' },\n    { atc: 'MC020', rate: 0, description: 'TAX AMNESTY ON INCOME (CORPORATE)' },\n    { atc: 'MC011', rate: 0, description: 'INDIVIDUAL TAXPAYERS' },\n    { atc: 'MC010', rate: 0, description: 'TAX AMNESTY ON INCOME (INDIVIDUAL)' },\n    { atc: 'II420', rate: 0, description: 'CGT ON SALE OF REAL PROPERTY (CAPITAL ASSETS) FOR INDIV' },\n    { atc: 'II130', rate: 0, description: 'PARTNERS DISTRIB SHARE OF NET INC OF GEN PARTNERSHIP' },\n    { atc: 'II120', rate: 0, description: 'PRIZES AMOUNTING TO: 10,000 OR LESS' },\n    { atc: 'II110', rate: 0, description: 'INTEREST - (INDIVIDUAL PAYEES)' },\n    { atc: 'II090', rate: 0, description: 'TRANSPO CONTR (INDIVIDUAL)  CARRIAGE OF GOODS AND MERCHDSE BELOW 2,000' },\n    { atc: 'II080', rate: 0, description: 'OTHERS (SPECIFY) - (INDIVIDUAL PAYEES)' },\n    { atc: 'II070', rate: 0, description: 'PENSIONS' },\n    { atc: 'II060', rate: 0, description: 'PREMIUM AND ANNUITY - (INDIVIDUAL PAYEES)' },\n    { atc: 'II051', rate: 0, description: 'RENT - PERSONAL PROPERTY REGARDLESS OF  AMOUNT (INDIVIDUAL)' },\n    { atc: 'II050', rate: 0, description: 'RENT FOR REAL PROPERTY BELOW P500 MONTH (USED IN BUSINESS)' },\n    { atc: 'II020', rate: 0, description: 'NRC INCOME' },\n    { atc: 'II013', rate: 0, description: 'ESTATES AND TRUST -MIXED INCOME' },\n    { atc: 'II012', rate: 0, description: 'RESIDENT ALIEN - PURE BUSINESS' },\n    { atc: 'II011', rate: 0, description: 'PURE COMPENSATION INCOME -CITIZENS' },\n    { atc: 'II010', rate: 0, description: 'INCOME FROM COMP. ANDBUS./PROF' },\n    { atc: 'IC370', rate: 0, description: 'ON IMPROPERLY ACCUMULATED EARNINGS TAX' },\n    { atc: 'IC191', rate: 0, description: 'FOREIGN CURRENCY DEPOSIT UNITS (FCDUS)' },\n    { atc: 'IC190', rate: 0, description: 'OFFSHORE BANKING UNITS (OBUS)' },\n    { atc: 'IC170', rate: 0, description: 'INTEREST - (CORPORATE PAYEES)' },\n    { atc: 'IC160', rate: 0, description: 'TRANSPO CONTR (CORPORATE) CARRIAGE OF GOODS AND MERCHDSE BELOW P2000' },\n    { atc: 'IC150', rate: 0, description: 'OTHERS (SPECIFY) - (CORPORATE PAYEES)' },\n    { atc: 'IC140', rate: 0, description: 'PREMIUM AND ANNUITY - (CORPORATE PAYEES)' },\n    { atc: 'IC130', rate: 0, description: 'RENT - PERSONAL PROPERTY REGARDLESS OF AMOUNT (CORPORATE)' },\n    { atc: 'IC120', rate: 0, description: 'PRIZES REGARDLESS OF AMOUNT' },\n    { atc: 'IC101', rate: 0, description: 'REGIONAL OPERATING HEADQUARTERS OF MULTINATIONAL COMP' },\n    { atc: 'IC100', rate: 0, description: 'FOREIGN OBU/FCDU' },\n    { atc: 'IC090', rate: 0, description: 'FOREIGN MUTUAL LIFE INSURANCE CO.' },\n    { atc: 'IC080', rate: 0, description: 'RFC -INTERNATIONAL CARRIERS' },\n    { atc: 'IC070', rate: 0, description: 'ORDINARY RESIDENT FOREIGN CORP.' },\n    { atc: 'IC060', rate: 0, description: 'INCOME TAX -FCDU' },\n    { atc: 'IC055', rate: 0, description: 'MINIMUM CORPORATE INCOME TAX' },\n    { atc: 'IC050', rate: 0, description: 'INCOME TAX - MUTUAL LIFE INSURANCE COMPANIES' },\n    { atc: 'IC041', rate: 0, description: 'NATL & LOC GOVT UNITS (FOR PROPRIETARY ACTVTIES) EXCEPT PUBS' },\n    { atc: 'IC040', rate: 0, description: 'GOVT OWNED OR CONTROLLED CORP' },\n    { atc: 'IC031', rate: 0, description: 'NON STOCK, NON PROFIT HOSPITALS' },\n    { atc: 'IC030', rate: 0, description: 'PRIVATE EDUC INST, STOCK OR NON STOCK' },\n    { atc: 'IC021', rate: 0, description: 'PROFNL FEES PAID TO GEN PROF PARTNRSHIPS (EXCEPT TO PARTNRSHP OF MED)' },\n    { atc: 'IC020', rate: 0, description: 'PARTNERSHIP IN TRADE INCOME TAX' },\n    { atc: 'IC011', rate: 0, description: 'NON-STOCK NON-PROFIT ORGANIZATION' },\n    { atc: 'IC010', rate: 0, description: 'INCOME TAX- ORDINARY DOMESTIC CORP.' },\n    { atc: 'FP010', rate: 0, description: 'FINES & PEN.- ON TAX ON INCOME' },\n    { atc: 'EI900', rate: 0, description: 'EXCESS INCOME TAX' },\n    { atc: 'DI900', rate: 0, description: 'DEFAULT INCOME TAX' },\n];\n\nexport const atcWG: AtcScheduleItem[] = [\n    { atc: 'WV010', rate: 5, description: 'FWVAT on payments for purchases of Goods' },\n    { atc: 'WV020', rate: 5, description: 'FWVAT on payments for purchases of Services' },\n    { atc: 'WV040', rate: 12, description: 'Lease or use of properties or property rights owned by non-residents (Government Withholding Agent)' },\n    { atc: 'WV050', rate: 12, description: 'Lease or use of properties or property rights owned by non-residents (Private Withholding Agent)' },\n    { atc: 'WV060', rate: 12, description: 'Other services rendered in the Philippines by non-residents (Government Withholding Agent)' },\n    { atc: 'WV070', rate: 12, description: 'Other services rendered in the Philippines by non-residents (Private Withholding Agent)' },\n    { atc: 'WB030', rate: 3, description: 'Tax on carriers and keepers of garages' },\n    { atc: 'WB040', rate: 2, description: 'Franchise Tax on Gas and Water Utilities' },\n    { atc: 'WB050', rate: 3, description: 'Franchise Tax on radio & TV broadcasting companies whose annual gross receipts does not exceed P10M & who are not VAT registered taxpayers' },\n    { atc: 'WB070', rate: 2, description: 'Tax on life insurance premiums' },\n    { atc: 'WB080', rate: 3, description: 'Persons exempt from VAT under Sec. 109(v) (creditable)-Government Withholding Agent' },\n    { atc: 'WB090', rate: 10, description: 'Tax on overseas dispatch, message or conversation originating from the Philippines' },\n    { atc: 'WB301', rate: 5, description: 'Tax on Banks and Non-Bank Financial Internediaries Performing Quasi-Banking Functions. On interest, commissions and discounts from lending activities as well as income from financial leasing, on the basis of remaining maturities of instruments fr' },\n    { atc: 'WB303', rate: 1, description: 'Tax on Banks and Non-Bank Financial Intermediaries Performing Quasi-Banking Functions. On interest, commissions and discounts from lending activities as well as income from financial leasing, on the basis of remaining maturities of instruments f' },\n    { atc: 'WB102', rate: 0, description: 'Tax on Banks and Non-Bank Financial Intermediaries Performing Quasi-Banking Functions. On dividends and equity shares and net income of subsidiaries' },\n    { atc: 'WB103', rate: 7, description: 'Tax on Banks and Non-Bank Financial Intermediaries Performing Quasi-Banking Functions. On royalties, rentals of property, real or personal, profits from exchange and all other items treated as gross income under the Code' },\n    { atc: 'WB104', rate: 7, description: 'Tax on Banks and Non-Bank Financial Intermediaries Perfoming Quasi-Banking Functions. On the net trading gains within the taxable year on foreign currency, debt securities, derivatives, and other similar financial instruments' },\n    { atc: 'WB108', rate: 5, description: 'Tax on Other Non-Banks Financial Intermediaries Not Performing Quasi-Banking Functions. On interest, commissions and discounts from lending activities as well as income from financial leasing, on the basis of the remaining maturities of instrument f' },\n    { atc: 'WB109', rate: 1, description: 'Tax on Other Non-Banks Financial Intermediaries Not Performing Quasi-Banking Functions. On interest, commissions and discounts from lending activities as well as income from financial leasing, on the basis of the remaining maturities of instrument f' },\n    { atc: 'WB110', rate: 5, description: 'Tax on Other Non-Banks Financial Intermediaries Not Performing Quasi-Banking Functions. On all other items treated as gross income under the Code' },\n    { atc: 'WB120', rate: 4, description: 'Business Tax on Agents of foreign insurance co. - insurance agents' },\n    { atc: 'WB121', rate: 5, description: 'Business Tax on Agents of foreign insurance co. - owner of the property' },\n    { atc: 'WB130', rate: 3, description: 'Tax on International Carriers' },\n    { atc: 'WB140', rate: 18, description: 'Tax on cockpits' },\n    { atc: 'WB150', rate: 18, description: 'Tax on cabarets, night and day clubs' },\n    { atc: 'WB160', rate: 10, description: 'Tax on boxing exhibitions' },\n    { atc: 'WB170', rate: 15, description: 'Tax on professional basketball games' },\n    { atc: 'WB180', rate: 30, description: 'Tax on jai-alai & race tracks' },\n    { atc: 'WB200', rate: 0.6, description: 'Tax on sale, barter or exchange of shares of stocks listed and traded through the Local Stock Exchange' },\n    { atc: 'WB201', rate: 4, description: 'Tax on shares of stock sold or exchanged through initial and secondary public offering - Not over 25%' },\n    { atc: 'WB202', rate: 2, description: 'Tax on shares of stock sold or exchanged through initial and secondary public offering - Over 25% but not exceeding 33 1/3%' },\n    { atc: 'WB203', rate: 1, description: 'Tax on shares of stock sold or exchanged through initial and secondary public offering - Over 33 1/3%' },\n    { atc: 'WV012', rate: 12, description: 'VAT Withholding on Purchase of Goods (with waiver of privilege to claim input tax credit (creditable)' },\n    { atc: 'WV014', rate: 12, description: 'Vat Withholding on Purchase of Goods (with waiver of privilege to claim input tax credit (final)' },\n    { atc: 'WV022', rate: 12, description: 'VAT Withholding on Purchase of Services (with waiver of privilege to claim input tax credit (creditable)' },\n    { atc: 'WV024', rate: 12, description: 'VAT Withholding on Purchase of Services (with waiver of privilege to claim input tax credit (final)' },\n    { atc: 'WB082', rate: 3, description: 'Persons exempt from VAT under Section 109v (creditable) - Private Withholding Agent' },\n    { atc: 'WB084', rate: 3, description: 'Persons exempt from VAT under Section 109v (final)' },\n    { atc: 'PT320', rate: 5, description: 'Gaming Tax' },\n];\n\nexport const atcWF: AtcScheduleItem[] = [\n    { atc: 'WC180', rate: 20, description: 'Interest on foreign loans payable to non-resident foreign corporations (NRFCs)' },\n    { atc: 'WC190', rate: 10, description: 'Interest and other income payments on foreign currency transactions/loans payable to OBUs' },\n    { atc: 'WC191', rate: 10, description: 'Interest and other income payments on foreign currency transactions/loans payable to FCDUs' },\n    { atc: 'WI202', rate: 10, description: 'Cash dividend payments by domestic corporation to citizens and resident aliens' },\n    { atc: 'WI203', rate: 10, description: 'Property dividend payments by domestic corporation to citizens and resident aliens' },\n    { atc: 'WC212', rate: 25, description: 'Cash dividend payment by domestic corporation to Non-Resident Foreign Corporations' },\n    { atc: 'WC213', rate: 25, description: 'Property dividend payment by domestic corporation to Non-Resident Foreign Corporations' },\n    { atc: 'WC222', rate: 15, description: 'Cash dividend payment by domestic corporation to Non-Resident Foreign Corporations whose countries allowed tax deemed paid credit (subject to tax sparing rule)' },\n    { atc: 'WC223', rate: 15, description: 'Property dividend payment by domestic corporation to Non-Resident Foreign Corporations whose countries allowed tax deemed paid credit (subject to tax sparing rule)' },\n    { atc: 'WI224', rate: 20, description: 'Cash dividend payment by domestic corporation to non-resident alien engaged in trade or business (NRAETB)' },\n    { atc: 'WI225', rate: 20, description: 'Property  dividend payment by domestic corporation to non-resident alien engaged in trade or business (NRAETB)' },\n    { atc: 'WI226', rate: 20, description: 'Share of a NRAETB in the distributable net income after tax of a partnership (except GPP) of which he is a partner, or share in the net income after tax of an association,  joint account, or a joint venture taxable as a corporation of which he is a m' },\n    { atc: 'WC230', rate: 25, description: 'On other payments to non-resident foreign  corporations (NRFCs)' },\n    { atc: 'WI240', rate: 10, description: 'Distributive share of individual partners in a taxable partnerships, association,  joint account, or joint venture or consortium' },\n    { atc: 'WI250', rate: 20, description: 'All kinds of royalty payments to citizens, resident aliens and non-resident aliens engaged in trade or business (other than WI 380 and WI 341)' },\n    { atc: 'WC250', rate: 20, description: 'All kinds of royalty payments to domestic and resident foreign corporation' },\n    { atc: 'WI260', rate: 20, description: 'On prizes exceeding P10,000 and other winnings paid to individuals' },\n    { atc: 'WC280', rate: 15, description: 'Branch profit remittances by all  corporations except PEZA/SBMA/CDA registered' },\n    { atc: 'WC290', rate: 4.5, description: 'On gross rentals, lease and charter fees derived by non-resident owner or lessor of foreign vessels' },\n    { atc: 'WC300', rate: 7.5, description: 'On the gross rentals, lease and charter fees derived by non-resident lessor of aircraft, machineries and other equipment' },\n    { atc: 'WI310', rate: 8, description: 'On payments to oil exploration service contractors and subcontractors (OESS) - Individual (NRAETB)' },\n    { atc: 'WC310', rate: 8, description: 'On payments to oil exploration service contractors and subcontractors (OESS) - Corporate (non-resident foreign corporation engage in trade or business)' },\n    { atc: 'WI320', rate: 0, description: 'Payments to Filipinos or alien individuals employed by Foreign Petroleum Service Contractors/Subcontractors, Offshore Banking Units and Regional or Area Headquarters and Regional Operating Headquarters of Multinational Companies occupying executive/m' },\n    { atc: 'WI330', rate: 25, description: 'Payments to NRANETB except on sale of shares in domestic corporation and real property' },\n    { atc: 'WI340', rate: 25, description: 'On payments to non-resident individual  cinematographic film  owners, lessors or distributors' },\n    { atc: 'WC340', rate: 25, description: 'On payments to foreign corporate cinematographic film  owners, lessors or distributors' },\n    { atc: 'WI341', rate: 25, description: 'Royalties paid to NRAETB on cinematographic films and similar works' },\n    { atc: 'WI350', rate: 30, description: 'Final tax on interest or other  payments  upon tax-free covenant bonds, mortgages,  deeds of trust or other obligations under Sec. 57C of the NIRC of 1997' },\n    { atc: 'WI380', rate: 10, description: 'Royalties paid to citizens, resident aliens and NRAETB on books, other literary works and musical composition' },\n    { atc: 'WI410', rate: 10, description: 'Informer\\'s cash reward paid to individuals' },\n    { atc: 'WC410', rate: 10, description: 'Informer\\'s cash reward paid to juridical persons' },\n    { atc: 'WF330', rate: 25, description: 'Payment of fringe benefits to Non-Resident Alien Not Engaged in Trade or Business (NRAETB)' },\n    { atc: 'WF360', rate: 35, description: 'Employees other than rank and file (Fringe Benefit Tax)  based on the grossed up monetary value' },\n    { atc: 'WC700', rate: 10, description: 'Cash or property dividend paid by a Real Estate Investment Trust (REIT) - Corporate' },\n    { atc: 'WI700', rate: 10, description: 'Cash or property dividend paid by a Real Estate Investment Trust (REIT) - Individual' },\n    { atc: 'WI740', rate: 25, description: 'Final Withholding Tax on Foreign Nationals Employed by POGO Entities' },\n    { atc: 'WI750', rate: 0, description: 'On gross income earned by foreign nationals or non-Filipino citizens, regardless of their residency, who are employed and assigned in the Philippines by Offshore Gaming Licensee or its Accredited Service Provider' },\n];\n\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3787, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions/excel.ts"],"sourcesContent":["\n\n'use server';\n\nimport * as xlsx from 'xlsx';\nimport { getDatFileContent } from './drive';\nimport { format } from 'date-fns';\nimport { atcWE, atcExempt } from '../schedules';\n\ninterface ExcelResult {\n    success: boolean;\n    base64?: string;\n    fileName?: string;\n    error?: string;\n}\n\nexport async function generateSalesExcel(fileIds: string[], fileNames: string[]): Promise<ExcelResult> {\n    try {\n        const fileContents = await Promise.all(fileIds.map(id => getDatFileContent(id)));\n\n        const filesWithContent = fileNames.map((name, index) => ({\n            name,\n            content: fileContents[index].content,\n        }));\n\n        const getMonthFromFileName = (name: string) => {\n            const monthStr = name.substring(10, 12);\n            return parseInt(monthStr, 10);\n        };\n        \n        filesWithContent.sort((a, b) => getMonthFromFileName(a.name) - getMonthFromFileName(b.name));\n        \n        const latestFile = filesWithContent[filesWithContent.length - 1];\n\n        if (!latestFile || !latestFile.content) {\n            return { success: false, error: \"No content found in the selected files.\" };\n        }\n\n        const headerLine = latestFile.content.split('\\n').find(line => line.startsWith('H,'));\n        \n        if (!headerLine) {\n            return { success: false, error: \"Could not find a header line in the latest file.\" };\n        }\n\n        const headerCols = headerLine.split(',').map(col => col.replace(/\"/g, ''));\n        const ownerTin = headerCols[2];\n        const ownerName = headerCols[3] ? headerCols[3] : `${headerCols[4]}, ${headerCols[5]} ${headerCols[6]}`;\n        const tradeName = headerCols[7];\n\n        const wsData: (string | number | null)[][] = [\n            ['SALES TRANSACTION'],\n            ['RECONCILIATION OF LISTING FOR ENFORCEMENT'],\n            [],\n            [`TIN: ${ownerTin}`],\n            [`OWNER'S NAME: ${ownerName}`],\n            [`OWNER'S TRADE NAME: ${tradeName}`],\n            [],\n            ['TAXABLE', 'TAXPAYER', 'REGISTERED NAME', 'NAME OF CUSTOMER', \"CUSTOMER'S ADDRESS\", 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF'],\n            ['MONTH', 'IDENTIFICATION', null, '(Last Name, First Name, Middle Name)', null, 'GROSS SALES', 'EXEMPT SALES', 'ZERO-RATED SALES', 'TAXABLE SALES', 'OUTPUT TAX', 'GROSS TAXABLE SALES'],\n            [null, 'NUMBER', null, null, null, null, null, null, null, null, null],\n            ['(1)','(2)','(3)','(4)','(5)','(6)','(7)','(8)','(9)','(10)','(11)'],\n        ];\n\n        let totalGrossSales = 0;\n        let totalExemptSales = 0;\n        let totalZeroRatedSales = 0;\n        let totalTaxableSales = 0;\n        let totalOutputTax = 0;\n        let totalGrossTaxableSales = 0;\n\n        for (const file of filesWithContent) {\n            if (!file.content) continue;\n\n            const detailLines = file.content.split('\\n').filter(line => line.startsWith('D,'));\n            for (const line of detailLines) {\n                const cols = line.split(',').map(col => col.replace(/\"/g, ''));\n                \n                const lastDayDateStr = cols[14];\n                const [monthStr, dayStr, yearStr] = lastDayDateStr.split('/');\n                const date = new Date(parseInt(yearStr), parseInt(monthStr), 0);\n                \n                const tin = cols[2];\n                const formattedTin = tin ? `${tin.substring(0,3)}-${tin.substring(3,6)}-${tin.substring(6,9)}` : '--- --- ---';\n                \n                const exemptSales = parseFloat(cols[9] || '0');\n                const zeroRatedSales = parseFloat(cols[10] || '0');\n                const taxableSales = parseFloat(cols[11] || '0');\n                const outputTax = parseFloat(cols[12] || '0');\n                const grossSales = exemptSales + zeroRatedSales + taxableSales;\n                const grossTaxableSales = taxableSales + outputTax;\n\n                totalGrossSales += grossSales;\n                totalExemptSales += exemptSales;\n                totalZeroRatedSales += zeroRatedSales;\n                totalTaxableSales += taxableSales;\n                totalOutputTax += outputTax;\n                totalGrossTaxableSales += grossTaxableSales;\n\n                const bodyRow = [\n                    format(date, 'MM/dd/yyyy'),\n                    formattedTin,\n                    cols[3],\n                    `${cols[4]}, ${cols[5]} ${cols[6]}`,\n                    `${cols[7]} ${cols[8]}`,\n                    grossSales,\n                    exemptSales,\n                    zeroRatedSales,\n                    taxableSales,\n                    outputTax,\n                    grossTaxableSales\n                ];\n                wsData.push(bodyRow);\n            }\n        }\n        \n        wsData.push([]);\n        wsData.push([]);\n\n        const grandTotalRow = [\n            \"Grand Total:\",\n            null,\n            null,\n            null,\n            null,\n            totalGrossSales,\n            totalExemptSales,\n            totalZeroRatedSales,\n            totalTaxableSales,\n            totalOutputTax,\n            totalGrossTaxableSales\n        ];\n        wsData.push(grandTotalRow);\n        wsData.push([]);\n        wsData.push([\"END OF REPORT\"]);\n\n\n        const ws = xlsx.utils.aoa_to_sheet(wsData);\n\n        const wb = xlsx.utils.book_new();\n        xlsx.utils.book_append_sheet(wb, ws, 'Sales Transaction');\n\n        const wbout = xlsx.write(wb, { bookType: 'xlsx', type: 'base64' });\n\n        const year = latestFile.name.substring(12, 16);\n        const fileName = `${ownerTin}-Sales-${year}.xlsx`;\n\n        return { success: true, base64: wbout, fileName };\n\n    } catch (e) {\n        console.error(\"Error generating sales Excel:\", e);\n        const errorMessage = e instanceof Error ? e.message : \"An unknown error occurred.\";\n        return { success: false, error: errorMessage };\n    }\n}\n\nexport async function generatePurchasesExcel(fileIds: string[], fileNames: string[]): Promise<ExcelResult> {\n    try {\n        const fileContents = await Promise.all(fileIds.map(id => getDatFileContent(id)));\n\n        const filesWithContent = fileNames.map((name, index) => ({\n            name,\n            content: fileContents[index].content,\n        }));\n        \n        const getMonthFromFileName = (name: string) => {\n            const monthStr = name.substring(10, 12);\n            return parseInt(monthStr, 10);\n        };\n        \n        filesWithContent.sort((a, b) => getMonthFromFileName(a.name) - getMonthFromFileName(b.name));\n        \n        const latestFile = filesWithContent[filesWithContent.length - 1];\n\n        if (!latestFile || !latestFile.content) {\n            return { success: false, error: \"No content found in the selected files.\" };\n        }\n\n        const headerLine = latestFile.content.split('\\n').find(line => line.startsWith('H,'));\n        \n        if (!headerLine) {\n            return { success: false, error: \"Could not find a header line in the latest file.\" };\n        }\n\n        const headerCols = headerLine.split(',').map(col => col.replace(/\"/g, ''));\n        const ownerTin = headerCols[2];\n        const ownerName = headerCols[3] ? headerCols[3] : `${headerCols[4]}, ${headerCols[5]} ${headerCols[6]}`;\n        const tradeName = headerCols[7];\n\n        const wsData: (string | number | null)[][] = [\n            ['PURCHASES TRANSACTION'],\n            ['RECONCILIATION OF LISTING FOR ENFORCEMENT'],\n            [],\n            [`TIN: ${ownerTin}`],\n            [`OWNER'S NAME: ${ownerName}`],\n            [`OWNER'S TRADE NAME: ${tradeName}`],\n            [],\n            ['TAXABLE', 'TAXPAYER', 'REGISTERED NAME', 'NAME OF SUPPLIER', \"SUPPLIER'S ADDRESS\", 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF'],\n            ['MONTH', 'IDENTIFICATION', null, '(Last Name, First Name, Middle Name)', null, 'GROSS PURCHASE', 'EXEMPT PURCHASE', 'ZERO-RATED PURCHASE', 'TAXABLE PURCHASE', 'PURCHASE OF SERVICES', 'PURCHASE OF CAPITAL GOODS', 'PURCHASE OF OTHER GOODS', 'INPUT TAX', 'GROSS TAXABLE PURCHASE'],\n            [null, 'NUMBER', null, null, null, null, null, null, null, null, null, null, null, null],\n            ['(1)','(2)','(3)','(4)','(5)','(6)','(7)','(8)','(9)','(10)','(11)','(12)', '(13)', '(14)'],\n        ];\n\n        let totalGrossPurchase = 0;\n        let totalExemptPurchase = 0;\n        let totalZeroRatedPurchase = 0;\n        let totalTaxablePurchase = 0;\n        let totalPurchaseOfServices = 0;\n        let totalPurchaseOfCapitalGoods = 0;\n        let totalPurchaseOfOtherGoods = 0;\n        let totalInputTax = 0;\n        let totalGrossTaxablePurchase = 0;\n\n\n        for (const file of filesWithContent) {\n            if (!file.content) continue;\n\n            const detailLines = file.content.split('\\n').filter(line => line.startsWith('D,'));\n            for (const line of detailLines) {\n                const cols = line.split(',').map(col => col.replace(/\"/g, ''));\n                \n                const lastDayDateStr = cols[16];\n                const [monthStr, dayStr, yearStr] = lastDayDateStr.split('/');\n                const date = new Date(parseInt(yearStr), parseInt(monthStr), 0);\n                \n                const tin = cols[2];\n                const formattedTin = tin ? `${tin.substring(0,3)}-${tin.substring(3,6)}-${tin.substring(6,9)}` : '--- --- ---';\n                \n                const exemptPurchase = parseFloat(cols[9] || '0');\n                const zeroRatedPurchase = parseFloat(cols[10] || '0');\n                const purchaseOfServices = parseFloat(cols[11] || '0');\n                const purchaseOfCapitalGoods = parseFloat(cols[12] || '0');\n                const purchaseOfOtherGoods = parseFloat(cols[13] || '0');\n                const inputTax = parseFloat(cols[14] || '0');\n\n                const grossPurchase = exemptPurchase + zeroRatedPurchase + purchaseOfServices + purchaseOfCapitalGoods + purchaseOfOtherGoods;\n                const taxablePurchase = purchaseOfServices + purchaseOfCapitalGoods + purchaseOfOtherGoods;\n                const grossTaxablePurchase = purchaseOfServices + purchaseOfCapitalGoods + purchaseOfOtherGoods + inputTax;\n\n                totalGrossPurchase += grossPurchase;\n                totalExemptPurchase += exemptPurchase;\n                totalZeroRatedPurchase += zeroRatedPurchase;\n                totalTaxablePurchase += taxablePurchase;\n                totalPurchaseOfServices += purchaseOfServices;\n                totalPurchaseOfCapitalGoods += purchaseOfCapitalGoods;\n                totalPurchaseOfOtherGoods += purchaseOfOtherGoods;\n                totalInputTax += inputTax;\n                totalGrossTaxablePurchase += grossTaxablePurchase;\n\n                const bodyRow = [\n                    format(date, 'MM/dd/yyyy'),\n                    formattedTin,\n                    cols[3],\n                    `${cols[4]}, ${cols[5]} ${cols[6]}`,\n                    `${cols[7]} ${cols[8]}`,\n                    grossPurchase,\n                    exemptPurchase,\n                    zeroRatedPurchase,\n                    taxablePurchase,\n                    purchaseOfServices,\n                    purchaseOfCapitalGoods,\n                    purchaseOfOtherGoods,\n                    inputTax,\n                    grossTaxablePurchase\n                ];\n                wsData.push(bodyRow);\n            }\n        }\n        \n        wsData.push([]);\n        wsData.push([]);\n\n        const grandTotalRow = [\n            \"Grand Total:\",\n            null,\n            null,\n            null,\n            null,\n            totalGrossPurchase,\n            totalExemptPurchase,\n            totalZeroRatedPurchase,\n            totalTaxablePurchase,\n            totalPurchaseOfServices,\n            totalPurchaseOfCapitalGoods,\n            totalPurchaseOfOtherGoods,\n            totalInputTax,\n            totalGrossTaxablePurchase\n        ];\n        wsData.push(grandTotalRow);\n        wsData.push([]);\n        wsData.push([\"END OF REPORT\"]);\n\n        const ws = xlsx.utils.aoa_to_sheet(wsData);\n        const wb = xlsx.utils.book_new();\n        xlsx.utils.book_append_sheet(wb, ws, 'Purchases Transaction');\n        \n        const wbout = xlsx.write(wb, { bookType: 'xlsx', type: 'base64' });\n        \n        const year = latestFile.name.substring(12, 16);\n        const fileName = `${ownerTin}-Purchases-${year}.xlsx`;\n\n\n        return { success: true, base64: wbout, fileName };\n    } catch (e) {\n        console.error(\"Error generating purchases Excel:\", e);\n        const errorMessage = e instanceof Error ? e.message : \"An unknown error occurred.\";\n        return { success: false, error: errorMessage };\n    }\n}\n\nexport async function generate1601EQExcel(fileIds: string[], fileNames: string[]): Promise<ExcelResult> {\n    try {\n        const fileContents = await Promise.all(fileIds.map(id => getDatFileContent(id)));\n\n        const filesWithContent = fileNames.map((name, index) => ({\n            name,\n            content: fileContents[index].content,\n            month: parseInt(name.substring(13, 15), 10),\n        })).filter(f => f.content);\n\n        if (filesWithContent.length === 0) {\n            return { success: false, error: \"No content found in the selected files.\" };\n        }\n\n        filesWithContent.sort((a, b) => a.month - b.month);\n\n        let hasSched1Data = false;\n        let hasSched2Data = false;\n        for (const file of filesWithContent) {\n            if (file.content.includes('D1,')) hasSched1Data = true;\n            if (file.content.includes('D2,')) hasSched2Data = true;\n        }\n\n        if (!hasSched1Data && !hasSched2Data) {\n            return { success: false, error: \"No data found for Schedule 1 or Schedule 2 in the selected files.\" };\n        }\n        \n        const latestFile = filesWithContent[filesWithContent.length - 1];\n        const headerLine = latestFile.content!.split('\\n').find(line => line.startsWith('HQAP,'));\n        \n        if (!headerLine) {\n            return { success: false, error: \"Could not find a header line in the latest file.\" };\n        }\n\n        const headerCols = headerLine.split(',').map(col => col.replace(/\"/g, ''));\n        \n        const ownerTin = `${headerCols[2]}-${headerCols[3]}`;\n        const ownerName = headerCols[4];\n        \n        const getQuarterInfo = (reportingPeriod: string) => {\n            const [monthStr, yearStr] = reportingPeriod.split('/');\n            const month = parseInt(monthStr, 10);\n            const year = parseInt(yearStr, 10);\n            const quarter = Math.ceil(month / 3);\n            return { year, quarter, month };\n        };\n        const reportingPeriod = headerCols[5];\n        const { year, quarter } = getQuarterInfo(reportingPeriod);\n        const quarterEndMonth = new Date(year, quarter * 3, 0); \n        const quarterEndDate = format(quarterEndMonth, 'MMMM, yyyy').toUpperCase();\n\n        const wb = xlsx.utils.book_new();\n\n        if (hasSched1Data) {\n            const ws1Data: (string | number | null)[][] = [\n                ['Attachment to BIR Form 1601-EQ'],\n                ['QUARTERLY ALPHABETICAL LIST OF PAYEES SUBJECTED TO EXPANDED WITHHOLDING TAX'],\n                [`FOR THE QUARTER ENDING ${quarterEndDate}`],\n                [],\n                [],\n                [`TIN: ${ownerTin}`],\n                [`WITHHOLDING AGENT'S NAME: ${ownerName}`],\n                [],\n                [],\n                [null, null, null, null, null, null, '1ST MONTH OF THE QUARTER', null, null, '2ND MONTH OF THE QUARTER', null, null, '3RD MONTH OF THE QUARTER', null, null, 'TOTAL FOR THE QUARTER'],\n                ['SEQ', 'TAXPAYER', 'CORPORATION', 'INDIVIDUAL', 'ATC CODE', null, 'AMOUNT OF', 'TAX RATE', 'AMOUNT OF', 'AMOUNT OF', 'TAX RATE', 'AMOUNT OF', 'AMOUNT OF', 'TAX RATE', 'AMOUNT OF', 'TOTAL', 'TOTAL'],\n                ['NO', 'IDENTIFICATION', '(Registered Name)', '(Last Name, First Name, Middle Name)', null, \"NATURE OF PAYMENT\", 'INCOME PAYMENT', null, 'TAX WITHHELD', 'INCOME PAYMENT', null, 'TAX WITHHELD', 'INCOME PAYMENT', null, 'TAX WITHHELD', 'INCOME PAYMENT', 'TAX WITHHELD'],\n                ['(1)','(2)','(3)','(4)','(5)', null, '(6)','(7)','(8)','(9)','(10)','(11)','(12)','(13)','(14)','(15)','(16)'],\n                [\"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\"],\n            ];\n\n            let totalMonth1Income = 0, totalMonth1Rate = 0, totalMonth1Tax = 0;\n            let totalMonth2Income = 0, totalMonth2Rate = 0, totalMonth2Tax = 0;\n            let totalMonth3Income = 0, totalMonth3Rate = 0, totalMonth3Tax = 0;\n            let totalQtrIncome = 0, totalQtrTax = 0;\n\n            for (const file of filesWithContent) {\n                if (!file.content) continue;\n\n                const detailLines = file.content.split('\\n').filter(line => line.startsWith('D1,'));\n                for (const line of detailLines) {\n                    const cols = line.split(',').map(col => col.replace(/\"/g, ''));\n                    \n                    const tin = cols[3];\n                    const branch = cols[4];\n                    const formattedTin = tin ? `${tin.substring(0,3)}-${tin.substring(3,6)}-${tin.substring(6,9)}-${branch}` : '';\n\n                    const regName = cols[5];\n                    const lastName = cols[6];\n                    const firstName = cols[7];\n                    const middleName = cols[8];\n\n                    const individualName = (lastName || firstName || middleName) \n                        ? `${lastName || ''}, ${firstName || ''} ${middleName || ''}`.trim()\n                        : '';\n                    \n                    const atc = cols[10];\n                    const atcData = atcWE.find(item => item.atc === atc);\n                    const atcDescription = atcData ? atcData.description : 'NOT FOUND';\n\n                    const incomePayment = parseFloat(cols[12] || '0');\n                    const taxRate = parseFloat(cols[11] || '0');\n                    const taxWithheld = parseFloat(cols[13] || '0');\n\n                    const monthData = [0, 0, 0, 0, 0, 0, 0, 0, 0];\n                    const monthPosition = (file.month - 1) % 3;\n\n                    monthData[monthPosition * 3] = incomePayment;\n                    monthData[monthPosition * 3 + 1] = taxRate;\n                    monthData[monthPosition * 3 + 2] = taxWithheld;\n                    \n                    if (monthPosition === 0) {\n                        totalMonth1Income += incomePayment;\n                        totalMonth1Rate += taxRate;\n                        totalMonth1Tax += taxWithheld;\n                    } else if (monthPosition === 1) {\n                        totalMonth2Income += incomePayment;\n                        totalMonth2Rate += taxRate;\n                        totalMonth2Tax += taxWithheld;\n                    } else {\n                        totalMonth3Income += incomePayment;\n                        totalMonth3Rate += taxRate;\n                        totalMonth3Tax += taxWithheld;\n                    }\n                    \n                    const totalIncomePaymentForQtr = incomePayment;\n                    const totalTaxWithheldForQtr = taxWithheld;\n\n                    totalQtrIncome += totalIncomePaymentForQtr;\n                    totalQtrTax += totalTaxWithheldForQtr;\n\n                    const rowData = [\n                        cols[2], // seq #\n                        formattedTin,\n                        regName,\n                        individualName,\n                        atc,\n                        atcDescription,\n                        ...monthData,\n                        totalIncomePaymentForQtr, \n                        totalTaxWithheldForQtr,\n                    ];\n                    ws1Data.push(rowData);\n                }\n            }\n            \n            const separatorRow = [null, null, null, null, null, null, \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\", \"------------------\"];\n            ws1Data.push(separatorRow);\n\n            const grandTotalRow = [\n                \"Grand Total :\", null, null, null, null, null, \n                totalMonth1Income, totalMonth1Rate, totalMonth1Tax,\n                totalMonth2Income, totalMonth2Rate, totalMonth2Tax,\n                totalMonth3Income, totalMonth3Rate, totalMonth3Tax,\n                totalQtrIncome, totalQtrTax\n            ];\n            ws1Data.push(grandTotalRow);\n\n            const doubleRuleRow = [\n                null, null, null, null, null, null, null, null, null, null, null, null, null, null, null,\n                \"==================\", \"==================\"\n            ];\n            ws1Data.push(doubleRuleRow);\n            \n            ws1Data.push([\"END OF REPORT\"]);\n\n            const ws1 = xlsx.utils.aoa_to_sheet(ws1Data);\n            xlsx.utils.book_append_sheet(wb, ws1, 'sched1');\n        }\n        \n        if (hasSched2Data) {\n            const ws2Data: (string | number | null)[][] = [\n                ['Attachment to BIR Form 1601-EQ'],\n                ['QUARTERLY ALPHABETICAL LIST OF PAYEES WHOSE INCOME PAYMENTS ARE EXEMPT FROM WITHHOLDING TAX'],\n                [`FOR THE QUARTER ENDING ${quarterEndDate}`],\n                [],\n                [],\n                [`TIN: ${ownerTin}`],\n                [`WITHHOLDING AGENT'S NAME: ${ownerName}`],\n                [],\n                [],\n                [null, null, null, null, null, null, '1ST MONTH OF THE QUARTER', '2ND MONTH OF THE QUARTER', '3RD MONTH OF THE QUARTER', 'TOTAL FOR THE QUARTER'],\n                ['SEQ', 'TAXPAYER', 'CORPORATION', 'INDIVIDUAL', 'ATC CODE', null, 'AMOUNT OF', 'AMOUNT OF', 'AMOUNT OF', 'TOTAL'],\n                ['NO', 'IDENTIFICATION', '(Registered Name)', '(Last Name, First Name, Middle Name)', null, \"NATURE OF PAYMENT\", 'INCOME PAYMENT', 'INCOME PAYMENT', 'INCOME PAYMENT', 'INCOME PAYMENT'],\n                ['(1)','(2)','(3)','(4)','(5)', null, '(6)','(7)','(8)','(9)'],\n                [\"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\", \"------------------------------\"],\n            ];\n            \n            let totalSched2Month1 = 0;\n            let totalSched2Month2 = 0;\n            let totalSched2Month3 = 0;\n            let totalSched2Qtr = 0;\n\n\n            for (const file of filesWithContent) {\n                if (!file.content) continue;\n\n                const detailLines = file.content.split('\\n').filter(line => line.startsWith('D2,'));\n                for (const line of detailLines) {\n                    const cols = line.split(',').map(col => col.replace(/\"/g, ''));\n                    \n                    const tin = cols[3];\n                    const branch = cols[4];\n                    const formattedTin = tin ? `${tin.substring(0,3)}-${tin.substring(3,6)}-${tin.substring(6,9)}-${branch}` : '';\n\n                    const regName = cols[5];\n                    const lastName = cols[6];\n                    const firstName = cols[7];\n                    const middleName = cols[8];\n\n                    const individualName = (lastName || firstName || middleName) \n                        ? `${lastName || ''}, ${firstName || ''} ${middleName || ''}`.trim()\n                        : '';\n                    \n                    const atc = cols[10];\n                    const atcData = atcExempt.find(item => item.atc === atc);\n                    const atcDescription = atcData ? atcData.description : 'NOT FOUND';\n\n                    const incomePayment = parseFloat(cols[11] || '0');\n\n                    const monthData = [0, 0, 0];\n                    const monthPosition = (file.month - 1) % 3;\n                    monthData[monthPosition] = incomePayment;\n\n                    if (monthPosition === 0) totalSched2Month1 += incomePayment;\n                    else if (monthPosition === 1) totalSched2Month2 += incomePayment;\n                    else totalSched2Month3 += incomePayment;\n                    \n                    const totalForQtr = incomePayment;\n                    totalSched2Qtr += totalForQtr;\n\n                    const rowData = [\n                        cols[2], // seq #\n                        formattedTin,\n                        regName,\n                        individualName,\n                        atc,\n                        atcDescription,\n                        ...monthData,\n                        totalForQtr,\n                    ];\n                    ws2Data.push(rowData);\n                }\n            }\n            \n            const separatorRow = [null, null, null, null, null, null, \"------------------\", \"------------------\", \"------------------\", \"------------------\"];\n            ws2Data.push(separatorRow);\n            ws2Data.push([\n                \"Grand Total :\", null, null, null, null, null,\n                totalSched2Month1, totalSched2Month2, totalSched2Month3, totalSched2Qtr\n            ]);\n            ws2Data.push([null, null, null, null, null, null, null, null, null, \"==================\"]);\n            ws2Data.push([\"END OF REPORT\"]);\n\n            const ws2 = xlsx.utils.aoa_to_sheet(ws2Data);\n            xlsx.utils.book_append_sheet(wb, ws2, 'sched2');\n        }\n        \n        const wbout = xlsx.write(wb, { bookType: 'xlsx', type: 'base64' });\n        \n        const fileName = `${headerCols[2]}-1601EQ-Q${quarter}-${year}.xlsx`;\n\n        return { success: true, base64: wbout, fileName };\n\n    } catch (e) {\n        console.error(\"Error generating 1601-EQ Excel:\", e);\n        const errorMessage = e instanceof Error ? e.message : \"An unknown error occurred.\";\n        return { success: false, error: errorMessage };\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 4718, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/.next-internal/server/app/%28app%29/dat-files/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {logoutUser as '0077798b1627f8549856e5ef771e5b5197af078b59'} from 'ACTIONS_MODULE0'\nexport {getUserHeaderData as '40b981786947aad3d7b17012761d8eedf3b8c56d37'} from 'ACTIONS_MODULE1'\nexport {getDatFiles as '40a57fcb4a960a37a11746b24812e58ef776483800'} from 'ACTIONS_MODULE2'\nexport {getInitialPageToken as '00e0de5eecd8231df764d2365c49c18983c0b60260'} from 'ACTIONS_MODULE2'\nexport {checkForDatFileChanges as '600ba226d4d3d144eecda0e0fe4cc7cd068fe5c48c'} from 'ACTIONS_MODULE2'\nexport {getCurrentUser as '0018b0f9265f51f8e8429dbf1d89f068d36a0dc283'} from 'ACTIONS_MODULE3'\nexport {getDatFileContent as '4016ebdf9488006741c60b7311f41f9bd369ad7fad'} from 'ACTIONS_MODULE2'\nexport {deleteDatFile as '40af73184119c15409b97a0d41b0fa658f6ec0f5b9'} from 'ACTIONS_MODULE2'\nexport {generateSalesExcel as '60801134ccf6d049eb11a64d15fa5efad0465339be'} from 'ACTIONS_MODULE4'\nexport {generatePurchasesExcel as '6025241fdfe3bb13db8d7a05ccb2e3bf526ea75c95'} from 'ACTIONS_MODULE4'\nexport {generate1601EQExcel as '6047da330093c474b8ac0f5a6a2e8977a008216617'} from 'ACTIONS_MODULE4'\n"],"names":[],"mappings":";AAAA;AACA;AACA;AAGA;AAGA","debugId":null}},
    {"offset": {"line": 4818, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/dat-files/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/dat-files/page.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/dat-files/page.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAoS,GACjU,kEACA","debugId":null}},
    {"offset": {"line": 4832, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/dat-files/page.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/(app)/dat-files/page.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/(app)/dat-files/page.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAgR,GAC7S,8CACA","debugId":null}},
    {"offset": {"line": 4846, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}}]
}